
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Apuntes y ejercicios sobre rendimiento de consultas en MongoDB. Creación y uso de índices, simples, compuestos, dispersos. Creación de colecciones limitadas (capped).">
      
      
      
        <link rel="canonical" href="https://aitor-medrano.github.io/iabd/sa/rendimiento.html">
      
      
        <link rel="prev" href="agregaciones.html">
      
      
        <link rel="next" href="replicacion.html">
      
      
      <link rel="icon" href="../favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>Rendimiento en MongoDB. - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VKM8BDY6KT"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VKM8BDY6KT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VKM8BDY6KT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Rendimiento en MongoDB. - Inteligencia Artificial y Big Data" >
      
        <meta  property="og:description"  content="Apuntes y ejercicios sobre rendimiento de consultas en MongoDB. Creación y uso de índices, simples, compuestos, dispersos. Creación de colecciones limitadas (capped)." >
      
        <meta  property="og:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/sa/rendimiento.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aitor-medrano.github.io/iabd/sa/rendimiento.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Rendimiento en MongoDB. - Inteligencia Artificial y Big Data" >
      
        <meta  name="twitter:description"  content="Apuntes y ejercicios sobre rendimiento de consultas en MongoDB. Creación y uso de índices, simples, compuestos, dispersos. Creación de colecciones limitadas (capped)." >
      
        <meta  name="twitter:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/sa/rendimiento.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#indices" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rendimiento en MongoDB.
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2324.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning 23/24
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NoSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            NoSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nosql.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento de datos. NoSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="modelado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelado documental
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones en MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Rendimiento
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="rendimiento.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Rendimiento
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#indices" class="md-nav__link">
    <span class="md-ellipsis">
      Índices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Índices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simples" class="md-nav__link">
    <span class="md-ellipsis">
      Simples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compuestos" class="md-nav__link">
    <span class="md-ellipsis">
      Compuestos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parciales" class="md-nav__link">
    <span class="md-ellipsis">
      Parciales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unicos" class="md-nav__link">
    <span class="md-ellipsis">
      Únicos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiclave" class="md-nav__link">
    <span class="md-ellipsis">
      Multiclave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#otros-tipos-de-indices" class="md-nav__link">
    <span class="md-ellipsis">
      Otros tipos de índices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manejando-indices" class="md-nav__link">
    <span class="md-ellipsis">
      Manejando índices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#colecciones-limitadas" class="md-nav__link">
    <span class="md-ellipsis">
      Colecciones limitadas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="replicacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replicación y particionado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pymongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB y Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="series-temporales.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Series temporales
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/cloud.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/aws.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/s3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/ec2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/lambda.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/rds.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/dynamodb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DynamoDB
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/waf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WAF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/escalado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitorización y Escalado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/emr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMR
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/athena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Athena
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/glue.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glue
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingeniería de Datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Ingeniería de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/bigdata.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/de.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingeniería de datos
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/arq.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arquitecturas Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/etl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingesta de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/pentaho.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pentaho
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/formatos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formatos de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/faker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Faker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ecosistema Hadoop
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ecosistema Hadoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hadoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hadoop
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hdfs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/sqoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sqoop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/flume.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flume
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hive1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive I
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hive2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive II
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/spark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ecosistema Spark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/rdd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/dataframeAPI.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataFrames API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/catalog.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark JDBC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/deltalake.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Lake
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/streaming.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming I
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/join-window.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming II
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Flujo de datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Flujo de datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/airflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transferencia de conocimiento
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Transferencia de conocimiento
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/transferencia.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reaprendiendo
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/hf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugging Face
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/datasets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../audio/audio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tratamiento de Audio
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../audio/audio-hf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio en Hugging Face
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pia/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    PIA
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            PIA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            Lara 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/01presentacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/02requisitos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prototipado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/03visitaVK.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Victoria Kent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/04almacenamiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/05audio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento audio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/11dataset.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creando el dataset
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
        
          
          <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_3">
            <span class="md-nav__icon md-icon"></span>
            Lara 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/21conociendo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Lara
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/22captura.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capturando audios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/29dataset.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creando el dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/30entrenamiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entrenando
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/31refinando.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refinando
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <label class="md-nav__link" for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/06autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/07navarrosantafe.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/08timeseries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/09powerbi.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/10actuadores.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actuadores
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_5" >
        
          
          <label class="md-nav__link" for="__nav_10_5" id="__nav_10_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_5">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/23autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Autoponic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/24nodered.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node-RED
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/25villena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/26modelo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelo de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/27dashboard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cuadro de mandos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../blog/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_2" >
        
          
          <label class="md-nav__link" for="__nav_12_2" id="__nav_12_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archivo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_2">
            <span class="md-nav__icon md-icon"></span>
            Archivo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_3" >
        
          
          <label class="md-nav__link" for="__nav_12_3" id="__nav_12_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categorías
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_3">
            <span class="md-nav__icon md-icon"></span>
            Categorías
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/abril.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abril
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/diciembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diciembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/enero.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/febrero.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Febrero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/marzo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Marzo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noticias.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noticias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noviembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noviembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/octubre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octubre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/septiembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Septiembre
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#indices" class="md-nav__link">
    <span class="md-ellipsis">
      Índices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Índices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simples" class="md-nav__link">
    <span class="md-ellipsis">
      Simples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compuestos" class="md-nav__link">
    <span class="md-ellipsis">
      Compuestos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parciales" class="md-nav__link">
    <span class="md-ellipsis">
      Parciales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unicos" class="md-nav__link">
    <span class="md-ellipsis">
      Únicos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiclave" class="md-nav__link">
    <span class="md-ellipsis">
      Multiclave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#otros-tipos-de-indices" class="md-nav__link">
    <span class="md-ellipsis">
      Otros tipos de índices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manejando-indices" class="md-nav__link">
    <span class="md-ellipsis">
      Manejando índices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#colecciones-limitadas" class="md-nav__link">
    <span class="md-ellipsis">
      Colecciones limitadas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <a href="../tags.html#mongodb" class="md-tag">MongoDB</a>
    
  
    
    
    
      <a href="../tags.html#bda-ra4" class="md-tag">BDA RA4</a>
    
  
</nav>



  <h1>Rendimiento</h1>

<p>En esta sesión vamos a trabajar como mejorar el rendimiento respecto al acceso y procesamiento de los datos en <em>MongoDB</em>.</p>
<h2 id="indices">Índices<a class="headerlink" href="#indices" title="Permanent link">&para;</a></h2>
<p>Los índices son una parte importante de la gestión de bases de datos. Un índice en una base de datos es similar a un índice de un libro; permite saltar directamente a la parte del libro en vez de tener que pasar las páginas buscando el tema o la palabra que nos interesa.</p>
<p>En el caso de <em>MongoDB</em>, un <a href="https://www.mongodb.com/docs/manual/indexes/">índice</a> es una estructura de datos que almacena información sobre los valores de determinados campos de los documentos de una colección. Esta estructura permite recorrer los datos y ordenarlos de manera muy rápida. Así pues, los índices se utilizan tanto al buscar un documento como al ordenar los datos de una consulta.</p>
<p>Como idea base, emplear índices mejora el rendimiento de las consultas.</p>
<p>Cuando una colección no contiene un índice, al buscar un documento, se realizará una escaneo de toda la colección, lo que se conoce como un <em>collection scan</em>, operación que tiene una complejidad lineal <code>O(N)</code>, ya que la búsqueda de un documento es proporcional a la cantidad de documentos de la colección.</p>
<div class="admonition info">
<p class="admonition-title">Preparando los ejemplos</p>
<p>Para los siguientes ejemplos, vamos a trabajar con dos colecciones distintas.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">grades</label><label for="__tabbed_1_2">zips</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Por un lado, vamos a utilizar la colección de las 100.000 calificaciones que han obtenido diferentes estudiantes en diferentes trabajos, exámenes o cuestionarios almacenadas en <code>sample_training.grades</code>.</p>
<p>Un ejemplo de una calificación sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.grades.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">()</span>
<span class="linenos" data-linenos=" 2 "></span><span class="err">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;56d5f7eb604eb380b0d8d8cf&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;student_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nt">&quot;scores&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exam&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">        </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">91.97520018439039</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;quiz&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">95.80410375967175</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;homework&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">        </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">89.62485475572984</span>
<span class="linenos" data-linenos="17 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;homework&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="w">        </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">51.621532832724846</span>
<span class="linenos" data-linenos="21 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="p">],</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="nt">&quot;class_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">350</span>
<span class="linenos" data-linenos="24 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Y por el otro, vamos a utilizar la colección con casi 30.000 poblaciones (realmente, información sobre los códigos postales) almacenadas en <code>sample_training.zips</code>.</p>
<p>Un ejemplo de una población sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.zips.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">()</span>
<span class="linenos" data-linenos=" 2 "></span><span class="err">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5c8eccc1caa187d17ca6ed29&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CLEVELAND&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nt">&quot;zip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;35049&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">33.992106</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">86.559355</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="nt">&quot;pop&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2369</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AL&quot;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<p>Para comprobar el impacto del uso de índices, vamos a empezar con un ejemplo para ver cómo de rápido puede hacerse una consulta que tiene un índice respecto a uno que no lo tiene.</p>
<p>Para analizar el plan de ejecución de una consulta, podemos emplear el método <a href="https://docs.mongodb.org/manual/reference/method/cursor.explain/"><code>explain()</code></a> sobre un cursor:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;student_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;class_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">explainVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">queryPlanner</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;sample_training.grades&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nx">indexFilterSet</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="nx">parsedQuery</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">        </span><span class="s1">&#39;$and&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="nx">queryHash</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3C69C349&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="nx">planCacheKey</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;3C69C349&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="nx">maxIndexedOrSolutionsReached</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="nx">maxIndexedAndSolutionsReached</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="nx">maxScansToExplodeReached</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">winningPlan</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos" data-linenos="16 "></span><span class="w">        </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;COLLSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="17 "></span><span class="w">        </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="18 "></span><span class="w">          </span><span class="s1">&#39;$and&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
<span class="linenos" data-linenos="19 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="20 "></span><span class="w">        </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span>
<span class="linenos" data-linenos="21 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="22 "></span><span class="w">      </span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="24 "></span><span class="w">    </span><span class="nx">executionStats</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span class="linenos" data-linenos="25 "></span><span class="w">      </span><span class="nx">executionSuccess</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos="26 "></span><span class="w">      </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="27 "></span><span class="w">      </span><span class="nx">executionTimeMillis</span><span class="o">:</span><span class="w"> </span><span class="mf">104</span><span class="p">,</span>
</span><span class="linenos" data-linenos="28 "></span><span class="w">      </span><span class="nx">totalKeysExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="29 "></span><span class="w">      </span><span class="nx">totalDocsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">100000</span><span class="p">,</span>
</span><span class="linenos" data-linenos="30 "></span><span class="w">      </span><span class="nx">executionStages</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="31 "></span><span class="w">        </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;COLLSCAN&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="32 "></span><span class="w">        </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="33 "></span><span class="w">          </span><span class="s1">&#39;$and&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
<span class="linenos" data-linenos="34 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="35 "></span><span class="w">        </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="36 "></span><span class="w">        </span><span class="nx">executionTimeMillisEstimate</span><span class="o">:</span><span class="w"> </span><span class="mf">37</span><span class="p">,</span>
<span class="linenos" data-linenos="37 "></span><span class="w">        </span><span class="nx">works</span><span class="o">:</span><span class="w"> </span><span class="mf">100001</span><span class="p">,</span>
<span class="linenos" data-linenos="38 "></span><span class="w">        </span><span class="nx">advanced</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="39 "></span><span class="w">        </span><span class="nx">needTime</span><span class="o">:</span><span class="w"> </span><span class="mf">99999</span><span class="p">,</span>
<span class="linenos" data-linenos="40 "></span><span class="w">        </span><span class="nx">needYield</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="linenos" data-linenos="41 "></span><span class="w">        </span><span class="nx">saveprovincia</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="linenos" data-linenos="42 "></span><span class="w">        </span><span class="nx">restoreprovincia</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="linenos" data-linenos="43 "></span><span class="w">        </span><span class="nx">isEOF</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="44 "></span><span class="w">        </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="45 "></span><span class="w">        </span><span class="nx">docsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">100000</span>
<span class="linenos" data-linenos="46 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="47 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="48 "></span><span class="w">    </span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="49 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="50 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="51 "></span><span class="w">    </span><span class="nx">serverInfo</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="52 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="53 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="54 "></span><span class="w">    </span><span class="nx">serverParameters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="55 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="56 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="57 "></span><span class="w">    </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="58 "></span><span class="w">    </span><span class="s1">&#39;$clusterTime&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="59 "></span><span class="w">      </span><span class="nx">clusterTime</span><span class="o">:</span><span class="w"> </span><span class="nx">Timestamp</span><span class="p">({</span><span class="w"> </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="mf">1694280295</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="o">:</span><span class="w"> </span><span class="mf">27</span><span class="w"> </span><span class="p">}),</span>
<span class="linenos" data-linenos="60 "></span><span class="w">      </span><span class="nx">signature</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="61 "></span><span class="w">        </span><span class="nx">hash</span><span class="o">:</span><span class="w"> </span><span class="nx">Binary</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s2">&quot;237c7c32a8e17870315a7b2a7eb95a61fd2cc581&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hex&quot;</span><span class="p">),</span><span class="w"> </span><span class="mf">0</span><span class="p">),</span>
<span class="linenos" data-linenos="62 "></span><span class="w">        </span><span class="nx">keyId</span><span class="o">:</span><span class="w"> </span><span class="mf">7230891675508277000</span>
<span class="linenos" data-linenos="63 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="64 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="65 "></span><span class="w">    </span><span class="nx">operationTime</span><span class="o">:</span><span class="w"> </span><span class="nx">Timestamp</span><span class="p">({</span><span class="w"> </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="mf">1694280295</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="o">:</span><span class="w"> </span><span class="mf">27</span><span class="w"> </span><span class="p">})</span>
<span class="linenos" data-linenos="66 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<div class="admonition tip inline end">
<p class="admonition-title">explain</p>
<p>En cuanto al método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.explain/"><code>explain()</code></a>, nos va a permitir averiguar si una consulta utiliza el índice que esperamos, si utiliza un índice al realizar una proyección u ordenación de resultados, así como averiguar que parte del plan de ejecución es más costoso.</p>
</div>
<p>El plan de ejecución devuelve <a href="https://docs.mongodb.org/manual/reference/explain-results/">mucha información</a>, pero nos vamos a centrar en unos pocos atributos para analizar el resultado.</p>
<p>A <em>grosso modo</em> podemos observar como el resultado se divide en dos partes:</p>
<ul>
<li><code>queryPlanner</code> (línea <code>4</code>): muestra información sobre la consulta, indicando el plan ganador en <code>winningPlan</code> (línea <code>15</code>)<ul>
<li><code>winningPlan.stage</code> (línea <code>16</code>): muestra información de la acción realizada. Puede tomar los valores:<ul>
<li><code>COLLSCAN</code>: escaneo completo de una colección</li>
<li><code>IXSCAN</code>: escaneo a partir de un índice</li>
<li><code>FETCH</code>: al recuperar documentos</li>
<li><code>SHARD_MERGE</code>: al fusionar resultados de las particiones</li>
</ul>
</li>
</ul>
</li>
<li><code>executionStats</code>: muestra estadísticas de ejecución (línea <code>16</code>)<ul>
<li><code>executionTimeMillis</code>: tiempo empleado</li>
</ul>
</li>
</ul>
<p>Del resultado obtenido, se puede observar mediante la propiedad <code>queryPlanner.winningPlan.stage</code> que ha utilizado un <code>COLLSCAN</code>, lo que significa que se ha realizado un escaneo completo de toda la colección para encontrar los datos, es decir, no se ha usado ningún índice en la consulta. Esta consulta sólo devuelve un documento (<code>executionStats.nReturned</code>) pero ¡ha tenido que escanear los 100.000 existentes (<code>executionStats.totalDocsExamined</code>)!</p>
<p>Cuando vamos a buscar un elemento es mucho mas rápido hacer un <code>findOne</code> que <code>find</code>, porque mientras <code>find</code> recorre toda la colección, con <code>findOne</code> en cuanto encuentre un documento, el cursor se detendrá.</p>
<p>Por defecto, el campo <code>_id</code> esta indexado. Así pues, vamos a buscar el mismo documento de antes, pero ahora mediante el campo indexado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;56d5f7eb604eb380b0d8d8d3&quot;</span><span class="p">)}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">queryPlanner</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nx">winningPlan</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">        </span><span class="nx">stage</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;IDHACK&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="nx">rejectedPlans</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="nx">executionStats</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="nx">executionSuccess</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="nx">nReturned</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="nx">executionTimeMillis</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="nx">totalKeysExamined</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">totalDocsExamined</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="nx">executionStages</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="17 "></span><span class="w">        </span><span class="p">...</span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="20 "></span><span class="w">    </span><span class="p">...</span>
<span class="linenos" data-linenos="21 "></span><span class="w">    </span><span class="nx">ok</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="p">...</span>
<span class="linenos" data-linenos="23 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Ahora <em>MongoDB</em> sólo ha escaneado el documento que ha devuelto ( <code>executionStats.totalKeysExamined</code>), y ha utilizado un índice para acceder al campo <code>_id</code> (valor <strong><code>IDHACK</code></strong> en <code>winningPlan.stage</code>). Al haber utilizado un índice, hemos evitado tener que mirar en más documentos. Esta consulta se ha realizado más rápidamente (y a mayor número de documentos más se nota la diferencia). Por supuesto, no siempre vamos a buscar por su <code>_id</code>, así que vamos a ver como crear nuevos índices.</p>
<p>Toda la información sobre el uso de índices con <em>MongoDB</em> se encuentra disponible en <a href="http://docs.mongodb.org/manual/core/indexes/">http://docs.mongodb.org/manual/core/indexes/</a>.</p>
<h3 id="simples">Simples<a class="headerlink" href="#simples" title="Permanent link">&para;</a></h3>
<p>Para crear un índice hemos de utilizar el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.createIndex"><code>createIndex({ &lt;atributo&gt; : &lt;orden&gt; })</code></a>. Si lo hacemos sobre un único campo, se conoce como índice simple.</p>
<div class="admonition inline end important">
<p class="admonition-title">Orden en los índices</p>
<p>El orden de los índices (<code>1</code> para ascendente, <code>-1</code> para descendente) no importa para un índice sencillo, pero si que tendrá un impacto en los índices compuestos cuando se utilizan para ordenar o con una condición de rango.</p>
</div>
<p>El campo sobre el que se crea el índice puede tener valores únicos o un rango de valores, así como tratarse de un campo anidado dentro de otro documento (utilizaremos la notación <code>.</code>).</p>
<p>Si queremos crear un índice sobre la propiedad <code>class_id</code> en orden ascendente haríamos lo siguiente (vemos que nos devuelve el nombre del índice creado):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;class_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="nx">class_id_1</span>
</code></pre></div>
<p>Si ahora volvemos a ejecutar la consulta sobre el identificador de la clase, comprobaremos como ahora ya realiza una búsqueda directa (valor <code>FETCH</code> en <code>winningPlan.stage</code>) y que no ha tenido que recorrer todos los documentos (pasa de 100.000 a 213).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;class_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">queryPlanner</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">      </span><span class="nx">plannerVersion</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nx">winningPlan</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos=" 7 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos=" 8 "></span><span class="w">          </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos=" 9 "></span><span class="w">            </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="10 "></span><span class="w">            </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">              </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="12 "></span><span class="w">            </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="13 "></span><span class="w">            </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;class_id_1&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="14 "></span><span class="w">            </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">            </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="w">              </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="17 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="18 "></span><span class="w">            </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="19 "></span><span class="w">            </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="w">            </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">            </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">            </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span><span class="w">            </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[7, 7]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="26 "></span><span class="w">        </span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="27 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="28 "></span><span class="w">      </span><span class="nx">executionStats</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="29 "></span><span class="w">        </span><span class="nx">executionSuccess</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="30 "></span><span class="w">        </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">213</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="31 "></span><span class="w">        </span><span class="nx">executionTimeMillis</span><span class="o">:</span><span class="w"> </span><span class="mf">9</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="32 "></span><span class="w">        </span><span class="nx">totalKeysExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">213</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="33 "></span><span class="w">        </span><span class="nx">totalDocsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">213</span><span class="p">,</span>
</span><span class="linenos" data-linenos="34 "></span><span class="w">        </span><span class="nx">executionStages</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="35 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="36 "></span><span class="w">          </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">213</span><span class="p">,</span>
<span class="linenos" data-linenos="37 "></span><span class="w">          </span><span class="p">...</span>
<span class="linenos" data-linenos="38 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="39 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="40 "></span><span class="w">      </span><span class="p">...,</span>
<span class="linenos" data-linenos="41 "></span><span class="w">      </span><span class="nx">ok</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="42 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Índice sobre <code>_id</code></p>
<p>Todas las colecciones tienen creados un índice sobre el campo <code>_id</code>, el cual es único aunque al visualizarlo no nos diga que lo sea, ya que no permite que se inserten dos <code>_id</code> iguales.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Cuidado con crear índices a lo loco</p>
<p>Un aspecto a considerar de los índices es que aceleran mucho las búsquedas, pero ralentizan las inserciones/modificaciones y hace que la información ocupe más espacio en disco. Por ello, deberemos considerar añadir índices a las colecciones donde el número de lecturas sea mayor que el de escrituras. Si sucede al revés, el uso de índices puede provocar un deterioro en el rendimiento.</p>
</div>
<p>Volvamos a nuestra consulta inicial donde recuperábamos las calificaciones de un determinado estudiante de una clase. Ahora mismo únicamente tenemos un índice sobre el identificador de la clase, pero no sobre el estudiante.</p>
<p>La pregunta es: cuando le pasamos a la consulta más columnas que las que tienen índices ¿sirve de algo?.</p>
<p>Si ahora volvemos a ejecutar la consulta, vemos que ya no recorre toda la colección, pero ¿entendemos lo que está haciendo?</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;student_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;class_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">explainVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">queryPlanner</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nx">winningPlan</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos=" 8 "></span><span class="w">        </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">          </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">            </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="linenos" data-linenos="11 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="14 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="15 "></span><span class="w">          </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="17 "></span><span class="w">          </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="18 "></span><span class="w">          </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;class_id_1&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="19 "></span><span class="w">          </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="w">          </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="21 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="22 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="23 "></span><span class="w">          </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="24 "></span><span class="w">          </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="25 "></span><span class="w">          </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="26 "></span><span class="w">          </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="27 "></span><span class="w">          </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="28 "></span><span class="w">          </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[7, 7]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="29 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="30 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="31 "></span><span class="w">      </span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="32 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="33 "></span><span class="w">    </span><span class="nx">executionStats</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="34 "></span><span class="w">      </span><span class="nx">executionSuccess</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="35 "></span><span class="w">      </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="36 "></span><span class="w">      </span><span class="nx">executionTimeMillis</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="37 "></span><span class="w">      </span><span class="nx">totalKeysExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">213</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="38 "></span><span class="w">      </span><span class="nx">totalDocsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">213</span><span class="p">,</span>
</span><span class="linenos" data-linenos="39 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="40 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="41 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="42 "></span><span class="w">    </span><span class="p">...</span>
<span class="linenos" data-linenos="43 "></span><span class="w">    </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="44 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>En la planificación decide realizar una búsqueda del <code>student_id</code> <code>0</code> sobre el conjunto de datos obtenidos tras haber recorrido el índice de la <code>class_id</code> <code>7</code>, es decir, primero recorre el índice (<code>inputStage</code>), y sobre el resultado obtenido, busca dicho estudiante. Por ello, recorre 213 documentos y a posteriori devuelve el único documento que cumple la condición.</p>
<p>Así pues, cuando tenemos una consulta sobre diferentes campos y alguno de ellos contiene un índice, primero utilizará dicho índice para quedarse con un subconjunto de los datos, y sobre dicho resultado, continuará filtrando los datos. Así pues, la respuesta corta es sí.</p>
<p>Pero, y si creamos el índice sobre el identificador el estudiante y repetimos la consulta ¿mejorará el rendimiento?</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;student_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="nx">student_id_1</span>
<span class="linenos" data-linenos=" 3 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;student_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;class_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nx">explainVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nx">queryPlanner</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="p">...</span>
<span class="hll"><span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nx">winningPlan</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">        </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="12 "></span><span class="w">          </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="16 "></span><span class="w">        </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="17 "></span><span class="w">        </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="18 "></span><span class="w">          </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
</span><span class="linenos" data-linenos="19 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="20 "></span><span class="w">        </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;student_id_1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">        </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">        </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="23 "></span><span class="w">          </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="24 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="25 "></span><span class="w">        </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="26 "></span><span class="w">        </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="27 "></span><span class="w">        </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="28 "></span><span class="w">        </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="29 "></span><span class="w">        </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="30 "></span><span class="w">        </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[0, 0]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="31 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="32 "></span><span class="w">    </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="33 "></span><span class="w">    </span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span class="linenos" data-linenos="34 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="35 "></span><span class="w">    </span><span class="p">]</span>
<span class="linenos" data-linenos="36 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="37 "></span><span class="w">  </span><span class="nx">executionStats</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="38 "></span><span class="w">    </span><span class="nx">executionSuccess</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="39 "></span><span class="w">    </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="40 "></span><span class="w">    </span><span class="nx">executionTimeMillis</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="41 "></span><span class="w">    </span><span class="nx">totalKeysExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="42 "></span><span class="w">    </span><span class="nx">totalDocsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
</span><span class="linenos" data-linenos="43 "></span><span class="w">    </span><span class="p">...</span>
<span class="linenos" data-linenos="44 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="45 "></span><span class="w">  </span><span class="p">...</span>
<span class="linenos" data-linenos="46 "></span><span class="w">  </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="47 "></span><span class="p">}</span>
</code></pre></div>
<p>En esta ocasión, vuelve a repetir estrategia pero con el índice de estudiantes (ya que devuelve menos documentos que el índice de clases), de manera que ahora sólo recorre 10 documentos.</p>
<p>Si nos centramos en la línea 33 y los planes rechazados (ahora aparece rellenado por que al tener dos índices, va a probar con cada uno de ellos por separado), vemos las diferentes consultas alternativas que ha generado <em>MongoDB</em> y que ha rechazado por implicar un peor rendimiento. Por ejemplo, elige el índice <code>class_id_1</code> y luego busca el estudiante <code>0</code> o prueba a hacer una conjunción (<code>AND_SORTED</code>) de los dos índices y luego filtrar por la condición compuesta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">        </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;class_id_1&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="17 "></span><span class="w">        </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="19 "></span><span class="w">      </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="w">      </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">      </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">      </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span><span class="w">      </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="24 "></span><span class="w">      </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[7, 7]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="26 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="27 "></span><span class="w">  </span><span class="p">{</span>
<span class="linenos" data-linenos="28 "></span><span class="w">    </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="29 "></span><span class="w">    </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="30 "></span><span class="w">      </span><span class="s1">&#39;$and&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
</span><span class="linenos" data-linenos="31 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="32 "></span><span class="w">    </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="33 "></span><span class="w">      </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;AND_SORTED&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="34 "></span><span class="w">      </span><span class="nx">inputStages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="35 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="36 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="37 "></span><span class="w">          </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="38 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="39 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="40 "></span><span class="w">          </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;class_id_1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="41 "></span><span class="w">          </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="42 "></span><span class="w">          </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="43 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="44 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="45 "></span><span class="w">          </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="46 "></span><span class="w">          </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="47 "></span><span class="w">          </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="48 "></span><span class="w">          </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="49 "></span><span class="w">          </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="50 "></span><span class="w">          </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[7, 7]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="51 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="52 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="53 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="54 "></span><span class="w">          </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="55 "></span><span class="w">            </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="56 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="57 "></span><span class="w">          </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;student_id_1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="58 "></span><span class="w">          </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="59 "></span><span class="w">          </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="60 "></span><span class="w">            </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="61 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="62 "></span><span class="w">          </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="63 "></span><span class="w">          </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="64 "></span><span class="w">          </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="65 "></span><span class="w">          </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="66 "></span><span class="w">          </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="67 "></span><span class="w">          </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[0, 0]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="68 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="69 "></span><span class="w">      </span><span class="p">]</span>
<span class="linenos" data-linenos="70 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="71 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="72 "></span><span class="p">]</span>
</code></pre></div>
<h4 id="trabajando-con-mongodbcompass">Trabajando con MongoDBCompass<a class="headerlink" href="#trabajando-con-mongodbcompass" title="Permanent link">&para;</a></h4>
<figure style="float: right">
    <img src="images/08explain-mongodb-compass.png" alt="Plan de ejecución en MongoDB Compass" width="800px">
    <figcaption>Plan de ejecución en MongoDB Compass</figcaption>
</figure>

<p>Además de crear y consultar los índices mediante el <em>shell</em> de <em>MongoDB</em>, podemos utilizar la herramienta gráfica <em>MongoDBCompass</em>.</p>
<p>Una característica muy útil es la posibilidad de visualizar el plan de ejecución de una forma gráfica y más cómoda. Para ello, en la pestaña de consultas, si repetimos la última consulta y pulsamos en <code>Explain</code>, podemos ver:</p>
<p>En la parte izquierda, un grafo con los pasos realizados:</p>
<ul>
<li>Primero el escaneo <code>IXSCAN</code> mediante el índice <code>student_id_1</code>, el cual devuelve 10 documentos.</li>
<li>Del resultado, se realiza el <code>FETCH</code> que devuelve un único documento.</li>
</ul>
<p>En la parte derecha, nos muestra un resumen del rendimiento, cantidad de documentos y claves examinadas así como el tiempo de ejecución total. </p>
<h3 id="compuestos">Compuestos<a class="headerlink" href="#compuestos" title="Permanent link">&para;</a></h3>
<p>Si queremos aplicar un índice sobre más de una propiedad, podemos crear <a href="https://www.mongodb.com/docs/manual/core/indexes/index-types/index-compound/">índices compuestos</a>, indicando las propiedades separadas por coma, de manera que el índice agrupa por la primera propiedad, y después por el/los siguiente(s) campo(s), hasta un máximo de 32 campos.</p>
<p>Así pues ahora crearemos un índice compuesto sobre el identificador del estudiante y de la clase:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;student_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;class_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<p>Y vemos si cambia su comportamiento respecto a los dos índices individuales:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;student_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;class_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span><span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">explainVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">queryPlanner</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nx">winningPlan</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">        </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos=" 9 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="10 "></span><span class="w">          </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">            </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="13 "></span><span class="w">          </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="14 "></span><span class="w">          </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;student_id_1_class_id_1&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="15 "></span><span class="w">          </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">          </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="17 "></span><span class="w">            </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="linenos" data-linenos="18 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="19 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="20 "></span><span class="w">          </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">          </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">          </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span><span class="w">          </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="24 "></span><span class="w">          </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="25 "></span><span class="w">          </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[0, 0]&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[7, 7]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="26 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="28 "></span><span class="w">      </span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="29 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="30 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="31 "></span><span class="w">          </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="32 "></span><span class="w">            </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="33 "></span><span class="w">              </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">7</span>
<span class="linenos" data-linenos="34 "></span><span class="w">            </span><span class="p">}</span>
<span class="linenos" data-linenos="35 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="36 "></span><span class="w">          </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="37 "></span><span class="w">            </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="38 "></span><span class="w">            </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="39 "></span><span class="w">              </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="40 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="41 "></span><span class="w">            </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;student_id_1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="42 "></span><span class="w">            </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="43 "></span><span class="w">            </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="44 "></span><span class="w">              </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="45 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="46 "></span><span class="w">            </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="47 "></span><span class="w">            </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="48 "></span><span class="w">            </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="49 "></span><span class="w">            </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="50 "></span><span class="w">            </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="51 "></span><span class="w">            </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[0, 0]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="52 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos="53 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="54 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="55 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="56 "></span><span class="w">          </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="57 "></span><span class="w">            </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="58 "></span><span class="w">              </span><span class="s1">&#39;$eq&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="linenos" data-linenos="59 "></span><span class="w">            </span><span class="p">}</span>
<span class="linenos" data-linenos="60 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="61 "></span><span class="w">          </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="62 "></span><span class="w">            </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="63 "></span><span class="w">            </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="64 "></span><span class="w">              </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="65 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="66 "></span><span class="w">            </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;class_id_1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="67 "></span><span class="w">            </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="68 "></span><span class="w">            </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="69 "></span><span class="w">              </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="70 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="71 "></span><span class="w">            </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="72 "></span><span class="w">            </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="73 "></span><span class="w">            </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="74 "></span><span class="w">            </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="75 "></span><span class="w">            </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="76 "></span><span class="w">            </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">class_id</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[7, 7]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="77 "></span><span class="w">          </span><span class="p">}</span>
<span class="linenos" data-linenos="78 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="79 "></span><span class="w">      </span><span class="p">]</span>
<span class="linenos" data-linenos="80 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="81 "></span><span class="w">    </span><span class="nx">executionStats</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="82 "></span><span class="w">      </span><span class="nx">executionSuccess</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="83 "></span><span class="w">      </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="84 "></span><span class="w">      </span><span class="nx">executionTimeMillis</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="85 "></span><span class="w">      </span><span class="nx">totalKeysExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="86 "></span><span class="w">      </span><span class="nx">totalDocsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
</span><span class="linenos" data-linenos="87 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="88 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="89 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="90 "></span><span class="w">    </span><span class="p">...</span>
<span class="linenos" data-linenos="91 "></span><span class="w">    </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="92 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Podemos observar como ahora sólo examina una única clave y un documento, utilizando el índice <code>student_id_1_class_id_1</code>, y que rechaza emplear los índices simples, ya sea el del estudiante como el de la clase.</p>
<p>Es importante destacar que en los índices compuestos, el orden de los índices importa, y mucho. Si hacemos una consulta que sólo utilice el atributo <code>class_id</code>, el índice compuesto <em>no</em> se va a utilizar, ya que los identificadores de clases realmente son índices secundarios a partir del identificador del estudiante, y localizar una clase implicaría volver a recorrer todos los estudiantes.</p>
<p>Pero volviendo al índice creado, si hacemos una consulta por ambos campos, da igual el orden que utilizamos en la búsqueda que siempre va a utilizar el índice. Esto es, las siguientes consultas van a utilizar el mismo índice <code>student_id_1_class_id_1</code>, ya que el orden de los campos en la consulta no importa:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">db.grades.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="nt">&quot;student_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;class_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">}</span><span class="err">)</span>
<span class="linenos" data-linenos="2 "></span><span class="err">db.grades.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="nt">&quot;class_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;student_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="err">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">No es lo mismo</p>
<p>No confundir los índices compuestos con hacer 2 o más índices sobre diferentes propiedades.</p>
</div>
<h4 id="prefijos">Prefijos<a class="headerlink" href="#prefijos" title="Permanent link">&para;</a></h4>
<p>Si creamos un índice sobre los campos <code>(A,B,C)</code>, el índice se va a utilizar para las búsquedas sobre <code>(A)</code>, sobre la dupla <code>(A,B)</code> y sobre el trio <code>(A,B,C)</code>. Es decir, los índices se usan con los subconjuntos por la izquierda (<a href="https://www.mongodb.com/docs/manual/core/indexes/index-types/index-compound/#index-prefixes">prefijos</a>) de los índices compuestos.</p>
<p>Si tenemos varios índices candidatos a la hora de ejecutar, el optimizador de consultas de <em>MongoDB</em> los usará en paralelo y se quedará con el resultado del primero que termine. Más información en <a href="http://docs.mongodb.org/manual/core/query-plans/">http://docs.mongodb.org/manual/core/query-plans/</a></p>
<p>Para mejorar el espacio y el rendimiento en las inserciones/modificaciones, si tenemos un índice compuesto sobre <code>(A,B,C)</code> y uno sencillo sobre <code>(A)</code>, es recomendable eliminar éste último, ya que el compuesto va a conseguir el mismo propósito sin necesidad de duplicar la información.</p>
<div class="admonition tip">
<p class="admonition-title">Regla ESR</p>
<p>La regla <strong><em>ESR</em></strong> define el orden a definir a la hora de crear un índice compuesto, empezando por la igualdad (<strong><em>E</em></strong><em>quality</em>), luego la ordenación (<strong><em>S</em></strong><em>ort</em>), y finalmente el rango (<strong><em>R</em></strong><em>ange</em>).</p>
<p>Por ejemplo, para la siguiente consulta </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;AL&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="nx">pop</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">10000</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}).</span><span class="nx">sort</span><span class="p">(</span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="p">)</span>
</code></pre></div>
<p>La propiedad <code>state</code> tiene la igualdad, <code>pop: { $gt: 10000 }</code> se basa en un rango y <code>city</code> se emplea para ordenar. </p>
<p>Así pues, siguiendo la regla ESR el índice óptimo sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">pop</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Más información en <a href="https://www.mongodb.com/docs/manual/tutorial/equality-sort-range-rule">https://www.mongodb.com/docs/manual/tutorial/equality-sort-range-rule</a></p>
</div>
<h4 id="ordenando">Ordenando<a class="headerlink" href="#ordenando" title="Permanent link">&para;</a></h4>
<p>Cuando ordenamos los datos mediante una operación <code>sort</code>, <em>MongoDB</em> va a intentar utilizar todos los índices disponibles.</p>
<p>Con los índices simples, <em>MongoDB</em> puede recorrer el índice en ambas direcciones, hacia adelante (<code>forward</code>) o hacia atrás (<code>backward</code>), dando igual el orden en que definimos el índice. </p>
<p>Conviene entender bien qué sucede cuando ordenamos por varios campos. Para ello, lo recomendable es crear índices compuestos.</p>
<p>Una característica de los índices compuestos es que podemos utilizar sus prefijos para ordenar los documentos, e incluso, podemos filtrar y ordenar las consultas dividiendo el índice compuesto entre los predicados de filtrado y ordenación.</p>
<p>Por ejemplo, si tenemos el índice <code>(A,B,C,D)</code>, podemos hacer una consulta que filtre por <code>(A,B)</code> y que ordene por <code>(C)</code>, y estaría utilizando el índice compuesto.</p>
<p>Además, si el orden de los campos es inverso, mientras el orden del índice al completo se respete, se seguirá empleado el índice, recorriendo el índice en modo <code>backward</code> (hacía atrás) (en vez del modo <code>forward</code>, hacia adelante).</p>
<p>Por lo tanto, en el caso de los índices compuestos, el orden en el que se definen y su sentido es muy importante.</p>
<p>Si tenemos el índice <code>(A,-B, C, -D)</code>, el índice compuesto se utilizará tanto para:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="3 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="s2">&quot;bbb&quot;</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;C&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="4 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="s2">&quot;bbb&quot;</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;C&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;D&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="5 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;D&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<p>como para su inversos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="s2">&quot;bbb&quot;</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;C&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="3 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;D&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<p>pero no para:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="s2">&quot;bbb&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="3 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="o">:</span><span class="s2">&quot;aaa&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;B&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;D&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<h3 id="parciales">Parciales<a class="headerlink" href="#parciales" title="Permanent link">&para;</a></h3>
<p>En ocasiones, por cuestiones de espacio y rendimiento en el mantenimiento, queremos crear los índices sobre un subconjunto de los documentos de una colección. Para ello, le pasaremos a la propiedad <code>partialFilterExpression</code> el criterio que debe cumplir el índice parcial.</p>
<p>Si sobre la colección <code>zips</code> queremos poner un índice sobre el estado únicamente para los documentos cuya población es igual o superior a 5000, podemos hacer uso de un <a href="https://www.mongodb.com/docs/manual/core/index-partial/">índice parcial</a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="p">{</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">},</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">partialFilterExpression</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="4 "></span><span class="p">)</span>
</code></pre></div>
<p>Sólo se empleará el índice cuando hagamos una consulta sobre dichos campos y obtengamos un subconjunto de los datos almacenados (la condición debe ser tan o más restrictiva que la de la definición del índice). Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;AL&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// No emplea el índice, no utiliza el filtro</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;AL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$lt</span><span class="o">:</span><span class="w"> </span><span class="mf">4000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// No emplea el índice, ya que no cumple el filtro</span>
<span class="linenos" data-linenos="3 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;AL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">6500</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// Sí emplea el filtro</span>
</code></pre></div>
<p>Así pues, si comprobamos el plan de ejecución veremos que sí que utiliza el índice creado (<code>provincia_1</code>), que se trata de un índice parcial (<code>isPartial:true</code>) y que no examina todos los documentos (sólo 229):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;AL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">6500</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">explainVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">queryPlanner</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nx">winningPlan</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FETCH&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">        </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">          </span><span class="nx">pop</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;$gt&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">6500</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="11 "></span><span class="w">        </span><span class="nx">inputStage</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos="12 "></span><span class="w">          </span><span class="nx">stage</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;IXSCAN&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="13 "></span><span class="w">          </span><span class="nx">keyPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span><span class="w">            </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="15 "></span><span class="w">          </span><span class="p">},</span>
<span class="hll"><span class="linenos" data-linenos="16 "></span><span class="w">          </span><span class="nx">indexName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;state_1&#39;</span><span class="p">,</span>
</span><span class="linenos" data-linenos="17 "></span><span class="w">          </span><span class="nx">isMultiKey</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="18 "></span><span class="w">          </span><span class="nx">multiKeyPaths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">            </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="20 "></span><span class="w">          </span><span class="p">},</span>
<span class="linenos" data-linenos="21 "></span><span class="w">          </span><span class="nx">isUnique</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">          </span><span class="nx">isSparse</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="23 "></span><span class="w">          </span><span class="nx">isPartial</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span class="linenos" data-linenos="24 "></span><span class="w">          </span><span class="nx">indexVersion</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="linenos" data-linenos="25 "></span><span class="w">          </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="26 "></span><span class="w">          </span><span class="nx">indexBounds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;[&quot;AL&quot;, &quot;AL&quot;]&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="28 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="29 "></span><span class="w">      </span><span class="nx">rejectedPlans</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos" data-linenos="30 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="31 "></span><span class="w">    </span><span class="nx">executionStats</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="32 "></span><span class="w">      </span><span class="nx">executionSuccess</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos="33 "></span><span class="w">      </span><span class="nx">nReturned</span><span class="o">:</span><span class="w"> </span><span class="mf">188</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="34 "></span><span class="w">      </span><span class="nx">executionTimeMillis</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="35 "></span><span class="w">      </span><span class="nx">totalKeysExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">229</span><span class="p">,</span>
</span><span class="hll"><span class="linenos" data-linenos="36 "></span><span class="w">      </span><span class="nx">totalDocsExamined</span><span class="o">:</span><span class="w"> </span><span class="mf">229</span><span class="p">,</span>
</span><span class="linenos" data-linenos="37 "></span><span class="w">      </span><span class="p">...</span>
<span class="linenos" data-linenos="38 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="39 "></span><span class="w">    </span><span class="p">...</span>
<span class="linenos" data-linenos="40 "></span><span class="w">    </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos="41 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>La ventaja de utilizar índices parciales es que son más ligeros en su creación y mantenimiento y utilizan menos espacio que un índice sobre todos los posibles valores.</p>
<h4 id="dispersos">Dispersos<a class="headerlink" href="#dispersos" title="Permanent link">&para;</a></h4>
<p>Un tipo especial de índice parcial son los índices dispersos (<a href="https://www.mongodb.com/docs/manual/core/index-sparse/"><em>sparse</em></a>), los cuales únicamente indexan aquellos documentos que tienen el campo (incluso con valor nulo), saltando aquellos donde el campo no existe.</p>
<p>Así pues, estas dos sentencias son equivalentes:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">sparse</span><span class="o">:</span><span class="kc">true</span><span class="p">})</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">partialFilterExpression</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$exists</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}}</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>Suponemos que tenemos los siguientes documentos en una colección llamada 'people' con los siguientes documentos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50a464fb0a9dfcc4f19d6271&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Andreu&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cargo&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Técnico&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50a4650c0a9dfcc4f19d6272&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Aitor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cargo&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CEO&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50a465280a9dfcc4f19d6273&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Marina&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Y hay un índice definido del siguiente modo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="nx">cargo</span><span class="o">:</span><span class="mf">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">sparse</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Enunciado</label><label for="__tabbed_2_2">Solución</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Si realizamos la siguiente consulta, ¿Qué documentos aparecerán y por qué?</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">cargo</span><span class="o">:</span><span class="kc">null</span><span class="p">})</span>
</code></pre></div>
<ul>
<li>Ningún documento, ya que la consulta utiliza el índice y no puede haber documentos que no contengan el campo <code>cargo</code></li>
<li>Ningún documento, ya que la consulta de <code>cargo:null</code> sólo encuentra documentos que de manera explícita tienen el cargo a nulo, independientemente del índice.</li>
<li>El documento de <code>Marina</code>, ya que la consulta no utilizará el índice</li>
<li>Todos los documentos de la colección, ya que todos cumplen que <code>cargo:null</code></li>
</ul>
</div>
<div class="tabbed-block">
<p>El documento de <code>Marina</code>, ya que el índice no se ejecutará sobre este documento.</p>
</div>
</div>
</div>
</div>
<h3 id="unicos">Únicos<a class="headerlink" href="#unicos" title="Permanent link">&para;</a></h3>
<p>Un índice único es similar al que creamos en cualquier sistema gestor de bases datos, prohibiendo valores duplicados para el campo indexado. <em>MongoDB</em>, por defecto, crea un índice único en el campo <code>_id</code> para cada colección.</p>
<p>Por ejemplo, para la colección <code>zips</code> si queremos asegurarnos que no hay dos <code>zip</code> repetidos podemos hacer crearemos el índice pasándole como segundo parámetro <strong><code>{unique: true}</code></strong>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;zip&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
<p>Además, una vez creado el índice, no permitirá insertar valores duplicados.</p>
<p>En un índice compuesto, la univocidad se realiza entre las combinaciones de valores de todos los campos del índices. Por ejemplo, las siguientes operaciones no violan el índice único, ya que las combinaciones de <code>nombre</code> y <code>cargo</code> no se repiten:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.iabd.crea</span><span class="kc">te</span><span class="err">I</span><span class="kc">n</span><span class="err">dex(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;nombre&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;cargo&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">u</span><span class="kc">n</span><span class="err">ique</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">)</span>
<span class="linenos" data-linenos="2 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.iabd.i</span><span class="kc">nsert</span><span class="err">(</span><span class="p">{</span><span class="nt">&quot;nombre&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Marina&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;cargo&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Técnico&quot;</span><span class="p">}</span><span class="err">)</span>
<span class="linenos" data-linenos="3 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.iabd.i</span><span class="kc">nsert</span><span class="err">(</span><span class="p">{</span><span class="nt">&quot;nombre&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Marina&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;cargo&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CEO&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div>
<div class="admonition caution">
<p class="admonition-title">Datos duplicados</p>
<p>Si ya tenemos una colección con datos duplicados, <em>MongoDB</em> no nos va a dejar crear un índice único</p>
</div>
<p>¿Y qué sucede si insertamos un documento que no contiene el campo indexado? Pues el primero que insertemos, funcionará. Pero si insertamos un segundo documento, no lo insertará, ya que <em>MongoDB</em> almacenará como nulo el valor del primer documento, y para el segundo, se quejará que ya existe uno con dicho valor.</p>
<h3 id="multiclave">Multiclave<a class="headerlink" href="#multiclave" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Preparando los ejemplos</p>
<p>Para los ejemplos con arrays vamos a trabajar con la colección de mensajes de un blog almacenada en la colección <code>sample_training.posts</code>. Un ejemplo de mensaje sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&quot;$oid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;50ab0f8bbcf1bfe2536dc40e&quot;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Four score and seven years ago our fathers brought forth on this continent a new nation...&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nt">&quot;permalink&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aBkusYpZxvbvJkgGjTDv&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;machine&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gettysburg Address&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;viola&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;saudi arabia&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;difference&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="s2">&quot;computer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;humor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;valley&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;scene&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;jute&quot;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="p">],</span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="nt">&quot;comments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Lorem ipsum dolor sit amet...&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bONSPozL@irpkmUiT.com&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span><span class="w">      </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Flora Duell&quot;</span>
<span class="linenos" data-linenos="18 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="err">...</span>
<span class="linenos" data-linenos="20 "></span><span class="w">  </span><span class="p">],</span>
<span class="linenos" data-linenos="21 "></span><span class="w">  </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="nt">&quot;$date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-11-20T05:05:15.264Z&quot;</span>
<span class="linenos" data-linenos="23 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="p">}</span><span class="w">    </span>
</code></pre></div>
</div>
<p>Por supuesto, podemos crear índices sobre propiedades que forman parte de un array. Así pues, podemos crear un índice sobre el autor de los comentarios mediante:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">comments</span><span class="p">.</span><span class="nx">author</span><span class="o">:</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
<p>Pero además también podemos crear un índice sobre todas las etiquetas, lo cual indexa cada elemento del array, con lo que podemos buscar por cualquier objeto del array. Este tipo de índices se conocen como <strong>multiclave</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
<p>Cuando se indexa una propiedad que es un array, se crea un índice multiclave para todos los valores del array de todos los documentos. Internamente, está creando un índice simple para cada uno de los valores. El uso de estos índices son lo que hacen que las consultas sobre documentos embebidos funcionen tan rápido.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">db.pos</span><span class="kc">ts</span><span class="err">.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;$all&quot;</span><span class="p">:[</span><span class="s2">&quot;computer&quot;</span><span class="p">,</span><span class="s2">&quot;humor&quot;</span><span class="p">]}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">)</span>
</code></pre></div>
<p>Es importante destacar que sólo se pueden crear índices compuestos multiclave cuando únicamente una de las propiedades del índice compuesto es un array; es decir, no puede haber dos propiedades array en un índice compuesto, ya que provocaría un producto cartesiano y su rendimiento no sería escalable.</p>
<h3 id="otros-tipos-de-indices">Otros tipos de índices<a class="headerlink" href="#otros-tipos-de-indices" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><a href="https://www.mongodb.com/docs/manual/core/indexes/index-types/index-geospatial">Geoespaciales</a>, para trabajar con coordenadas.</p>
</li>
<li>
<p>De <a href="https://www.mongodb.com/docs/manual/core/indexes/index-types/index-text/">texto</a>, para realizar búsquedas dentro de un campo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;body&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">})</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;body&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">default_language</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;english&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// o spanish</span>
</code></pre></div>
<p>Pudiendo realizar búsquedas con el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/text/"><code>$text</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$text</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$search</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;seven&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<p>Estos índices también pueden ser compuestos, sensibles o no a las mayúsculas, permitiendo delimitar los <em>tokenizadores</em>, el idioma, así como asignar diferente peso a cada campo del índice.</p>
</li>
<li>
<p><a href="https://www.mongodb.com/docs/manual/core/index-case-insensitive/">Insensibles a las mayúsculas</a> (<em>case insensitivity</em>): permiten la realización de consultas que realizan comparaciones de cadena sin tener en cuenta las mayúsculas. Para ello, emplearemos el parámetro <a href="https://www.mongodb.com/docs/manual/reference/collation"><code>collation</code></a>, indicando el idioma mediante <code>locale</code> y el nivel de comparación con <code>strength</code> (por ejemplo, si queremos que ignore las tildes, diéresis, etc...):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">collation</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">locale</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">strength</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p><a href="https://www.mongodb.com/docs/manual/core/indexes/index-types/index-wildcard/">Comodín</a> (<em>wildcards</em>) para crear índices sobre campos cuyos nombres pueden cambiar dentro de una colección, permitiendo realizar consultas indexadas en un conjunto de campos desconocido.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;$**&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;comments.$**&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p><a href="https://www.mongodb.com/docs/manual/core/indexes/index-types/index-hashed">Hash</a>, centrado en el uso de <em>sharding</em>.</p>
</li>
<li>
<p><a href="https://www.mongodb.com/docs/manual/core/index-ttl">TTL</a> (<em>Time-to-live</em>): utilizados para eliminar los documentos pasados un determinado tiempo.
    Por ejemplo, si queremos que se eliminen los posts que tienen más de un año de duración (3600 * 24 * 365 = 31536000) haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">db.pos</span><span class="kc">ts</span><span class="err">.crea</span><span class="kc">te</span><span class="err">I</span><span class="kc">n</span><span class="err">dex(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">da</span><span class="kc">te</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">expireA</span><span class="kc">fter</span><span class="err">Seco</span><span class="kc">n</span><span class="err">ds</span><span class="p">:</span><span class="w"> </span><span class="mi">31536000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">)</span>
</code></pre></div>
</li>
</ul>
<h3 id="manejando-indices">Manejando índices<a class="headerlink" href="#manejando-indices" title="Permanent link">&para;</a></h3>
<p>En versiones previas a la 4.4, los índices se podían <a href="https://docs.mongodb.org/manual/core/index-creation">crear</a> en <em>foreground</em>, de manera que al crear un índice se bloqueaban a todos los <em>writers</em> o en modo <em>background</em> que no penalizaba las escrituras pero tardaba más.</p>
<p>Actualmente, se utiliza un mecanismo optimizado el cual es el método por defecto y ya no se indica si se hacen en <em>foreground</em> o <em>background</em>.</p>
<p>Si al crear un índice, le queremos indicar un nombre, lo podemos hacer pasándole un segundo parámetro:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">student_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;student_idx&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>
<div class="admonition info inline end">
<p class="admonition-title">64</p>
<p>Una colección puede tener hasta 64 índices</p>
</div>
<p>Una vez creados, podemos consultar los índices de una determinada colección mediante el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.getIndexes/"><code>getIndexes()</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">()</span><span class="w"> </span><span class="c1">// muestra los índices de la colección grades</span>
</code></pre></div>
<p>Si vemos que no usamos un índice o que su rendimiento es peor, podemos borrarlo empleando el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.dropIndex"><code>dropIndex(atributo)</code></a>:.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">dropIndex</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;student_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// borra el índice indicando la propiedad student_id</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">dropIndex</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;student_idx&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// borra el índice por su nombre</span>
</code></pre></div>
<h4 id="rendimiento">Rendimiento<a class="headerlink" href="#rendimiento" title="Permanent link">&para;</a></h4>
<p>En cuanto al rendimiento, algunos de los operadores que no utilizan los índices eficientemente son los operadores <code>$where</code>, <code>$nin</code> y <code>$exists</code>. Cuando estos operadores se emplean en una consulta hay que tener en mente un posible cuelo de botella cuando el tamaño de los datos incremente.</p>
<p>Al explicar los índices ya hemos visto que podemos obtener información sobre la operación realizada mediante el método <a href="http://docs.mongodb.org/manual/reference/method/cursor.explain/"><code>explain()</code></a>.</p>
<p>El atributo <code>indexOnly</code> nos dice si toda la información que queremos recuperar se encuentra en el índice. Este atributo va a depender de los campos que quiera que me devuelva la consulta, si son un subconjunto del índice utilizado.</p>
<p>Como los índices consumen espacio en disco y memoria, es importante vigilar y planificar su uso, para no sobrepasar las prestaciones de nuestro sistema, de manera que sólo utilicemos índices cuando tengamos consultas que se repiten en el tiempo y que empiezan a ser lentas.</p>
<div class="admonition importante">
<p class="admonition-title">Vigilar la RAM</p>
<p><strong>Los índices deben caber en memoria</strong>.</p>
<p>Para averiguar el tamaño de los índices (en bytes):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">stats</span><span class="p">()</span><span class="w">  </span><span class="c1">// obtiene estadísticas de la colección</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">totalIndexSize</span><span class="p">()</span><span class="w">  </span><span class="c1">// obtiene el tamaño de los índices</span>
</code></pre></div>
</div>
<p>No obstante, si los índices están en disco, pese a ser algorítmicamente mejores que no tener, al ser más grandes que la RAM disponible, no se obtienen beneficios por la penalización de la paginación.</p>
<p>Mucho cuidado con los índices multiclave porque crecen fácilmente, y si el documento tiene que moverse a disco, el cambio supone tener que cambiar todos los puntos de índice del array.
Aunque sea más responsabilidad de un administrador de bases de datos (DBA), los desarrolladores debemos saber si el índice va a caber en memoria. Si no van a caber es mejor no usarlos.</p>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>Hemos actualizado un documento con una clave llamada <code>etiquetas</code> que provoca que el documento tenga que moverse a disco. Supongamos que el documento contiene 10.000 etiquetas en él y que el array de <code>etiquetas</code> está indexada con un índice multiclave.</p>
<p>¿Cuantos elementos tienen que actualizarse en el índice para acomodar el movimiento? <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
</div>
<h4 id="forzando-indices">Forzando índices<a class="headerlink" href="#forzando-indices" title="Permanent link">&para;</a></h4>
<p>Si en algún momento queremos forzar el uso de un determinado índice al realizar una consulta, necesitaremos usar el método <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.hint/"><code>hint({campo:1}</code></a></p>
<p>Si queremos que se utilice el índice asociado a la propiedad twitter:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="s2">&quot;aitormedrano&quot;</span><span class="p">}).</span><span class="nx">hint</span><span class="p">({</span><span class="nx">twitter</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<p>Si por algún motivo no queremos usar índices y forzar un escaneo de toda la colección, le pasaremos el operador <code>$natural</code> al método <code>hint()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">iabd</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="s2">&quot;aitormedrano&quot;</span><span class="p">}).</span><span class="nx">hint</span><span class="p">({</span><span class="nx">$natural</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<p>Si usamos un <em>hint</em> sobre un índice <em>sparse</em> y no hay documentos a devolver con dicho índice porque todos sus campos son nulos, la consulta no devolverá nada, aunque haya documentos que sin dicho índice si cumplen los criterios.</p>
<p>Un caso particular que conviene destacar es cuando utilizamos los los operadores <code>$gt</code>, <code>$lt</code>, <code>$ne</code> …, los cuales provocan un uso ineficiente de los índices, al tener que recorrer toda la colección de índices. Si hacemos una consulta sobre varios atributos y en uno de ellos usamos <code>$gt</code>, <code>$lt</code> o similar, es mejor hacer un <em>hint</em> sobre el resto de atributos que sí tienen una selección directa.</p>
<p>Por ejemplo, supongamos que en la colección de <em>zips</em> quieséramos obtener las poblaciones del estado de Alabama (<code>AL</code>) que tienen una población comprendida entre 10000 y 50000:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$gt</span><span class="o">:</span><span class="mf">10000</span><span class="p">,</span><span class="w"> </span><span class="nx">$lte</span><span class="o">:</span><span class="mf">50000</span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;AL&quot;</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<p>Para esta consulta, suponiendo que tenemos un índice tanto en <code>pop</code> como en <code>state</code>, sería conveniente hacer el <em>hint</em> sobre el <code>state</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">zips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$gt</span><span class="o">:</span><span class="mf">10000</span><span class="p">,</span><span class="w"> </span><span class="nx">$lte</span><span class="o">:</span><span class="mf">50000</span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;AL&quot;</span><span class="w"> </span><span class="p">}).</span><span class="nx">hint</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
<h2 id="colecciones-limitadas">Colecciones limitadas<a class="headerlink" href="#colecciones-limitadas" title="Permanent link">&para;</a></h2>
<p>Una colección <a href="https://docs.mongodb.org/manual/core/capped-collections/">limitada</a> (<em>capped collection</em>) es una colección de tamaño fijo (por cantidad de documentos o tamaño de la colección), donde se garantiza el orden natural de los datos, es decir, el orden en que se insertaron.</p>
<p>Una vez se llena la colección, se eliminan los datos más antiguos, y los datos más recientes se añaden al final, de manera similar a un <em>buffer</em> circular, asegurando que el orden natural de la colección sigue el que se insertaron los registros.</p>
<p>Este tipo de colecciones se utilizan para logs y auto-guardado de información, ya que su rendimiento es muy alto para inserciones, permitiendo obtener datos similares a "<em>logs de la última hora</em>".</p>
<p>Se crean de manera explícita mediante el método <code>createCollection</code>, pasándole el tamaño en <em>bytes</em> de la colección y valor <code>capped</code> a <code>true</code>. Por ejemplo, si queremos crear una colección para auditar datos de 20 KB haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s2">&quot;auditoria&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">capped</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="mf">20480</span><span class="p">})</span>
</code></pre></div>
<p>Los documentos que se añaden a una colección limitada se pueden modifican, pero no pueden crecer en tamaño. Si sucede, la modificación fallará. Además, tampoco se pueden eliminar documentos de la colección. Para ello, hay que borrar toda la colección (<code>drop</code>) y volver a crearla.</p>
<p>También podemos limitar el número de elementos que se pueden añadir a la colección mediante el parámetro <code>max</code> en la creación de la colección. Sin embargo, hay que asegurarse de disponer de suficiente espacio en la colección para los elementos que queremos añadir. Si la colección se llena antes de que el número de elementos se alcance, se eliminará el elemento más antiguo de la colección.</p>
<p>Si retomamos el ejemplo anterior, pero fijamos su máximo a 100 elementos, crearíamos la colección del siguiente modo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s2">&quot;auditoria&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">capped</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="mf">20480</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="o">:</span><span class="mf">100</span><span class="p">})</span>
</code></pre></div>
<p>El shell de <em>MongoDB</em> ofrece la utilidad <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.validate/"><code>validate()</code></a> para comprobar la consistencia de la colección, ya sea limitada o no. Para comprobar el estado de la colección anterior haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">auditoria</span><span class="p">.</span><span class="nx">validate</span><span class="p">()</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">ns</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;iabd.auditoria&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">nInvalidDocuments</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nx">nNonCompliantDocuments</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="nx">nrecords</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="nx">nIndexes</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nx">keysPerIndex</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id_</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="nx">indexDetails</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id_</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">valid</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="nx">valid</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nx">repaired</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="nx">warnings</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="nx">errors</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="nx">extraIndexEntries</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="nx">missingIndexEntries</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="nx">corruptRecords</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="linenos" data-linenos="17 "></span><span class="w">    </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Si queremos consultar los datos de una colección limitada, por su idiosincrasia, los resultados aparecerán en el orden de inserción. Si queremos obtenerlos en orden inverso, le tenemos que pasar el operador <code>$natural</code> al método <code>sort()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">auditoria</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span><span class="w"> </span><span class="c1">// orden natural</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">auditoria</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">({</span><span class="w"> </span><span class="nx">$natural</span><span class="o">:-</span><span class="mf">1</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// orden inverso</span>
</code></pre></div>
<p>Finalmente, si queremos averiguar si una colección es limitada, disponemos d el método <code>isCapped()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">auditoria</span><span class="p">.</span><span class="nx">isCapped</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</code></pre></div>
<p>De forma alternativa, podríamos utilizar un índice TTL dentro de una colección ordinaria, pero perderíamos
parte de las prestaciones que ofrecen las colecciones <em>capped</em>.</p>
<h2 id="profiling">Profiling<a class="headerlink" href="#profiling" title="Permanent link">&para;</a></h2>
<div class="admonition info inline end">
<p class="admonition-title">Trabajando en local</p>
<p>Para poder trabajar el <em>profiling</em>, no podemos hacerlo mediante <em>MongoDB Atlas</em>. Por ello, se recomienda utilizar una instalación en local o mediante un contenedor Docker.</p>
</div>
<p>MongoDB incorpora varias herramientas para el control del rendimiento.</p>
<p>Por ejemplo, la colección <code>db.system.profile</code> auditará las consultas ejecutadas. Podemos indicar el nivel de las consultas a auditar mediante tres niveles: <code>0</code> (ninguna), <code>1</code> (consultas lentas), <code>2</code> (todas las consultas)</p>
<p>Si queremos que se auditen todas las consultas, lo indicaremos del siguiente modo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">setProfilingLevel</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">was</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">slowms</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">sampleRate</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>El método <code>setProfilingLevel()</code> también admite un segundo parámetro para indicar el numero mínimo de milisegundos de las consultas para ser auditadas.</p>
<p>Por defecto, <em>MongoDB</em> automáticamente escribe en el log las consultas que tardan más de 100ms.
Si queremos indicar estas propiedades al arrancar el demonio, le pasaremos los parámetros <code>--profile</code> y/o <code>--slowms</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">mongod</span><span class="w"> </span><span class="o">--</span><span class="nx">profile</span><span class="o">=</span><span class="mf">1</span><span class="w"> </span><span class="o">--</span><span class="nx">slowms</span><span class="o">=</span><span class="mf">15</span>
</code></pre></div>
<p>Si en algún momento queremos consultar el estado del <em>profiling</em> podemos utilizar <code>db.getProfilingStatus()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">getProfilingStatus</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">was</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">slowms</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">sampleRate</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Sobre los datos auditados, podemos hacer <code>find</code> sobre <code>db.system.profile</code> y filtrar por los campos mostrados:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">system</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">millis</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="nx">ts</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">})</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">system</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">limit</span><span class="p">(</span><span class="mf">10</span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ts</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="nx">pretty</span><span class="p">()</span>
</code></pre></div>
<p>Dentro de estas consultas algunos campos significativos son:</p>
<ul>
<li><code>op</code>: tipo de operación, ya sea <code>command</code>, <code>query</code>, <code>insert</code>, …</li>
<li><code>millis</code>: tiempo empleado en la operación</li>
<li><code>ts</code>: <em>timestamp</em> de la operación</li>
</ul>
<p>Podéis consultar todos los campos disponibles en <a href="http://docs.mongodb.org/manual/reference/database-profiler/">http://docs.mongodb.org/manual/reference/database-profiler/</a></p>
<p>Otras herramientas para controlar el rendimiento que se ejecutan en un terminal, son:</p>
<ul>
<li>
<p><a href="http://docs.mongodb.org/manual/reference/program/mongotop/"><code>mongotop</code></a> → similar a la herramienta <code>top</code> de UNIX, muestra el tiempo empleado por MongoDB en las diferentes colecciones, indicando tanto el tiempo empleado en lectura como en escrituras. Para ello, si queremos se ejecute cada tres segundos, en un terminal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>mongotop<span class="w"> </span><span class="m">3</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">                    </span>ns<span class="w">    </span>total<span class="w">    </span><span class="nb">read</span><span class="w">    </span>write<span class="w">    </span><span class="m">2023</span>-10-11T18:45:17Z
<span class="linenos" data-linenos=" 4 "></span><span class="w">        </span>admin.atlascli<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span>admin.system.version<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span>config.collections<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos=" 7 "></span>config.system.sessions<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">   </span>config.transactions<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">        </span>iabd.auditoria<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos="10 "></span><span class="w">         </span>iabd.contacto<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span>iabd.restaurants<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos="12 "></span><span class="w">   </span>iabd.system.profile<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w">                        </span>
<span class="linenos" data-linenos="13 "></span><span class="w">          </span>iabd.usuario<span class="w">      </span>0ms<span class="w">     </span>0ms<span class="w">      </span>0ms<span class="w"> </span>
</code></pre></div>
<!--
db.zips.find({ "pop":{$gt:10000, $lte:50000}, "state":{$in: ["AL","AK","AZ","CA"] }})
-->
</li>
<li>
<p><a href="http://docs.mongodb.org/manual/reference/program/mongostat/"><code>mongostat</code></a> → muestra el número de operaciones por cada tipo que se realizan por segundo a nivel de servidor, lo que nos da una instantánea de los que está haciendo el servidor.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>mongostat<span class="w"> </span><span class="m">5</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>insert<span class="w"> </span>query<span class="w"> </span>update<span class="w"> </span>delete<span class="w">  </span>getmore<span class="w"> </span><span class="nb">command</span><span class="w"> </span>dirty<span class="w"> </span>used<span class="w"> </span>flushes<span class="w"> </span>vsize<span class="w">  </span>res<span class="w"> </span>qrw<span class="w"> </span>arw<span class="w"> </span>net_in<span class="w"> </span>net_out<span class="w"> </span>conn<span class="w">                </span><span class="nb">time</span>
<span class="linenos" data-linenos=" 4 "></span>*0<span class="w">    </span>*0<span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.0%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>111b<span class="w">   </span><span class="m">59</span>.8k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:20.551
<span class="linenos" data-linenos=" 5 "></span>*0<span class="w">     </span><span class="m">1</span><span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">2</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.1%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>329b<span class="w">   </span><span class="m">64</span>.3k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:25.550
<span class="linenos" data-linenos=" 6 "></span>*0<span class="w">    </span>*0<span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">1</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.1%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>259b<span class="w">   </span><span class="m">60</span>.1k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:30.550
<span class="linenos" data-linenos=" 7 "></span>*0<span class="w">    </span>*0<span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">2</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.1%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>289b<span class="w">   </span><span class="m">61</span>.9k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:35.540
<span class="linenos" data-linenos=" 8 "></span>*0<span class="w">    </span>*0<span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">3</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.1%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>353b<span class="w">   </span><span class="m">60</span>.3k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:40.547
<span class="linenos" data-linenos=" 9 "></span>*0<span class="w">    </span>*0<span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">2</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.1%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>246b<span class="w">   </span><span class="m">60</span>.2k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:45.547
<span class="linenos" data-linenos="10 "></span>*0<span class="w">    </span>*0<span class="w">     </span>*0<span class="w">     </span>*0<span class="w">       </span><span class="m">0</span><span class="w">     </span><span class="m">1</span><span class="p">|</span><span class="m">0</span><span class="w">  </span><span class="m">0</span>.1%<span class="w"> </span><span class="m">7</span>.6%<span class="w">       </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>.75G<span class="w"> </span>399M<span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">|</span><span class="m">0</span><span class="w">   </span>112b<span class="w">   </span><span class="m">59</span>.9k<span class="w">   </span><span class="m">21</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">18</span>:46:50.545<span class="w">  </span>
</code></pre></div>
</li>
</ul>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li>Curso <a href="https://learn.mongodb.com/courses/m201-mongodb-performance">M201: MongoDB Performance</a> de <em>MongoDB University</em></li>
<li>Libro <a href="https://learning.oreilly.com/library/view/mongodb-the-definitive/9781491954454/">MongoDB: The Definitive Guide, 3rd Edition</a> de <em>Shannon Bradshaw</em>, <em>Eoin Brazil</em> y <em>Kristina Chodorow</em>.</li>
<li>Libro <a href="https://learning.oreilly.com/library/view/mastering-mongodb-6-x/9781803243863/">Mastering MongoDB 6.x - Third Edition</a> de <em>Alex Giamas</em>.</li>
</ul>
<h2 id="actividades">Actividades<a class="headerlink" href="#actividades" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>(<abbr title="Realiza el seguimiento de la monitorización de un sistema, asegurando la fiabilidad y estabilidad de los servicios que se proveen.">RABDA.4</abbr> / <abbr title="Se han aplicado herramientas de monitorización eficiente de los recursos.">CEBDA.4a</abbr>, <abbr title="Se han recogido métricas, procesamiento y visualización de los datos.">CEBDA.4b</abbr> / 3.5p) Para la siguiente actividad, se recomienda trabajar con una instalación de <em>MongoDB</em> en local, ya sea mediante <em>Docker</em> o una instalación propia.</p>
<p>Tenemos los datos de 1.000.000 de restaurantes con una estructura similar al siguiente documento:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;65291f2d09ae7e23eba2b3df&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Perry</span><span class="w"> </span><span class="err">S</span><span class="kc">treet</span><span class="w"> </span><span class="err">Brasserie&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="err">cuisi</span><span class="kc">ne</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Fre</span><span class="kc">n</span><span class="err">ch&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="err">s</span><span class="kc">tars</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="err">address</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="err">s</span><span class="kc">treet</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">959</span><span class="w"> </span><span class="err">Ive</span><span class="kc">n</span><span class="err">o</span><span class="w"> </span><span class="err">Square&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="err">ci</span><span class="kc">t</span><span class="err">y</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Fokemlid&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="err">s</span><span class="kc">tate</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;AL&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="err">zipcode</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">18882</span><span class="err">&#39;</span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="12 "></span><span class="p">}</span>
</code></pre></div>
<p>Nos han dicho que les interesa optimizar las siguientes consultas, en las cuales no utilizan el <em>framework</em> de agregación:</p>
<ol>
<li>Obtener la cantidad de restaurantes de un determinado tipo de cocina para un estado determinado que tenga una calificación superior a 3 estrellas.</li>
<li>Obtener los datos de los restaurantes de un determinado tipo de cocina para un estado determinado que tenga una calificación comprendida entre dos valores y ordenar dichos datos por la ciudad.</li>
<li>Obtener los datos de los restaurantes de una determinada ciudad que sea de un tipo de cocina, ordenados por la cantidad de estrellas.</li>
</ol>
<p>Así pues, se pide adjuntar los comandos empleados y capturas de pantalla para:</p>
<ol>
<li>Carga los datos almacenados en <a href="resources/restaurants.zip"><code>restaurants.zip</code></a> en la colección <code>iabd.restaurants</code>.</li>
<li>Habilita la auditoria de <em>MongoDB</em> para registrar las consultas que tardan más de 90ms.</li>
<li>Ejecuta <code>mongotop 3</code> para comprobar el rendimiento de la colección <code>iabd.restaurants</code></li>
<li>Comprueba el rendimiento mediante el plan de ejecución de las diferentes consultas.</li>
<li>Comprueba qué consulta es la que más tarda utilizando <code>db.system.profile</code>.</li>
<li>Crea los índices necesarios para optimizar las consultas y justifica la elección del tipo de índices y sus campos.</li>
<li>Comprueba que se utilizan los índices mediante los planes de ejecución y compara el rendimiento actual respecto al previo al crear los índices.</li>
</ol>
</li>
<li>
<p>(<abbr title="Realiza el seguimiento de la monitorización de un sistema, asegurando la fiabilidad y estabilidad de los servicios que se proveen.">RABDA.4</abbr> / <abbr title="Se han recogido métricas, procesamiento y visualización de los datos.">CEBDA.4b</abbr> / 0.5p) Supongamos que tenemos un índice similar al siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dir.provincia&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dir.ciudad&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Identifica los prefijos que se utilizarán (si lo hacen) para las siguientes consultas y justifica el motivo, tanto al filtrar como al ordenar los resultados:</p>
<ol>
<li><code class="highlight"><span class="nx">db</span><span class="p">.</span><span class="nx">alumnado</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;P&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;dir.ciudad&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span></code></li>
<li><code class="highlight"><span class="nx">db</span><span class="p">.</span><span class="nx">alumnado</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Marina&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;dir.provincia&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dir.ciudad&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span></code></li>
<li><code class="highlight"><span class="nx">db</span><span class="p">.</span><span class="nx">alumnado</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Marina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dir.provincia&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$lt</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;dir.provincia&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span></code></li>
<li><code class="highlight"><span class="nx">db</span><span class="p">.</span><span class="nx">alumnado</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;dir.ciudad&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Elche&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;dir.ciudad&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span></code></li>
<li><code class="highlight"><span class="nx">db</span><span class="p">.</span><span class="nx">alumnado</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;dir.provincia&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alicante&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Marina&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;dir.ciudad&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span></code></li>
</ol>
<!--
a. No, no hay igualdad en el nombre
b. sólo el nombre / se utilizan los tres, los ordenes son inversos pero coinciden
c. solo el nombre al filtrar y la provincia al ordenar
d. no
e. perfecta, da igual que el orden de los atributos en el filtrado no coincida con el índice
-->
</li>
</ol>
<p>Actividades de ampliación:</p>
<ol start="3">
<li>
<p>(<abbr title="Realiza el seguimiento de la monitorización de un sistema, asegurando la fiabilidad y estabilidad de los servicios que se proveen.">RABDA.4</abbr> / <abbr title="Se han recogido métricas, procesamiento y visualización de los datos.">CEBDA.4b</abbr> / 0.5p) Realiza las siguientes acciones anotando el comando necesario:</p>
<ol>
<li>Crea un colección llamada <code>nombres</code>.</li>
<li>Añade 5 documentos con tu nombre con diferentes combinaciones de mayúsculas y minúsculas, pero ninguno que esté todo en minúsculas.</li>
<li>Crea una consulta que busque tu nombre en minúsculas.</li>
<li>Crea un índice con el <em>locale</em> en español sobre el nombre.</li>
<li>Repite la consulta del punto 3 y comprueba cómo devuelve todos los documentos existentes.</li>
</ol>
</li>
<li>
<p>(<abbr title="Realiza el seguimiento de la monitorización de un sistema, asegurando la fiabilidad y estabilidad de los servicios que se proveen.">RABDA.4</abbr> / <abbr title="Se han recogido métricas, procesamiento y visualización de los datos.">CEBDA.4b</abbr> / 0.5p) Investiga para qué sirven los <a href="https://www.mongodb.com/docs/manual/core/index-hidden/">índices ocultos</a> en <em>MongoDB</em>, indicando al menos dos casos de uso donde tiene sentido su utilización.</p>
</li>
</ol>
<!--

En la colección de sample_airbnb.listingsAndReviews, ¿pq una consulta funciona y la otra no?

db.listingsAndReviews.find({"property_type":"Apartment"}).sort("beds")
db.listingsAndReviews.find({"property_type":"Apartment"}).sort("minimun_nights")

https://learning.oreilly.com/library/view/mastering-mongodb-6-x/9781803243863/B18155_08.xhtml#_idParaDest-139
-->

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>10.000, es decir, todos los valores existentes en el índice multiclave.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        <a href='https://ko-fi.com/T6T8GWT9N' title='Invítame a un café en ko-fi.com' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Invítame a un café en ko-fi.com' /></a>
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="Me encantan estos apuntes" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="Los apuntes son mejorables" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Gracias por tu tiempo. Si quieres me puedes <a href='https://ko-fi.com/T6T8GWT9N'>invitar a un café en ko-fi</a>.
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              ¡Gracias por tu colaboración! Ayúdame a mejorar los apuntes enviándome un mail a <a href="mailto:a.medrano@edu.gva.es">a.medrano@edu.gva.es</a> con tus comentarios.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="agregaciones.html" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Agregaciones en MongoDB">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Agregaciones en MongoDB
              </div>
            </div>
          </a>
        
        
          
          <a href="replicacion.html" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Replicación y particionado">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                Replicación y particionado
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Aitor Medrano - <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es">Licencia CC BY-NC-SA</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://aitor-medrano.github.io/" target="_blank" rel="noopener" title="aitor-medrano.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.top", "navigation.tracking", "navigation.footer", "navigation.indexes", "content.code.annotate", "announce.dismiss", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>