
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Uso de series temporales con MongoDB para almacenar datos proveniente de IoT">
      
      
      
        <link rel="canonical" href="https://aitor-medrano.github.io/iabd/sa/series-temporales.html">
      
      
        <link rel="prev" href="pymongo.html">
      
      
        <link rel="next" href="../cloud/cloud.html">
      
      
      <link rel="icon" href="../favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.1">
    
    
      
        <title>Series temporales con MongoDB - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.45e1311d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VKM8BDY6KT"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VKM8BDY6KT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VKM8BDY6KT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Series temporales con MongoDB - Inteligencia Artificial y Big Data" >
      
        <meta  property="og:description"  content="Uso de series temporales con MongoDB para almacenar datos proveniente de IoT" >
      
        <meta  property="og:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/sa/series-temporales.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aitor-medrano.github.io/iabd/sa/series-temporales.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Series temporales con MongoDB - Inteligencia Artificial y Big Data" >
      
        <meta  name="twitter:description"  content="Uso de series temporales con MongoDB para almacenar datos proveniente de IoT" >
      
        <meta  name="twitter:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/sa/series-temporales.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creando-una-serie-temporal" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Series temporales con MongoDB
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2324.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning 23/24
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NoSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            NoSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nosql.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento de datos. NoSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="modelado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelado documental
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones en MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rendimiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendimiento
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="replicacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replicación y particionado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pymongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB y Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Series temporales
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="series-temporales.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Series temporales
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creando-una-serie-temporal" class="md-nav__link">
    <span class="md-ellipsis">
      Creando una serie temporal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creando una serie temporal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelos-de-ejemplo" class="md-nav__link">
    <span class="md-ellipsis">
      Modelos de ejemplo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consideraciones" class="md-nav__link">
    <span class="md-ellipsis">
      Consideraciones
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrando-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Migrando datos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agregando-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Agregando datos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-un-grafico" class="md-nav__link">
    <span class="md-ellipsis">
      Creando un gráfico
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/cloud.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/aws.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/s3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/ec2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/lambda.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/rds.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/dynamodb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DynamoDB
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/waf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WAF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/escalado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitorización y Escalado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/athena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Athena
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/emr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMR
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingeniería de Datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Ingeniería de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/de.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingeniería de datos
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/arq.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arquitecturas Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/etl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingesta de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/pentaho.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pentaho
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/formatos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formatos de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/faker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Faker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ecosistema Hadoop
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ecosistema Hadoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hadoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hadoop
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hdfs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/sqoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sqoop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/flume.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flume
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hive1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive I
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hive2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive II
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/spark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ecosistema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/rdd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/dataframeAPI.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataFrames API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/catalog.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark JDBC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/deltalake.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Lake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/streaming.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/join-window.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming II
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../dataflow/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Flujo de datos
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Flujo de datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/airflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pia/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    PIA
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            PIA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            Lara 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/01presentacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/02requisitos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prototipado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/03visitaVK.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Victoria Kent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/04almacenamiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/05audio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento audio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            Lara 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/21conociendo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Lara
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/22captura.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capturando audios
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/06autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/07navarrosantafe.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/08timeseries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_5" >
        
          
          <label class="md-nav__link" for="__nav_9_5" id="__nav_9_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_5">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/23autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Autoponic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/24nodered.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node-RED
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/25villena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../blog/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archivo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            Archivo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categorías
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            Categorías
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/diciembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diciembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noticias.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noticias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noviembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noviembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/octubre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octubre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/septiembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Septiembre
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creando-una-serie-temporal" class="md-nav__link">
    <span class="md-ellipsis">
      Creando una serie temporal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creando una serie temporal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelos-de-ejemplo" class="md-nav__link">
    <span class="md-ellipsis">
      Modelos de ejemplo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consideraciones" class="md-nav__link">
    <span class="md-ellipsis">
      Consideraciones
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrando-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Migrando datos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agregando-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Agregando datos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-un-grafico" class="md-nav__link">
    <span class="md-ellipsis">
      Creando un gráfico
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <a href="../tags.html#mongodb" class="md-tag">MongoDB</a>
    
  
</nav>



  <h1>Series temporales</h1>

<p>Los datos almacenados como series temporales se caracterizan por su secuencia cronológica y alta frecuencia de creación. Las series temporales se emplean principalmente para la predicción y análisis de tendencias en muchos servicios financieros y aplicaciones IoT.</p>
<p>Desde la versión 5.0, <em>MongoDB</em> permite crear un tipo de colección específica para este tipo de datos. Estas colecciones <a href="https://www.mongodb.com/docs/manual/core/timeseries-collections/"><em>time series</em></a> definen una estructura y emplean una serie de índices que reducen el espacio necesario y aceleran las consultas que se realizan sobre los datos.</p>
<p>Las colecciones de series temporales se crean de forma explícita, y no podemos convertir una colección ordinaria a serie temporal. Eso sí, podemos programar un <em>script</em> para migrar los datos de una colección normal a una serie temporal.</p>
<h2 id="creando-una-serie-temporal">Creando una serie temporal<a class="headerlink" href="#creando-una-serie-temporal" title="Permanent link">&para;</a></h2>
<p>A la hora de <a href="https://www.mongodb.com/docs/manual/core/timeseries/timeseries-procedures/">crear la colección</a>, necesitamos indicar los siguiente campos:</p>
<ul>
<li><strong><code>timeField</code></strong>: campo obligatorio que almacena el <em>timestamp</em> del dato. Debe ser un objeto <code>Date()</code>.</li>
<li><strong><code>metaField</code></strong>: campo opcional que indica dónde se almacenan los metadatos que describen la serie. Este campo puede contener un documento embebido o el dato único de valor, y normalmente identifica al sensor. Debe ser un valor que raramente cambie de valor y se puede utilizar como la segunda dimensión para filtrar los datos (considerando que la primera será el tiempo). Este campo <code>metaField</code> va a servir para particionar los datos, de manera que aquellos documentos que tengan el mismo <code>metaField</code> estarán en la misma partición.</li>
<li><code>granularity</code>: campo opcional que ayuda a <em>MongoDB</em> a optimizar el almacenamiento al definir la frecuencia de los datos. Sus posibles valores son <code>seconds</code> (valor por defecto que se aplica si no indicamos la granularidad), <code>minutes</code> o <code>hours</code> y debe configurarse al valor más cercano entre dos lectura consecutivas de datos. Por ejemplo, si realizásemos una lectura del sensor cada cinco minutos, la granularidad debería ser <code>minutes</code>.</li>
<li><code>expireAfterSeconds</code>: campo opcional, indicando la cantidad de segundos a partir de la creación del dato que MongoDB esperará para borrarlo automáticamente.</li>
</ul>
<p>Por ejemplo, vamos a crear una colección llamada <code>serietemporal</code> indicando el campo donde estará el <em>timestamp</em> y el de los metadatos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;serietemporal&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="nx">timeseries</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span><span class="w">        </span><span class="nx">timeField</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span><span class="w">        </span><span class="nx">metaField</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metadata&quot;</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="p">})</span>
</code></pre></div>
<p>A continuación, ya podemos añadirle datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">serietemporal</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">(</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">   </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">      </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">         </span><span class="s2">&quot;sensorId&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1234</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">         </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;temperatura&quot;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2023-11-07T00:00:00.000Z&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="s2">&quot;temp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">16</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">   </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">   </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="12 "></span><span class="w">         </span><span class="s2">&quot;sensorId&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1234</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span><span class="w">         </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;temperatura&quot;</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2023-11-07T04:00:00.000Z&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="s2">&quot;temp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">14</span>
<span class="linenos" data-linenos="17 "></span><span class="w">   </span><span class="p">},</span>
<span class="linenos" data-linenos="18 "></span><span class="w">   </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">      </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="20 "></span><span class="w">         </span><span class="s2">&quot;sensorId&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1234</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">         </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;temperatura&quot;</span>
<span class="linenos" data-linenos="22 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="23 "></span><span class="w">      </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2023-11-07T08:00:00.000Z&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos="24 "></span><span class="w">      </span><span class="s2">&quot;temp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">13</span>
<span class="linenos" data-linenos="25 "></span><span class="w">   </span><span class="p">}</span>
<span class="linenos" data-linenos="26 "></span><span class="p">])</span>
</code></pre></div>
<p>Y obtener los datos como en una colección normal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">serietemporal</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2023-11-07T00:00:00.000Z&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<p>Obteniendo el documento:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="kc">t</span><span class="err">imes</span><span class="kc">ta</span><span class="err">mp</span><span class="p">:</span><span class="w"> </span><span class="mi">2023-11-07</span><span class="err">T</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="err">Z</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="err">me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="err">se</span><span class="kc">ns</span><span class="err">orId</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="kc">te</span><span class="err">mpera</span><span class="kc">tura</span><span class="err">&#39;</span>
<span class="linenos" data-linenos="6 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="7 "></span><span class="w">  </span><span class="kc">te</span><span class="err">mp</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span>
<span class="linenos" data-linenos="8 "></span><span class="w">  </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;654a35e782c4b36cdaf13b6f&quot;</span><span class="err">)</span>
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<p>Si visualizamos la colección desde <em>MongoDB Compass</em> o <em>MongoAtlas</em> veremos que aparece una pequeña leyenda informando que la colección es de tipo <em>time-series</em>:</p>
<figure style="align: center;">
    <img src="images/09time-series-mongoatlas.png" title="Colección de tipo Time-Series">
    <figcaption>Colección de tipo Time-Series</figcaption>
</figure>

<h3 id="modelos-de-ejemplo">Modelos de ejemplo<a class="headerlink" href="#modelos-de-ejemplo" title="Permanent link">&para;</a></h3>
<p>A la hora de modelar los datos, algunos modelos de datos de ejemplo posibles podrían ser:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">IoT</label><label for="__tabbed_1_2">Bolsa / Valores de acciones</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;ts&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">ISODa</span><span class="kc">te</span><span class="err">(</span><span class="s2">&quot;2021-05-20T10:24:51.303Z&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">      </span><span class="nt">&quot;sensorId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alicante&quot;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nt">&quot;presionAire&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="w"> </span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="nt">&quot;velocidadViento&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="nt">&quot;temperatura&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="nt">&quot;gradosF&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">39</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="nt">&quot;gradosC&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.8</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;6166df318f32e5d3ed304fc7&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="kc">t</span><span class="err">imes</span><span class="kc">ta</span><span class="err">mp</span><span class="p">:</span><span class="w"> </span><span class="err">ISODa</span><span class="kc">te</span><span class="err">(</span><span class="s2">&quot;2023-10-13T00:00:00.000Z&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="err">me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;AMZN&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="err">mo</span><span class="kc">ne</span><span class="err">da</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Dolar&#39;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="err">precio</span><span class="p">:</span><span class="w"> </span><span class="mf">142.83</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;6166df318f32e5d3ed304fc5&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="kc">t</span><span class="err">imes</span><span class="kc">ta</span><span class="err">mp</span><span class="p">:</span><span class="w"> </span><span class="err">ISODa</span><span class="kc">te</span><span class="err">(</span><span class="s2">&quot;2023-10-13T00:00:00.000Z&quot;</span><span class="err">)</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="err">me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;AAPL&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="err">mo</span><span class="kc">ne</span><span class="err">da</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Dolar&#39;</span>
<span class="linenos" data-linenos="16 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="err">precio</span><span class="p">:</span><span class="w"> </span><span class="mf">189.71</span>
<span class="linenos" data-linenos="18 "></span><span class="p">},</span><span class="w"> </span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="consideraciones">Consideraciones<a class="headerlink" href="#consideraciones" title="Permanent link">&para;</a></h2>
<p>Las colecciones de series temporales crean y utilizan un índice interno. Además, si fuera necesario, podemos crear índices adicionales, a los que se les conoce como índices secundarios.</p>
<p>Las colecciones de series temporales se asocian a casos de uso donde los datos se insertan una vez, se leen muchas veces y raramente se actualizan.</p>
<p>Es por ello, que las operaciones de modificación y borrado en las series temporales necesitan del operador <code>{multi:true}</code> y <code>{justOne:false}</code> para aplicarse sobre múltiples documentos, y la consulta a modificar o borrar sólo debe hacerlo sobre los campos del subdocumento del atributo <code>metaField</code>. Así pues, sólo podemos modificar el subdocumento del campo <code>metaField</code> y no podemos emplear una operación <code>upsert</code>.</p>
<div class="admonition caution">
<p class="admonition-title">Cuidado</p>
<p>El tamaño máximo de un documento en una serie temporal es de 4MB, no los 16 de un documento ordinario.</p>
</div>
<p>Respecto al particionado, podemos emplear <code>timeField</code> o <code>metaField</code> con claves. Si utilizamos el <code>timeField</code>, al tratarse de un <em>timestamp</em>, todas las escrituras irán a la última partición. Por lo tanto, es una buena práctica combinar el <code>timeField</code> con uno o más campos del <code>metaField</code>.</p>
<h2 id="migrando-datos">Migrando datos<a class="headerlink" href="#migrando-datos" title="Permanent link">&para;</a></h2>
<p>En los datos de ejemplo cargados en <em>MongoDB</em>, tenemos una colección con datos climáticos. Por ejemplo, uno de los documentos de <code>sample_weatherdata.data</code> es similar a:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&quot;$oid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5553a998e4b02cf7151190b8&quot;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nt">&quot;st&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x+47600-047900&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="nt">&quot;$date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1984-03-05T13:00:00.000Z&quot;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Point&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="mf">-47.9</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="mf">47.6</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">]</span>
<span class="linenos" data-linenos="15 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="16 "></span><span class="w">  </span><span class="nt">&quot;elevation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="nt">&quot;callLetters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VCSZ&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="nt">&quot;qualityControlProcess&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;V020&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="nt">&quot;dataSource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FM-13&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">  </span><span class="nt">&quot;airTemperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-3.1</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="linenos" data-linenos="24 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="25 "></span><span class="w">  </span><span class="nt">&quot;dewPoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="26 "></span><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">999.9</span><span class="p">,</span>
<span class="linenos" data-linenos="27 "></span><span class="w">    </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span>
<span class="linenos" data-linenos="28 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="29 "></span><span class="w">  </span><span class="nt">&quot;pressure&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="30 "></span><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1015.3</span><span class="p">,</span>
<span class="linenos" data-linenos="31 "></span><span class="w">    </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="linenos" data-linenos="32 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="33 "></span><span class="w">  </span><span class="nt">&quot;wind&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="34 "></span><span class="w">    </span><span class="nt">&quot;direction&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="35 "></span><span class="w">      </span><span class="nt">&quot;angle&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">999</span><span class="p">,</span>
<span class="linenos" data-linenos="36 "></span><span class="w">      </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span>
<span class="linenos" data-linenos="37 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="38 "></span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="39 "></span><span class="w">    </span><span class="nt">&quot;speed&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="40 "></span><span class="w">      </span><span class="nt">&quot;rate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">999.9</span><span class="p">,</span>
<span class="linenos" data-linenos="41 "></span><span class="w">      </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span>
<span class="linenos" data-linenos="42 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="43 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="44 "></span><span class="w">  </span><span class="nt">&quot;visibility&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="45 "></span><span class="w">    </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="46 "></span><span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">999999</span><span class="p">,</span>
<span class="linenos" data-linenos="47 "></span><span class="w">      </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span>
<span class="linenos" data-linenos="48 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="49 "></span><span class="w">    </span><span class="nt">&quot;variability&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="50 "></span><span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="51 "></span><span class="w">      </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span>
<span class="linenos" data-linenos="52 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="53 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="54 "></span><span class="w">  </span><span class="nt">&quot;skyCondition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="55 "></span><span class="w">    </span><span class="nt">&quot;ceilingHeight&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="56 "></span><span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">99999</span><span class="p">,</span>
<span class="linenos" data-linenos="57 "></span><span class="w">      </span><span class="nt">&quot;quality&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="58 "></span><span class="w">      </span><span class="nt">&quot;determination&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span>
<span class="linenos" data-linenos="59 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="60 "></span><span class="w">    </span><span class="nt">&quot;cavok&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;N&quot;</span>
<span class="linenos" data-linenos="61 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="62 "></span><span class="w">  </span><span class="nt">&quot;sections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="63 "></span><span class="w">    </span><span class="s2">&quot;AG1&quot;</span>
<span class="linenos" data-linenos="64 "></span><span class="w">  </span><span class="p">],</span>
<span class="linenos" data-linenos="65 "></span><span class="w">  </span><span class="nt">&quot;precipitationEstimatedObservation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="66 "></span><span class="w">    </span><span class="nt">&quot;discrepancy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="67 "></span><span class="w">    </span><span class="nt">&quot;estimatedWaterDepth&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">999</span>
<span class="linenos" data-linenos="68 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="69 "></span><span class="p">}</span>
</code></pre></div>
<p>Por ejemplo, si quisiéramos trabajar con los datos de la temperatura del aire y colocarlos dentro de una serie temporal, el primero paso sería crear la colección</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">use</span><span class="w"> </span><span class="nx">iabd</span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;ts_weather&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="nx">timeseries</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="4 "></span><span class="w">        </span><span class="nx">timeField</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span><span class="w">        </span><span class="nx">metaField</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metadata&quot;</span>
<span class="linenos" data-linenos="6 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="7 "></span><span class="p">})</span>
</code></pre></div>
<p>Y a continuación, mediante el <em>framework</em> de agregación, migramos los datos que nos interesen. Por ejemplo, nos vamos a traer la temperatura del aire y la presión, así como algunos metadatos del sensor para aquellas muestras que no han superado los 100 grados de temperatura (así podríamos filtrar algunos <em>outliers</em>):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">MongoDB &gt;= v7.0.3</label><label for="__tabbed_2_2">MongoDB &lt; 7.0.3</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>A partir de la versión 7.0.3 podemos emplear el operador <code>$out</code> para exportar los datos a una colección de tipo <em>time series</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nx">use</span><span class="w"> </span><span class="nx">sample_weatherdata</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">      </span><span class="s2">&quot;airTemperature.value&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$project</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ts&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">        </span><span class="s2">&quot;posicion&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$position&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">        </span><span class="s2">&quot;elevacion&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$elevation&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="s2">&quot;tipo&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$type&quot;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="p">},</span><span class="w"> </span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="s2">&quot;temp_aire&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$airTemperature.value&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="s2">&quot;presion&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$pressure.value&quot;</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$out</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">      </span><span class="nx">db</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;iabd&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span><span class="w">      </span><span class="nx">coll</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ts_weather&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">      </span><span class="nx">timeseries</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">        </span><span class="nx">timeField</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span><span class="w">        </span><span class="nx">metaField</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metadata&quot;</span>
<span class="linenos" data-linenos="24 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="26 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="27 "></span><span class="p">])</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Si no, primero crearemos una colección únicamente con los datos deseados:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nx">use</span><span class="w"> </span><span class="nx">sample_weatherdata</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">      </span><span class="s2">&quot;airTemperature.value&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">}</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$project</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="s2">&quot;timestamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ts&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">        </span><span class="s2">&quot;posicion&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$position&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">        </span><span class="s2">&quot;elevacion&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$elevation&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="s2">&quot;tipo&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$type&quot;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="p">},</span><span class="w"> </span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="s2">&quot;temp_aire&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$airTemperature.value&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="s2">&quot;presion&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$pressure.value&quot;</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$out</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ts_weather&quot;</span><span class="p">}</span>
<span class="linenos" data-linenos="19 "></span><span class="p">])</span>
</code></pre></div>
<p>Y a continuación, debemos <a href="https://www.mongodb.com/docs/v6.0/core/timeseries/timeseries-migrate-data-into-timeseries-collection/#migrate-data-into-a-time-series-collection-1">exportar los datos y volver a importarlos</a>. Así pues, exportamos mediante <code>mongodump</code> desde <code>sample_weatherdata.ts_weather</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongodump<span class="w"> </span>--uri<span class="o">=</span><span class="s2">&quot;mongodb+srv://usuario:password@host/sample_weatherdata&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span>--collection<span class="o">=</span>ts_weather
</code></pre></div>
<p>e importamos con <code>mongorestore</code> en <code>iabd.ts_weather</code> (que es la colección de tipo serie temporal que hemos creado en un paso anterior):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongorestore<span class="w"> </span>--uri<span class="o">=</span><span class="s2">&quot;mongodb+srv://usuario:password@host/iabd&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span>--collection<span class="o">=</span>ts_weather<span class="w"> </span>--noIndexRestore<span class="w"> </span>--maintainInsertionOrder<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span>dump/sample_weatherdata/ts_weather.bson
</code></pre></div>
</div>
</div>
</div>
<p>Si cambiamos a la base de datos de <code>iabd</code>, podemos observar cómo se ha rellenado la colección de la serie temporal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">iabd</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="nx">switched</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">db</span><span class="w"> </span><span class="nx">iabd</span>
<span class="linenos" data-linenos=" 3 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">ts_weather</span><span class="p">.</span><span class="nx">findOne</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="mf">1984</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mo">05</span><span class="nx">T12</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="mf">.000</span><span class="nx">Z</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="nx">elevacion</span><span class="o">:</span><span class="w"> </span><span class="mf">9999</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="nx">posicion</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">        </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="10 "></span><span class="w">          </span><span class="mf">14</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">          </span><span class="mf">36.6</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="p">],</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="p">},</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">tipo</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;FM-13&#39;</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="17 "></span><span class="w">    </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;5553a998e4b02cf715119936&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos="18 "></span><span class="w">    </span><span class="nx">temp_aire</span><span class="o">:</span><span class="w"> </span><span class="mf">13</span><span class="p">,</span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="nx">presion</span><span class="o">:</span><span class="w"> </span><span class="mf">1008.5</span>
<span class="linenos" data-linenos="20 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<h2 id="agregando-datos">Agregando datos<a class="headerlink" href="#agregando-datos" title="Permanent link">&para;</a></h2>
<div class="admonition tip inline end">
<p class="admonition-title">Otros operadores de fecha</p>
<p>Además de <code>$dateToParts</code>, podemos emplear los operadores <a href="https://www.mongodb.com/docs/v7.0/reference/operator/aggregation/hour">$hour</a>, <a href="https://www.mongodb.com/docs/v7.0/reference/operator/aggregation/week/">$week</a>, <a href="https://www.mongodb.com/docs/v7.0/reference/operator/aggregation/dayOfYear/">$dayOfYear</a>, <a href="https://www.mongodb.com/docs/v7.0/reference/operator/aggregation/year/">$year</a>, etc... sobre un campo de tipo fecha / <em>timestamp</em>.</p>
</div>
<p>Es muy normal agrupar los datos en rangos de fechas sobre los que realizaremos cálculos. Para ello, podemos utilizar el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/dateToParts/"><code>$dateToParts</code></a> el cual recibe un campo <code>date</code> con un valor de tipo fecha/<em>timestamp</em>, y crea un documento con los diferentes campos por separado (año, mes, día, etc... ) mediante las propiedades <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code>, <code>second</code> y <code>millisecond</code>. Además, si lo necesitamos, podemos configurar también su <em>timezone</em>.</p>
<p>Por ejemplo, sobre la colección recién importada, vamos a agrupar los datos por días y calcularemos la temperatura media del aire:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="err">db.</span><span class="kc">ts</span><span class="err">_wea</span><span class="kc">t</span><span class="err">her.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">   </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">      </span><span class="err">$projec</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">         </span><span class="err">da</span><span class="kc">te</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos" data-linenos=" 5 "></span><span class="w">            </span><span class="err">$da</span><span class="kc">te</span><span class="err">ToPar</span><span class="kc">ts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">da</span><span class="kc">te</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$timestamp&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span class="linenos" data-linenos=" 6 "></span><span class="w">         </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">         </span><span class="kc">te</span><span class="err">mp_aire</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">   </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">   </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="err">$group</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="12 "></span><span class="w">         </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span><span class="w">            </span><span class="err">da</span><span class="kc">te</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span><span class="w">               </span><span class="err">year</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$date.year&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">               </span><span class="err">mo</span><span class="kc">nt</span><span class="err">h</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$date.month&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">               </span><span class="err">day</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$date.day&quot;</span>
<span class="linenos" data-linenos="17 "></span><span class="w">            </span><span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="w">         </span><span class="p">},</span>
<span class="linenos" data-linenos="19 "></span><span class="w">         </span><span class="err">avgTmp</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$avg</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$temp_aire&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos="20 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos="21 "></span><span class="w">   </span><span class="p">}</span>
<span class="linenos" data-linenos="22 "></span><span class="p">]</span><span class="w"> </span><span class="err">)</span>
</code></pre></div>
<p>Obteniendo como resultado documentos similares a:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="err">da</span><span class="kc">te</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">      </span><span class="err">year</span><span class="p">:</span><span class="w"> </span><span class="mi">1984</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="err">mo</span><span class="kc">nt</span><span class="err">h</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="err">day</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="err">avgTmp</span><span class="p">:</span><span class="w"> </span><span class="mf">68.94788047255038</span>
<span class="linenos" data-linenos="10 "></span><span class="p">},</span><span class="w"> </span>
<span class="linenos" data-linenos="11 "></span><span class="p">{</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="err">da</span><span class="kc">te</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span><span class="w">      </span><span class="err">year</span><span class="p">:</span><span class="w"> </span><span class="mi">1984</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="err">mo</span><span class="kc">nt</span><span class="err">h</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="err">day</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span>
<span class="linenos" data-linenos="17 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="p">},</span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="err">avgTmp</span><span class="p">:</span><span class="w"> </span><span class="mf">65.79275964391691</span>
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
<span class="linenos" data-linenos="21 "></span><span class="err">...</span>
</code></pre></div>
<!--

## Agregando datos

Una de las ventajas reales de utilizar series temporales viene de agregar los datos.

!!! tip "Funciones ventana"
    Aunque las volveremos a estudiar a lo largo del curso, mediante las funciones ventana podemos agregar datos en un rango de datos temporal.    

Por ejemplo, un operador que conviene conocer es `$setWindowFields`, que permite utilizar funciones ventana con el *framework* de agregación.



$setWindowFields
The problem with aggregation is that, without stashing data in variables, it regards each document in isolation. That’s where the $setWindowFields comes in as it combines some of aggregation’s $group functionality with window functions. 

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span><span class="w"> </span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="nt">&quot;partitionBy&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">callLe</span><span class="kc">tters</span><span class="p">:</span><span class="s2">&quot;$callLetters&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">dia</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$dayO</span><span class="kc">f</span><span class="err">Year</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$ts&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"> </span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="nt">&quot;output&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&quot;averaged&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span><span class="nt">&quot;$avg&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$airTemperature.value&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span><span class="nt">&quot;window&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span><span class="err">docume</span><span class="kc">nts</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;unbounded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;unbounded&quot;</span><span class="w"> </span><span class="p">]</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="p">}</span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="p">}</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>

The “partitionBy” section splits and groups the data up by our meta data and, in this case by the day of the year. The “output” section then defines what output should be added to every document, based on their partition. So our first field is an “averaged” field for the temperature. This will be the average for that partition. The “window” section says use the entire partition to work out the average, “unbounded”. The result of this stage is that every document gets the average temperature for its partition added to it. 

Add on a $match:

{
     "$expr": { $lt: [ "$temperature", "$averaged" ] }    
}

And now the result of the aggregation is every incident when a location had a lower than average temperature for that day.

Podemos hacer que la ventana cambie ajustando los límites a datos calculados, o comparar documentos de forma relativa entre sí. Además de la media, podemos utilizar otros operadores de ventana como acumuladores, *rankings*, ordenación o *gap-filling*.
-->

<!--
https://learning.oreilly.com/library/view/practical-mongodb-aggregations/9781835080641/B21539_11.xhtml#_idParaDest-202
-->

<h2 id="creando-un-grafico">Creando un gráfico<a class="headerlink" href="#creando-un-grafico" title="Permanent link">&para;</a></h2>
<p>Si estamos trabajando con <em>MongoAtlas</em>, podemos hacer uso de <em>Graphs</em> y crear diferentes gráficos a modo de cuadro de mandos sobre la información almacenada en nuestras colecciones.</p>
<p>Más información en <a href="https://www.mongodb.com/docs/charts/">https://www.mongodb.com/docs/charts/</a></p>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<!--
https://www.mongodb.com/developer/products/mongodb/window-functions-and-time-series/
https://www.mongodb.com/developer/products/mongodb/preparing-tsdata-with-densify-and-fill/
-->

<ul>
<li>Artículo sobre <a href="https://www.mongodb.com/features/mongodb-time-series-data">MongoDB Time Series Data</a></li>
<li>Píldora sobre <a href="https://learn.mongodb.com/courses/creating-a-time-series-collection">Creating a Time Series Collection</a></li>
<li>Series temporales en <a href="https://www.practical-mongodb-aggregations.com/examples/time-series/time-series.html">Practical MongoDB Aggregation Book</a></li>
</ul>







  
  



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        <a href='https://ko-fi.com/T6T8GWT9N' title='Invítame a un café en ko-fi.com' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Invítame a un café en ko-fi.com' /></a>
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="Me encantan estos apuntes" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="Los apuntes son mejorables" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Gracias por tu tiempo. Si quieres me puedes <a href='https://ko-fi.com/T6T8GWT9N'>invitar a un café en ko-fi</a>.
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              ¡Gracias por tu colaboración! Ayúdame a mejorar los apuntes enviándome un mail a <a href="mailto:a.medrano@edu.gva.es">a.medrano@edu.gva.es</a> con tus comentarios.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="pymongo.html" class="md-footer__link md-footer__link--prev" aria-label="Anterior: MongoDB y Python">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                MongoDB y Python
              </div>
            </div>
          </a>
        
        
          
          <a href="../cloud/cloud.html" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Cloud">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                Cloud
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Aitor Medrano - <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es">Licencia CC BY-NC-SA</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://aitor-medrano.github.io/" target="_blank" rel="noopener" title="aitor-medrano.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.top", "navigation.tracking", "navigation.footer", "navigation.indexes", "content.code.annotate", "announce.dismiss", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>