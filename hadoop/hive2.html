
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Apuntes sobre Apache Hive, profundizando en el particionado y bucketing de los datos, junto a un caso de uso de Flume a Hive.">
      
      
      
        <link rel="canonical" href="https://aitor-medrano.github.io/iabd/hadoop/hive2.html">
      
      
        <link rel="prev" href="hive1.html">
      
      
        <link rel="next" href="../spark/spark.html">
      
      
      <link rel="icon" href="../favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.16">
    
    
      
        <title>Apache Hive II. Particionado y buckets de datos. De Flume a Hive. - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VKM8BDY6KT"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VKM8BDY6KT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VKM8BDY6KT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Apache Hive II. Particionado y buckets de datos. De Flume a Hive. - Inteligencia Artificial y Big Data" >
      
        <meta  property="og:description"  content="Apuntes sobre Apache Hive, profundizando en el particionado y bucketing de los datos, junto a un caso de uso de Flume a Hive." >
      
        <meta  property="og:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/hadoop/hive2.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aitor-medrano.github.io/iabd/hadoop/hive2.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Apache Hive II. Particionado y buckets de datos. De Flume a Hive. - Inteligencia Artificial y Big Data" >
      
        <meta  name="twitter:description"  content="Apuntes sobre Apache Hive, profundizando en el particionado y bucketing de los datos, junto a un caso de uso de Flume a Hive." >
      
        <meta  name="twitter:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/hadoop/hive2.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#estructuras-de-datos-en-hive" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Apache Hive II. Particionado y buckets de datos. De Flume a Hive.
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2324.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning 23/24
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NoSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            NoSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/nosql.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento de datos. NoSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/mongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/modelado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelado documental
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones en MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/rendimiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendimiento
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/replicacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replicación y particionado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/pymongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB y Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/series-temporales.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Series temporales
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/cloud.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/aws.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/s3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/ec2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/lambda.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/rds.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/dynamodb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DynamoDB
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/waf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WAF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/escalado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitorización y Escalado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/emr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMR
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/athena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Athena
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/glue.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glue
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingeniería de Datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Ingeniería de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/bigdata.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/de.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingeniería de datos
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/arq.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arquitecturas Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/etl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingesta de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/pentaho.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pentaho
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/formatos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formatos de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/faker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Faker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ecosistema Hadoop
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ecosistema Hadoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hadoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hadoop
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hdfs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sqoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sqoop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="flume.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flume
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hive1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive I
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Hive II
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="hive2.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Hive II
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estructuras-de-datos-en-hive" class="md-nav__link">
    <span class="md-ellipsis">
      Estructuras de datos en Hive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estructuras de datos en Hive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#particiones" class="md-nav__link">
    <span class="md-ellipsis">
      Particiones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buckets" class="md-nav__link">
    <span class="md-ellipsis">
      Buckets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumen" class="md-nav__link">
    <span class="md-ellipsis">
      Resumen
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-6-particionado-y-bucketing" class="md-nav__link">
    <span class="md-ellipsis">
      Caso 6: Particionado y Bucketing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vistas" class="md-nav__link">
    <span class="md-ellipsis">
      Vistas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vistas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vistas-materializadas" class="md-nav__link">
    <span class="md-ellipsis">
      Vistas materializadas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-7-de-flume-a-hive-pasando-por-hdfs" class="md-nav__link">
    <span class="md-ellipsis">
      Caso 7: De Flume a Hive pasando por HDFS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Caso 7: De Flume a Hive pasando por HDFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cargamos-los-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Cargamos los datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creamos-la-tabla-externa" class="md-nav__link">
    <span class="md-ellipsis">
      Creamos la tabla externa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-8-de-flume-a-hive-directamente" class="md-nav__link">
    <span class="md-ellipsis">
      Caso 8: De Flume a Hive directamente
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Caso 8: De Flume a Hive directamente">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creando-el-agente" class="md-nav__link">
    <span class="md-ellipsis">
      Creando el agente
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probando-el-agente" class="md-nav__link">
    <span class="md-ellipsis">
      Probando el agente
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-ventana" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones ventana
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Funciones ventana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consultas-con-enteros-que-cuentanordenan" class="md-nav__link">
    <span class="md-ellipsis">
      Consultas con enteros que cuentan/ordenan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-por-posicion" class="md-nav__link">
    <span class="md-ellipsis">
      Consultas por posición
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-de-agregacion" class="md-nav__link">
    <span class="md-ellipsis">
      Consultas de agregación
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/spark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ecosistema Spark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/rdd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/dataframeAPI.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataFrames API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/catalog.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark JDBC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/deltalake.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Lake
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/streaming.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/join-window.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming II
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Flujo de datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Flujo de datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/airflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pia/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    PIA
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            PIA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            Lara 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/01presentacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/02requisitos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prototipado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/03visitaVK.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Victoria Kent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/04almacenamiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/05audio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento audio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            Lara 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/21conociendo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Lara
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/22captura.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capturando audios
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/06autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/07navarrosantafe.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/08timeseries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/09powerbi.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualización
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_5" >
        
          
          <label class="md-nav__link" for="__nav_9_5" id="__nav_9_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_5">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/23autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Autoponic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/24nodered.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node-RED
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/25villena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/26modelo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelo de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/27dashboard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cuadro de mandos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../blog/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archivo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            Archivo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categorías
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            Categorías
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/diciembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diciembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/enero.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/febrero.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Febrero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noticias.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noticias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noviembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noviembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/octubre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octubre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/septiembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Septiembre
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estructuras-de-datos-en-hive" class="md-nav__link">
    <span class="md-ellipsis">
      Estructuras de datos en Hive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estructuras de datos en Hive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#particiones" class="md-nav__link">
    <span class="md-ellipsis">
      Particiones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buckets" class="md-nav__link">
    <span class="md-ellipsis">
      Buckets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumen" class="md-nav__link">
    <span class="md-ellipsis">
      Resumen
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-6-particionado-y-bucketing" class="md-nav__link">
    <span class="md-ellipsis">
      Caso 6: Particionado y Bucketing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vistas" class="md-nav__link">
    <span class="md-ellipsis">
      Vistas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vistas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vistas-materializadas" class="md-nav__link">
    <span class="md-ellipsis">
      Vistas materializadas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-7-de-flume-a-hive-pasando-por-hdfs" class="md-nav__link">
    <span class="md-ellipsis">
      Caso 7: De Flume a Hive pasando por HDFS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Caso 7: De Flume a Hive pasando por HDFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cargamos-los-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Cargamos los datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creamos-la-tabla-externa" class="md-nav__link">
    <span class="md-ellipsis">
      Creamos la tabla externa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-8-de-flume-a-hive-directamente" class="md-nav__link">
    <span class="md-ellipsis">
      Caso 8: De Flume a Hive directamente
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Caso 8: De Flume a Hive directamente">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creando-el-agente" class="md-nav__link">
    <span class="md-ellipsis">
      Creando el agente
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probando-el-agente" class="md-nav__link">
    <span class="md-ellipsis">
      Probando el agente
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-ventana" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones ventana
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Funciones ventana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consultas-con-enteros-que-cuentanordenan" class="md-nav__link">
    <span class="md-ellipsis">
      Consultas con enteros que cuentan/ordenan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-por-posicion" class="md-nav__link">
    <span class="md-ellipsis">
      Consultas por posición
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-de-agregacion" class="md-nav__link">
    <span class="md-ellipsis">
      Consultas de agregación
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <a href="../tags.html#hadoop" class="md-tag">Hadoop</a>
    
  
    
    
    
      <a href="../tags.html#hive" class="md-tag">Hive</a>
    
  
    
    
    
      <a href="../tags.html#sbd-ra3" class="md-tag">SBD RA3</a>
    
  
</nav>



  <h1>Hive II</h1>

<h2 id="estructuras-de-datos-en-hive">Estructuras de datos en Hive<a class="headerlink" href="#estructuras-de-datos-en-hive" title="Permanent link">&para;</a></h2>
<p><em>Hive</em> proporciona una estructura basada en tablas sobre HDFS. Soporta tres tipos de estructuras: tablas, particiones y <em>buckets</em>. Las tablas se corresponden con directorios de HDFS, las particiones son las divisiones de las tablas y los <em>buckets</em> son las divisiones de las particiones.</p>
<p>Acabamos de ver en el apartado anterior que <em>Hive</em> permite crear tablas externas, similares a las tablas en una base de datos, pero a la que se les proporciona una ubicación.</p>
<h3 id="particiones">Particiones<a class="headerlink" href="#particiones" title="Permanent link">&para;</a></h3>
<p>Las <strong><em>particiones</em></strong> en <em>Hive</em> consisten en dividir las tablas en varios subdirectorios. Esta estructura permite aumentar el rendimiento cuando utilizamos consultas que filtran los datos mediante la cláusula <em>where</em> basada en la clave de particionado.</p>
<p>Por ejemplo, si estamos almacenado ficheros de log (tanto la línea del log como su <em>timestamp</em>), podemos pensar en agrupar por fecha los diferentes ficheros. Podríamos añadir otra partición para también dividirlos por países:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="p">(</span><span class="n">ts</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">linea</span><span class="w"> </span><span class="n">STRING</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">fecha</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span><span class="w"> </span><span class="n">pais</span><span class="w"> </span><span class="n">STRING</span><span class="p">);</span>
</code></pre></div>
<p>Por ejemplo, para cargar los datos en una partición:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">LOAD</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="k">LOCAL</span><span class="w"> </span><span class="n">INPATH</span><span class="w"> </span><span class="s1">&#39;input/hive/particiones/log1&#39;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">logs</span>
<span class="linenos" data-linenos="3 "></span><span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">fecha</span><span class="o">=</span><span class="s1">&#39;2022-01-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pais</span><span class="o">=</span><span class="s1">&#39;ES&#39;</span><span class="p">);</span>
</code></pre></div>
<p>A nivel del sistema de fichero, las particiones se traducen en subdirectorios dentro de la carpeta de la tabla. Por ejemplo, tras insertar varios ficheros de logs, podríamos tener una estructura similar a:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>/user/hive/warehouse/logs
<span class="linenos" data-linenos=" 2 "></span>├── fecha=2022-01-01/
<span class="linenos" data-linenos=" 3 "></span>│   ├── pais=ES/
<span class="linenos" data-linenos=" 4 "></span>│   │   ├── log1
<span class="linenos" data-linenos=" 5 "></span>│   │   └── log2
<span class="linenos" data-linenos=" 6 "></span>│   └── pais=US/
<span class="linenos" data-linenos=" 7 "></span>│       └── log3
<span class="linenos" data-linenos=" 8 "></span>└── fecha=2022-01-02/
<span class="linenos" data-linenos=" 9 "></span>    ├── pais=ES/
<span class="linenos" data-linenos="10 "></span>    │   └── log4
<span class="linenos" data-linenos="11 "></span>    └── pais=US/
<span class="linenos" data-linenos="12 "></span>        ├── log5
<span class="linenos" data-linenos="13 "></span>        └── log6
</code></pre></div>
<p>Para averiguar las particiones en <em>Hive</em>, utilizaremos el comando <code>SHOW PARTITIONS</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>hive&gt; SHOW PARTITIONS logs;
<span class="linenos" data-linenos="2 "></span>fecha=2022-01-01/pais=ES
<span class="linenos" data-linenos="3 "></span>fecha=2022-01-01/pais=US
<span class="linenos" data-linenos="4 "></span>fecha=2022-01-02/pais=ES
<span class="linenos" data-linenos="5 "></span>fecha=2022-01-02/pais=US
</code></pre></div>
<p>Hay que tener en cuenta que la definición de columnas de la clausula <code>PARTITIONED BY</code> forman parte de las columnas de la tabla, y se conocen como <ins>columnas de partición</ins>. Sin embargo, los ficheros de datos no contienen valores para esas columnas, ya que se deriva el nombre del subdirectorio.</p>
<p>Podemos utilizar las columnas de partición en las consultas igual que una columna ordinaria. <em>Hive</em> traduce la consulta en la navegación adecuada para sólo escanear las particiones relevantes. Por ejemplo, la siguiente consulta solo escaneará los ficheros <code>log1</code>, <code>log2</code> y <code>log4</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">fecha</span><span class="p">,</span><span class="w"> </span><span class="n">linea</span>
<span class="linenos" data-linenos="2 "></span><span class="k">FROM</span><span class="w"> </span><span class="n">logs</span>
<span class="linenos" data-linenos="3 "></span><span class="k">WHERE</span><span class="w"> </span><span class="n">pais</span><span class="o">=</span><span class="s1">&#39;ES&#39;</span><span class="p">;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Moviendo datos a una tabla particionada</p>
<p>Si queremos mover datos de una tabla ordinaria a una particionada (vaciando los datos de la partición existente):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">INSERT</span><span class="w"> </span><span class="n">OVERWRITE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">logs</span>
<span class="linenos" data-linenos="2 "></span><span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">fecha</span><span class="o">=</span><span class="s1">&#39;2022-01-01&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="k">SELECT</span><span class="w"> </span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">fuente</span><span class="p">;</span>
</code></pre></div>
<p>Otra posibilidad es utilizar un <em>particionado dinámico</em>, de manera que las particiones se crean de forma relativa a los datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">INSERT</span><span class="w"> </span><span class="n">OVERWRITE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">logs</span>
<span class="linenos" data-linenos="2 "></span><span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">fecha</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="k">SELECT</span><span class="w"> </span><span class="n">fecha</span><span class="p">,</span><span class="w"> </span><span class="n">col1</span><span class="p">,</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">fuente</span><span class="p">;</span>
</code></pre></div>
<p>Para ello, previamente hay que habilitarlo (por defecto está desactivado para evitar la creación de múltiples particiones sin querer) y configurar el modo no estricto para que no nos obligue a indicar al menos una partición estática:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">set</span><span class="w"> </span>hive.exec.dynamic.partition<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">set</span><span class="w"> </span>hive.exec.dynamic.partition.mode<span class="w"> </span><span class="o">=</span><span class="w"> </span>nonstrict<span class="p">;</span>
</code></pre></div>
</div>
<h3 id="buckets">Buckets<a class="headerlink" href="#buckets" title="Permanent link">&para;</a></h3>
<p>Otro concepto importante en <em>Hive</em> son los <strong><em>buckets</em></strong>. Son particiones <em>hasheadas</em> por una columna/clave, en las que los datos se distribuyen en función de su valor <em>hash</em>.</p>
<p>Existen dos razones por las cuales queramos organizar las tablas (o particiones) en <em>buckets</em>. La primera es para conseguir consultas más eficientes, ya que imponen una estructura extra en las tablas. Los buckets pueden acelerar las operaciones de tipo <em>join</em> si las claves de <em>bucketing</em> y de <em>join</em> coinciden, ya que una clave ajena busca únicamente en el <em>bucket</em> adecuado de la clave primaria. Debido a los beneficios de los buckets/particiones, se deben considerar siempre que puedan optimizar el rendimiento de las consultas realizadas.</p>
<p>Para indicar que nuestras tablas utilicen <em>buckets</em>, hemos de emplear la clausula <code>CLUSTERED BY</code> para indicar la columnas y el número de <em>buckets</em> (se recomienda que la cantidad de <em>buckets</em> sea potencia de 2):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usuarios_bucketed</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">nombre</span><span class="w"> </span><span class="n">STRING</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="n">CLUSTERED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">BUCKETS</span><span class="p">;</span>
</code></pre></div>
<p><em>Bucketing</em> está muy relacionado con el proceso de carga de datos. Para cargar los datos en una tabla con <em>buckets</em>, debemos bien indicar el número máximo de reducers para que coincida con el número de <em>buckets</em>, o habilitar el <em>bucketing</em> (esta es la recomendada):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">set</span><span class="w"> </span><span class="k">map</span><span class="p">.</span><span class="n">reduce</span><span class="p">.</span><span class="n">tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">set</span><span class="w"> </span><span class="n">hive</span><span class="p">.</span><span class="n">enforce</span><span class="p">.</span><span class="n">bucketing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="c1">-- mejor así</span>
</code></pre></div>
<p>Una vez creada la tabla, se rellena con los datos que tenemos en otra tabla:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">INSERT</span><span class="w"> </span><span class="n">OVERWRITE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usuarios_bucketed</span>
<span class="linenos" data-linenos="2 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usuarios</span><span class="p">;</span>
</code></pre></div>
<p>Físicamente, cada <em>bucket</em> es un fichero de la carpeta con la tabla (o partición). El nombre del fichero no es importante, pero el <em>bucket</em> <code>n</code> es el fichero número <code>n</code>. Por ejemplo, si miramos el contenido de la tabla en HDFS tendremos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>hive&gt;<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>/user/hive/warehouse/usuarios_bucketed<span class="p">;</span>
<span class="linenos" data-linenos="2 "></span>000000_0
<span class="linenos" data-linenos="3 "></span>000001_0
<span class="linenos" data-linenos="4 "></span>000002_0
<span class="linenos" data-linenos="5 "></span>000003_0
</code></pre></div>
<p>El segundo motivo es para obtener un <em>sampling</em> de forma más eficiente. Al trabajar con grandes datasets, normalmente obtenemos una pequeña fracción del dataset para comprender o refinar los datos. Por ejemplo, podemos obtener los datos de únicamente uno de los <em>buckets</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usuarios_bucketed</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">TABLESAMPLE</span><span class="p">(</span><span class="n">BUCKET</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</code></pre></div>
<p>Mediante el <code>id</code> del usuario determinamos el <em>bucket</em> (el cual se utiliza para realizar el <em>hash</em> del valor y ubicarlo dentro de uno de los <em>buckets</em>), de manera que cada <em>bucket</em> contendrá de manera eficiente un conjunto aleatorio de usuarios.</p>
<h3 id="resumen">Resumen<a class="headerlink" href="#resumen" title="Permanent link">&para;</a></h3>
<p>A continuación mostramos en una tabla puntos a favor y en contra de utilizar estas estructuras</p>
<table>
<thead>
<tr>
<th>Particionado +</th>
<th>Particionado -</th>
<th>Bucketing +</th>
<th>Bucketing -</th>
</tr>
</thead>
<tbody>
<tr>
<td>Distribuye la carga de ejecución horizontalmente.</td>
<td>Existe la posibilidad de crear demasiadas particiones que contienen muy poco datos</td>
<td>Proporciona una respuesta de consulta más rápida, al acceder a porciones.</td>
<td>El número de buckets se define durante la creación de la tabla -&gt; Los programadores deben cargar manualmente un volumen equilibrado de datos.</td>
</tr>
<tr>
<td>En la partición tiene lugar la ejecución más rápida de consultas con el volumen de datos bajo. Por ejemplo, la población de búsqueda de la Ciudad del Vaticano devuelve muy rápido en lugar de buscar la población mundial completa.</td>
<td>La partición es eficaz para datos de bajo volumen. Pero algunas consultas como agrupar por un gran volumen de datos tardan mucho en ejecutarse. Por ejemplo, agrupar las consultas del mes de Enero tardará más que los viernes de Enero.</td>
<td>Al utilizar volúmenes similares de datos en cada partición, los <em>map joins</em> serán más rápidos.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Supongamos que <code>$HDFS_HIVE</code> contiene la ruta con la raíz de las tablas internas de Hive, en nuestro caso <code>/user/hive/warehouse</code>. Respecto al nivel de estructura y representación en carpetas de HDFS tendríamos:</p>
<table>
<thead>
<tr>
<th>ENTIDAD</th>
<th>EJEMPLO</th>
<th>UBICACIÓN</th>
</tr>
</thead>
<tbody>
<tr>
<td>base de datos</td>
<td>iabd</td>
<td><code>$HDFS_HIVE/iabd.db</code></td>
</tr>
<tr>
<td>tabla</td>
<td>T</td>
<td><code>$HDFS_HIVE/iabd.db/T</code></td>
</tr>
<tr>
<td>partición</td>
<td>fecha='01012022'</td>
<td><code>$HDFS_HIVE/iabd.db/T/fecha=01012022</code></td>
</tr>
<tr>
<td>bucket</td>
<td>columna id</td>
<td><code>$HDFS_HIVE/iabd.db/T/fecha=01012022/000000_0</code></td>
</tr>
</tbody>
</table>
<h2 id="caso-6-particionado-y-bucketing">Caso 6: Particionado y Bucketing<a class="headerlink" href="#caso-6-particionado-y-bucketing" title="Permanent link">&para;</a></h2>
<p>A continuación, vamos a coger los datos de las productos y las categorías de la base de datos <code>retail_db</code>, y colocarlos en una estructura de <em>Hive</em> particionada y que utilice <em>bucketing</em>.</p>
<p>La estructura de las tablas es la siguiente:</p>
<figure style="align: center;">
    <img src="images/06hive-products-categories.png">
    <figcaption>Relación entre productos y categorías</figcaption>
</figure>

<p>El primer paso es traernos los datos de <em>MariaDB</em> a tablas internas haciendo uso de <em>Sqoop</em>:</p>
<!--
sqoop import --connect jdbc:mysql://localhost/retail_db --username iabd --password iabd --table categories --hcatalog-database iabd --hcatalog-table categories --create-hcatalog-table --hcatalog-storage-stanza "stored as orcfile"
-->

<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Tabla categories</label><label for="__tabbed_1_2">Tabla products</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sqoop<span class="w"> </span>import<span class="w"> </span>--connect<span class="w"> </span>jdbc:mysql://localhost/retail_db<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span>--username<span class="o">=</span>iabd<span class="w"> </span>--password<span class="o">=</span>iabd<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span>--table<span class="o">=</span>categories<span class="w"> </span>--driver<span class="o">=</span>com.mysql.jdbc.Driver<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span>--hive-import<span class="w"> </span>--hive-database<span class="w"> </span>iabd<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span>--create-hive-table<span class="w"> </span>--hive-table<span class="w"> </span>categories
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sqoop<span class="w"> </span>import<span class="w"> </span>--connect<span class="w"> </span>jdbc:mysql://localhost/retail_db<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span>--username<span class="o">=</span>iabd<span class="w"> </span>--password<span class="o">=</span>iabd<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span>--table<span class="o">=</span>products<span class="w"> </span>--driver<span class="o">=</span>com.mysql.jdbc.Driver<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span>--hive-import<span class="w"> </span>--hive-database<span class="w"> </span>iabd<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span>--create-hive-table<span class="w"> </span>--hive-table<span class="w"> </span>products
</code></pre></div>
</div>
</div>
</div>
<p>El siguiente paso que vamos a realizar es crear en <em>Hive</em> una tabla con el código del producto, su nombre, el nombre de la categoría y el precio del producto. Estos datos los vamos a particionar por categoría y <em>clusterizado</em> en 8 buckets:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">productos</span><span class="w"> </span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="n">nombre</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="n">precio</span><span class="w"> </span><span class="n">DOUBLE</span>
<span class="linenos" data-linenos="5 "></span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span><span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">categoria</span><span class="w"> </span><span class="n">STRING</span><span class="p">)</span>
<span class="linenos" data-linenos="7 "></span><span class="n">CLUSTERED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">BUCKETS</span><span class="p">;</span>
</code></pre></div>
<p>Y cargamos los datos con una consulta que realice un join de las tablas <code>categories</code> y <code>products</code> con particionado dinámico (recuerda activarlo mediante <code>set hive.exec.dynamic.partition.mode=nonstrict;</code>), teniendo en cuenta que los datos que forman parte de la partición deben ser las últimas columnas de la consulta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">INSERT</span><span class="w"> </span><span class="n">OVERWRITE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">categoria</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_price</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">category_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">product_category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">category_id</span><span class="p">);</span>
</code></pre></div>
<p>Si queremos comprobar cómo se han creado las particiones y los buckets, desde un terminal podemos acceder a HDFS y observar cómo ha creado una carpeta por cada valor del campo <code>categoria</code>:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos
</span><span class="linenos" data-linenos=" 2 "></span>Found<span class="w"> </span><span class="m">52</span><span class="w"> </span>items
<span class="linenos" data-linenos=" 3 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories
<span class="linenos" data-linenos=" 4 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>As<span class="w"> </span>Seen<span class="w"> </span>on<span class="w">  </span>TV!
<span class="linenos" data-linenos=" 5 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Baseball<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Softball
<span class="linenos" data-linenos=" 6 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Basketball
<span class="linenos" data-linenos=" 7 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Bike<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Skate<span class="w"> </span>Shop
<span class="linenos" data-linenos=" 8 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Boating
<span class="linenos" data-linenos=" 9 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Boxing<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>MMA
<span class="linenos" data-linenos="10 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Boys%27<span class="w"> </span>Apparel
<span class="linenos" data-linenos="11 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Camping<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Hiking
<span class="linenos" data-linenos="12 "></span>drwxr-xr-x<span class="w">   </span>-<span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Cardio<span class="w"> </span>Equipment
<span class="linenos" data-linenos="13 "></span>...
</code></pre></div>
<p>Y si entramos a una categoría concreta, sus 8 <em>buckets</em>:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories
</span><span class="linenos" data-linenos=" 2 "></span>Found<span class="w"> </span><span class="m">8</span><span class="w"> </span>items
<span class="linenos" data-linenos=" 3 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">391</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000000_0
<span class="linenos" data-linenos=" 4 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">464</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000001_0
<span class="linenos" data-linenos=" 5 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">468</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000002_0
<span class="linenos" data-linenos=" 6 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">455</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000003_0
<span class="linenos" data-linenos=" 7 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">435</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000004_0
<span class="linenos" data-linenos=" 8 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">453</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000005_0
<span class="linenos" data-linenos=" 9 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">456</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000006_0
<span class="linenos" data-linenos="10 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">        </span><span class="m">469</span><span class="w"> </span><span class="m">2024</span>-01-23<span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000007_0
</code></pre></div>
<p>Y si ya entramos a un <em>bucket</em> concreto:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-head<span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db/productos/categoria<span class="o">=</span>Accessories/000000_0<span class="w"> </span>
</span><span class="linenos" data-linenos=" 2 "></span>480Nike+<span class="w"> </span>Fuelband<span class="w"> </span>SE99.0
<span class="linenos" data-linenos=" 3 "></span>488SOLE<span class="w"> </span>E25<span class="w"> </span>Elliptical999.99
<span class="linenos" data-linenos=" 4 "></span>496SOLE<span class="w"> </span>F85<span class="w"> </span>Treadmill1799.99
<span class="linenos" data-linenos=" 5 "></span>576Lotto<span class="w"> </span>Men<span class="s1">&#39;s Zhero Gravity V 700 TF Soccer Cle59.99</span>
<span class="linenos" data-linenos=" 6 "></span><span class="s1">584adidas Men&#39;</span>s<span class="w"> </span><span class="m">2014</span><span class="w"> </span>MLS<span class="w"> </span>All-Star<span class="w"> </span>Game<span class="w"> </span>Replica<span class="w"> </span>B85.0
<span class="linenos" data-linenos=" 7 "></span>592adidas<span class="w"> </span>Youth<span class="w"> </span>Germany<span class="w"> </span>Black<span class="w"> </span>Crest<span class="w"> </span>Tee18.0
<span class="linenos" data-linenos=" 8 "></span>888Team<span class="w"> </span>Golf<span class="w"> </span>Detroit<span class="w"> </span>Tigers<span class="w"> </span>Putter<span class="w"> </span>Grip24.99
<span class="linenos" data-linenos=" 9 "></span>896Team<span class="w"> </span>Golf<span class="w"> </span>New<span class="w"> </span>York<span class="w"> </span>Giants<span class="w"> </span>Putter<span class="w"> </span>Grip24.99
<span class="linenos" data-linenos="10 "></span>904Team<span class="w"> </span>Golf<span class="w"> </span>Wisconsin<span class="w"> </span>Badgers<span class="w"> </span>Putter<span class="w"> </span>Grip24.99
</code></pre></div>
<p>Si volvemos a <em>Beeline</em>, ahora podemos consultar los datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
<p>Y vemos cómo aparecen 5 elementos que pertenecen a la primera partición.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>+---------------+------------------------------------------------+-------------------+----------------------+
<span class="linenos" data-linenos="2 "></span>| productos.id  |                productos.nombre                | productos.precio  | productos.categoria  |
<span class="linenos" data-linenos="3 "></span>+---------------+------------------------------------------------+-------------------+----------------------+
<span class="linenos" data-linenos="4 "></span>| 480           | Nike+ Fuelband SE                              | 99.0              | Accessories          |
<span class="linenos" data-linenos="5 "></span>| 488           | SOLE E25 Elliptical                            | 999.99            | Accessories          |
<span class="linenos" data-linenos="6 "></span>| 496           | SOLE F85 Treadmill                             | 1799.99           | Accessories          |
<span class="linenos" data-linenos="7 "></span>| 576           | Lotto Men&#39;s Zhero Gravity V 700 TF Soccer Cle  | 59.99             | Accessories          |
<span class="linenos" data-linenos="8 "></span>| 584           | adidas Men&#39;s 2014 MLS All-Star Game Replica B  | 85.0              | Accessories          |
<span class="linenos" data-linenos="9 "></span>+---------------+------------------------------------------------+-------------------+----------------------+
</code></pre></div>
<p>Si quisiéramos, por ejemplo, 10 elementos de particiones diferentes deberíamos ordenarlos de manera aleatoria:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>
<p>Y ya obtendríamos datos de diferentes particiones, eso sí, con una operación más costosa computacionalmente al tener que acceder a todas las particiones y <em>buckets</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+---------------+------------------------------------------------+-------------------+----------------------+
<span class="linenos" data-linenos=" 2 "></span>| productos.id  |                productos.nombre                | productos.precio  | productos.categoria  |
<span class="linenos" data-linenos=" 3 "></span>+---------------+------------------------------------------------+-------------------+----------------------+
<span class="linenos" data-linenos=" 4 "></span>| 1330          | Nike Men&#39;s Home Game Jersey Denver Broncos Pe  | 100.0             | Fútbol               |
<span class="linenos" data-linenos=" 5 "></span>| 29            | Nike Men&#39;s USA Away Stadium Replica Soccer Je  | 90.0              | Baseball &amp; Softball  |
<span class="linenos" data-linenos=" 6 "></span>| 75            | Nike Women&#39;s Pro Core 3&quot; Compression Shorts    | 28.0              | Lacrosse             |
<span class="linenos" data-linenos=" 7 "></span>| 827           | Bridgestone e6 Straight Distance NFL Seattle   | 31.99             | Electronics          |
<span class="linenos" data-linenos=" 8 "></span>| 9             | Nike Adult Vapor Jet 3.0 Receiver Gloves       | 50.0              | Soccer               |
<span class="linenos" data-linenos=" 9 "></span>| 976           | Columbia Women&#39;s Sandy River Shorts            | 21.99             | Hunting &amp; Shooting   |
<span class="linenos" data-linenos="10 "></span>| 841           | SkyCaddie LINX Golf GPS Watch                  | 249.99            | Kids&#39; Golf Clubs     |
<span class="linenos" data-linenos="11 "></span>| 307           | Garmin Forerunner 910XT with HRM               | 449.99            | Kids&#39; Golf Clubs     |
<span class="linenos" data-linenos="12 "></span>| 213           | Exerpeutic 900XL Magnetic Recumbent Bike with  | 199.99            | Strength Training    |
<span class="linenos" data-linenos="13 "></span>| 1071          | Pelican Apex 100 Kayak                         | 229.99            | Water Sports         |
<span class="linenos" data-linenos="14 "></span>+---------------+------------------------------------------------+-------------------+----------------------+
</code></pre></div>
<h2 id="vistas">Vistas<a class="headerlink" href="#vistas" title="Permanent link">&para;</a></h2>
<p>Además de las estructuras físicas para almacenar los datos, podemos crear estructuras lógicas como las vistas.</p>
<p>De la misma forma que en los sistemas de bases de datos tradicionales, mediante una vista podemos abstraer una consulta compleja que realiza diversos <em>joins</em>.</p>
<p>Por ejemplo, si queremos volver a crear la tabla de <code>productos</code> pero mediante una vista que siempre muestre los datos actualizados haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">productos_view</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_price</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">category_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">product_category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">category_id</span><span class="p">);</span>
</code></pre></div>
<p>Tras crear la vista, podemos consultar directamente los datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos_view</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
<p>Para consultar las vistas existentes, el <em>metastore</em> la almacena como una tabla de tipo <code>VIRTUAL_VIEW</code>, y por tanto, si hacemos un <code>show tables</code> también aparecerá, aunque si solo estamos interesados en las vistas podemos obtenerlas mediante:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SHOW</span><span class="w"> </span><span class="n">VIEWS</span><span class="p">;</span>
</code></pre></div>
<p>Se queremos eliminar la vista, de forma similar a SQL, realizaríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">productos_view</span><span class="p">;</span>
</code></pre></div>
<h3 id="vistas-materializadas">Vistas materializadas<a class="headerlink" href="#vistas-materializadas" title="Permanent link">&para;</a></h3>
<p>Un tipo especial de vistas son las vistas materializadas, entendidas como una tabla de datos duplicada que se crea mediante la combinación de datos de varias tablas existentes para una recuperación de datos más rápida.</p>
<p>Este tipo de vistas no son exclusivas de <em>Hive</em>, ya que sistemas relacionales como PostreSQL u Oracle las soportan.</p>
<p>Con una vista ordinaria, al realizar una consulta, el motor de base de datos calcula dinámicamente los resultados ejecutando la consulta subyacente en las tablas de origen. Los datos de la vista están siempre actualizados porque se derivan directamente de las tablas de origen cada vez que se accede a ellos.
En cambio, con una vista materializada, los resultados de la consulta específica se almacenan como una tabla física en la base de datos. Los datos de la vista materializada se calculan con anterioridad y se almacenan, lo que significa que los resultados ya están disponibles sin necesidad de volver a calcular la consulta cada vez que se accede a la vista.</p>
<p>Desde la versión 3.0 de <em>Apache Hive</em>, se introducen las vistas materializadas y reescritura automática de consultas basadas en dichas materializaciones.</p>
<p>Para crear la vista materializada, debemos indicarla con la <em>keyword</em> <code>MATERIALIZED</code>. Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">productos_viewm</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_price</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">category_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">product_category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">category_id</span><span class="p">);</span>
</code></pre></div>
<p>Esta vista ya no ha tardado menos de un segundo, sino cerca de 50 al persistir los datos en una tabla temporal. Si realizamos la siguiente consulta sobre la vista ordinaria y la vista materializada vemos que el rendimiento cambia:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos_view</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">-- Resultado: 6888.6099 - Tiempo empleado: 45.148 segundos</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos_viewm</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="c1">-- Resultado: 6888.6099 - Tiempo empleado: 34.929 segundos</span>
</code></pre></div>
<p>Si hacemos una consulta más sencilla, las diferencias son todavía mucho más grandes:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">productos_view</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">-- Resultado: 1345 - Tiempo empleado: 43.529 segundos</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">productos_viewm</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="c1">-- Resultado: 1345 - Tiempo empleado: 0.467 segundos</span>
</code></pre></div>
<p>Si insertamos un nuevo producto en la categoría <code>4</code> (<em>Basketball</em>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;66666&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Producto IABD&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Producto insertado para comprobar si cambian los datos&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3333</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
</code></pre></div>
<p>Y volvemos a realizar las consultas agregadas, donde observamos que sólo la vista ordinaria está reflejando los cambios provocados por el nuevo producto recién insertado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos_view</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">-- Resultado: 10221.6099 - Tiempo empleado: 37,534 segundos</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">productos_viewm</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="c1">-- Resultado: 6888.6099 - Tiempo empleado: 29,728 segundos</span>
</code></pre></div>
<p>Por defecto, las vistas materializadas se deben actualizar cuando cambian los datos de origen. <em>Hive</em> no soporte la actualización automática, pero sí que nos permite forzar la regeneración de la vista materializada mediante la opción <code>REBUILD</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">ALTER</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">productos_viewm</span><span class="w"> </span><span class="n">REBUILD</span><span class="p">;</span>
</code></pre></div>
<p>Una vez reconstruida la vista, si volvemos a ejecutar la consulta sobre la vista materializada, sí que veremos los datos actualizados.</p>
<div class="admonition tip">
<p class="admonition-title">Regeneración automática</p>
<p>Otra opción es automatizar la regeneración para que se realice periódicamente, por ejemplo, cada 10 minutos, independientemente de si los datos de origen han cambiado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>SET hive.materializedview.rewriting.time.window=10min;
</code></pre></div>
</div>
<p>Más información en <a href="https://cwiki.apache.org/confluence/display/Hive/Materialized+views">https://cwiki.apache.org/confluence/display/Hive/Materialized+views</a></p>
<h2 id="caso-7-de-flume-a-hive-pasando-por-hdfs">Caso 7: De Flume a Hive pasando por HDFS<a class="headerlink" href="#caso-7-de-flume-a-hive-pasando-por-hdfs" title="Permanent link">&para;</a></h2>
<p>En este caso de uso, vamos a crear un agente <em>Flume</em> que realice un <em>spooling</em> de una carpeta (por ejemplo, podría estar mapeada con una carpeta enlazada a un servidor FTP) donde se van a colocar datos de clientes, y los vamos a insertar en la tabla <code>customersraw</code> mediante un <a href="https://flume.apache.org/FlumeUserGuide.html#hdfs-sink"><em>HDFS Sink</em></a>. A continuación, crearemos una vista materializada con los datos que nos interesan.</p>
<h3 id="cargamos-los-datos">Cargamos los datos<a class="headerlink" href="#cargamos-los-datos" title="Permanent link">&para;</a></h3>
<p>Así pues, el primer paso es crear el agente <em>Flume</em>, y colocarlo en la carpeta <code>conf</code> de <em>Flume</em>:</p>
<div class="highlight"><span class="filename">spool-hdfs.conf</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># Nombramos a los componentes del agente</span>
<span class="linenos" data-linenos=" 2 "></span><span class="na">SpoolHdfsAgent.sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Spooldir</span>
<span class="linenos" data-linenos=" 3 "></span><span class="na">SpoolHdfsAgent.channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MemChannel</span>
<span class="linenos" data-linenos=" 4 "></span><span class="na">SpoolHdfsAgent.sinks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">HDFS</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1"># Describimos el tipo de origen</span>
<span class="linenos" data-linenos=" 7 "></span><span class="na">SpoolHdfsAgent.sources.Spooldir.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">spooldir</span>
<span class="linenos" data-linenos=" 8 "></span><span class="na">SpoolHdfsAgent.sources.Spooldir.spoolDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/home/iabd/hive/spoolDir</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># Describimos el destino</span>
<span class="linenos" data-linenos="11 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">hdfs</span>
<span class="linenos" data-linenos="12 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.hdfs.path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">hdfs://iabd-virtualbox:9000/user/iabd/flume/caso7</span>
<span class="linenos" data-linenos="13 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.hdfs.filePrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">hive-caso7</span>
<span class="linenos" data-linenos="14 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.hdfs.rollInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
<span class="linenos" data-linenos="15 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.hdfs.rollCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10000</span>
<span class="linenos" data-linenos="16 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.hdfs.fileType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">DataStream</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="c1"># Describimos la configuración del canal</span>
<span class="linenos" data-linenos="19 "></span><span class="na">SpoolHdfsAgent.channels.MemChannel.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">memory</span>
<span class="linenos" data-linenos="20 "></span><span class="na">SpoolHdfsAgent.channels.MemChannel.capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">100000</span>
<span class="linenos" data-linenos="21 "></span><span class="na">SpoolHdfsAgent.channels.MemChannel.transactionCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10000</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span><span class="c1"># Unimos el origen y el destino a través del canal</span>
<span class="linenos" data-linenos="24 "></span><span class="na">SpoolHdfsAgent.sources.Spooldir.channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MemChannel</span>
<span class="linenos" data-linenos="25 "></span><span class="na">SpoolHdfsAgent.sinks.HDFS.channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MemChannel</span>
</code></pre></div>
<p>Antes de ejecutarlo, vamos a crear la carpeta en HDFS:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-mkdir<span class="w"> </span>-r<span class="w"> </span>/user/iabd/flume/caso7
</code></pre></div>
<p>Y a continuación, ejecutamos el agente desde <code>$FLUME_HOME</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>./bin/flume-ng<span class="w"> </span>agent<span class="w"> </span>--conf<span class="w"> </span>./conf/<span class="w"> </span>--conf-file<span class="w"> </span>./conf/spool-hdfs.conf<span class="w"> </span>--name<span class="w"> </span>SpoolHdfsAgent
</code></pre></div>
<p>Tras copiar el archivo <a href="resources/clientes.csv"><code>clientes.csv</code></a> en <code>/home/iabd/hive/spoolDir</code>, se renombrará y se realizará la ingesta en HDFS.</p>
<p>Si comprobamos la carpeta, vemos que se han creado múltiples archivos:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>flume/caso7
</span><span class="linenos" data-linenos="2 "></span>Found<span class="w"> </span><span class="m">309</span><span class="w"> </span>items
<span class="linenos" data-linenos="3 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">       </span><span class="m">1074</span><span class="w"> </span><span class="m">2024</span>-01-22<span class="w"> </span><span class="m">13</span>:04<span class="w"> </span>flume/caso7/hive-caso7.1705925066214
<span class="linenos" data-linenos="4 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">       </span><span class="m">1068</span><span class="w"> </span><span class="m">2024</span>-01-22<span class="w"> </span><span class="m">13</span>:04<span class="w"> </span>flume/caso7/hive-caso7.1705925066215
<span class="linenos" data-linenos="5 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">       </span><span class="m">1089</span><span class="w"> </span><span class="m">2024</span>-01-22<span class="w"> </span><span class="m">13</span>:04<span class="w"> </span>flume/caso7/hive-caso7.1705925066216
<span class="linenos" data-linenos="6 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">       </span><span class="m">1075</span><span class="w"> </span><span class="m">2024</span>-01-22<span class="w"> </span><span class="m">13</span>:04<span class="w"> </span>flume/caso7/hive-caso7.1705925066217
<span class="linenos" data-linenos="7 "></span>-rw-r--r--<span class="w">   </span><span class="m">1</span><span class="w"> </span>iabd<span class="w"> </span>supergroup<span class="w">       </span><span class="m">1082</span><span class="w"> </span><span class="m">2024</span>-01-22<span class="w"> </span><span class="m">13</span>:04<span class="w"> </span>flume/caso7/hive-caso7.1705925066218
<span class="linenos" data-linenos="8 "></span>...
</code></pre></div>
<p>Y si visualizamos uno de ellos, tenemos los datos de los clientes:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-head<span class="w"> </span>flume/caso7/hive-caso7.1705925066214
</span><span class="linenos" data-linenos="2 "></span><span class="m">1</span>,Richard,Hernandez,Brownsville
<span class="linenos" data-linenos="3 "></span><span class="m">2</span>,Mary,Barrett,Littleton
<span class="linenos" data-linenos="4 "></span><span class="m">3</span>,Ann,Smith,Caguas
<span class="linenos" data-linenos="5 "></span><span class="m">4</span>,Mary,Jones,San<span class="w"> </span>Marcos
<span class="linenos" data-linenos="6 "></span><span class="m">5</span>,Robert,Hudson,Caguas
<span class="linenos" data-linenos="7 "></span><span class="m">6</span>,Mary,Smith,Passaic
<span class="linenos" data-linenos="8 "></span>...
</code></pre></div>
<h3 id="creamos-la-tabla-externa">Creamos la tabla externa<a class="headerlink" href="#creamos-la-tabla-externa" title="Permanent link">&para;</a></h3>
<p>Cuando ya tenemos los datos en HDFS, crearemos en Hive una tabla externa en formato texto y que utiliza las comas como separadores de campo (formato CSV) que apunte a dichos datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">clientes7</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">(</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="n">custId</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="n">fName</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="n">lName</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="n">city</span><span class="w"> </span><span class="n">STRING</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">)</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">ROW</span><span class="w"> </span><span class="n">FORMAT</span><span class="w"> </span><span class="n">DELIMITED</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">FIELDS</span><span class="w"> </span><span class="n">TERMINATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;,&#39;</span>
<span class="linenos" data-linenos="10 "></span><span class="n">STORED</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TEXTFILE</span>
<span class="hll"><span class="linenos" data-linenos="11 "></span><span class="k">LOCATION</span><span class="w"> </span><span class="s1">&#39;/user/iabd/flume/caso7&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>Una vez creada, ya podemos realizar consultas sobre los datos. Por ejemplo, si ejecutamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">clientes7</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
<p>Obtendremos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">+</span><span class="c1">-------------------+------------------+------------------+-----------------+</span>
<span class="linenos" data-linenos="2 "></span><span class="o">|</span><span class="w"> </span><span class="n">clientes7</span><span class="p">.</span><span class="n">custid</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">clientes7</span><span class="p">.</span><span class="n">fname</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">clientes7</span><span class="p">.</span><span class="n">lname</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">clientes7</span><span class="p">.</span><span class="n">city</span><span class="w">  </span><span class="o">|</span>
<span class="linenos" data-linenos="3 "></span><span class="o">+</span><span class="c1">-------------------+------------------+------------------+-----------------+</span>
<span class="linenos" data-linenos="4 "></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">Richard</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Hernandez</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">Brownsville</span><span class="w">     </span><span class="o">|</span>
<span class="linenos" data-linenos="5 "></span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">Mary</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">Barrett</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Littleton</span><span class="w">       </span><span class="o">|</span>
<span class="linenos" data-linenos="6 "></span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">Ann</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">Smith</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">Caguas</span><span class="w">          </span><span class="o">|</span>
<span class="linenos" data-linenos="7 "></span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">Mary</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">Jones</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">San</span><span class="w"> </span><span class="n">Marcos</span><span class="w">      </span><span class="o">|</span>
<span class="linenos" data-linenos="8 "></span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">Robert</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">Hudson</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">Caguas</span><span class="w">          </span><span class="o">|</span>
<span class="linenos" data-linenos="9 "></span><span class="o">+</span><span class="c1">-------------------+------------------+------------------+-----------------+</span>
</code></pre></div>
<h2 id="caso-8-de-flume-a-hive-directamente">Caso 8: De Flume a Hive directamente<a class="headerlink" href="#caso-8-de-flume-a-hive-directamente" title="Permanent link">&para;</a></h2>
<div class="admonition caution">
<p class="admonition-title">Caso de uso no funcional</p>
<p>Aunque en teoría está todo bien, no termina de funcionarme. Puedes leerlo para entender qué es lo que habría que hacer, pero me parece que el problema proviene de la configuración de mi máquina virtual.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>22 ene 2024 13:39:44,464 WARN  [SinkRunner-PollingRunner-DefaultSinkProcessor] (org.apache.flume.sink.hive.HiveSink.drainOneBatch:325)
<span class="linenos" data-linenos="2 "></span>  - Hive : Failed connecting to EndPoint {metaStoreUri=&#39;thrift://iabd-virtualbox:9083&#39;, database=&#39;iabd&#39;, table=&#39;customerstx&#39;, partitionVals=[] }
<span class="linenos" data-linenos="3 "></span>  org.apache.flume.sink.hive.HiveWriter$ConnectException: Failed connecting to EndPoint
<span class="linenos" data-linenos="4 "></span>    {metaStoreUri=&#39;thrift://iabd-virtualbox:9083&#39;, database=&#39;iabd&#39;, table=&#39;customerstx&#39;, partitionVals=[] }
</code></pre></div>
<p>Si consigues que te funcione siempre puedes mandarme un email <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#46;&#109;&#101;&#100;&#114;&#97;&#110;&#111;&#64;&#101;&#100;&#117;&#46;&#103;&#118;&#97;&#46;&#101;&#115;">&#97;&#46;&#109;&#101;&#100;&#114;&#97;&#110;&#111;&#64;&#101;&#100;&#117;&#46;&#103;&#118;&#97;&#46;&#101;&#115;</a> y comentarme qué has hecho o qué debo modificar. ¡Gracias!</p>
</div>
<p>Para el último caso de uso, vamos a crear un agente <em>Flume</em> que realice un <em>spooling</em> de una carpeta y los vamos a insertar directamente en la tabla <code>customerstx</code> (en formato <em>ORC</em> mediante 4 <em>buckets</em> y configurada como transaccional) <a href="hive1.html#modificando-datos">creada en el caso 2</a> mediante un <a href="https://flume.apache.org/FlumeUserGuide.html#hive-sink"><em>Hive Sink</em></a>.</p>
<p>Antes de nada, vamos a comprobar cuantos datos tenemos en la tabla:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customerstx</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">--- Resultado 12435</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customerstx</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">custId</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">--- Resultado:</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">--- +---------------------+--------------------+--------------------+-------------------+</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">--- | customerstx.custid  | customerstx.fname  | customerstx.lname  | customerstx.city  |</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">--- +---------------------+--------------------+--------------------+-------------------+</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">--- | 12435               | Laura              | Horton             | Summerville       |</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">--- | 12434               | Mary               | Mills              | Caguas            |</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">--- | 12433               | Benjamin           | Garcia             | Levittown         |</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">--- +---------------------+--------------------+--------------------+-------------------+</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Metastore</p>
<p>Para poder acceder a <em>Hive</em> desde <em>Flume</em>, necesitamos que la configuración del <em>Metastore</em> de <em>Hive</em> permita las conexiones remotas y la creación dinámica de las particiones.</p>
<p>Para ello, debemos editar el archivo de configuración de <em>Hive</em> y buscar estas propiedades y modificarlas:</p>
<div class="highlight"><span class="filename">hive-site.xml</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">&lt;property&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="nt">&lt;name&gt;</span>hive.metastore.uris<span class="nt">&lt;/name&gt;</span>
<span class="hll"><span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="nt">&lt;value&gt;</span>thrift://iabd-virtualbox:9083<span class="nt">&lt;/value&gt;</span>
</span><span class="linenos" data-linenos="4 "></span><span class="nt">&lt;/property&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="nt">&lt;property&gt;</span>
<span class="hll"><span class="linenos" data-linenos="6 "></span><span class="w">  </span><span class="nt">&lt;name&gt;</span>hive.exec.dynamic.partition.mode<span class="nt">&lt;/name&gt;</span>
</span><span class="linenos" data-linenos="7 "></span><span class="w">  </span><span class="nt">&lt;value&gt;</span>nonstrict<span class="nt">&lt;/value&gt;</span>
<span class="linenos" data-linenos="8 "></span><span class="nt">&lt;/property&gt;</span>
</code></pre></div>
<p>Una vez configurado, volvemos a arrancar <em>Hive</em> mediante <code>hiveserver2</code> y a continuación, cada vez que arranquemos <em>Hive</em>, necesitamos también arrancar el <em>Metastore</em>, ya que ahora funciona como un servicio totalmente desacoplado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>hive<span class="w"> </span>--service<span class="w"> </span>metastore
</code></pre></div>
</div>
<h3 id="creando-el-agente">Creando el agente<a class="headerlink" href="#creando-el-agente" title="Permanent link">&para;</a></h3>
<p>El siguiente paso es crear el agente <em>Flume</em> y colocarlo en la carpeta <code>conf</code> de <em>Flume</em>. Destacar que debemos indicar la ruta remota del <em>Metastore</em> así como que los campos están delimitados y los nombres de sus campos:</p>
<div class="highlight"><span class="filename">spool-hive.conf</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># Nombramos a los componentes del agente</span>
<span class="linenos" data-linenos=" 2 "></span><span class="na">SpoolHiveAgent.sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Spooldir</span>
<span class="linenos" data-linenos=" 3 "></span><span class="na">SpoolHiveAgent.channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MemChannel</span>
<span class="linenos" data-linenos=" 4 "></span><span class="na">SpoolHiveAgent.sinks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Hive</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1"># Describimos el tipo de origen</span>
<span class="linenos" data-linenos=" 7 "></span><span class="na">SpoolHiveAgent.sources.Spooldir.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">spooldir</span>
<span class="linenos" data-linenos=" 8 "></span><span class="na">SpoolHiveAgent.sources.Spooldir.spoolDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/home/iabd/hive/spoolDir</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># Describimos el destino</span>
<span class="hll"><span class="linenos" data-linenos="11 "></span><span class="na">SpoolHiveAgent.sinks.Hive.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">hive</span>
</span><span class="hll"><span class="linenos" data-linenos="12 "></span><span class="na">SpoolHiveAgent.sinks.Hive.hive.metastore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">thrift://iabd-virtualbox:9083</span>
</span><span class="linenos" data-linenos="13 "></span><span class="na">SpoolHiveAgent.sinks.Hive.hive.database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">iabd</span>
<span class="linenos" data-linenos="14 "></span><span class="na">SpoolHiveAgent.sinks.Hive.hive.table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">customerstx</span>
<span class="linenos" data-linenos="15 "></span><span class="na">SpoolHiveAgent.sinks.Hive.hive.serializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">DELIMITED</span>
<span class="linenos" data-linenos="16 "></span><span class="na">SpoolHiveAgent.sinks.Hive.hive.serializer.fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">custid,fname,lname,city</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="c1"># Describimos la configuración del canal</span>
<span class="linenos" data-linenos="19 "></span><span class="na">SpoolHiveAgent.channels.MemChannel.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">memory</span>
<span class="linenos" data-linenos="20 "></span><span class="na">SpoolHiveAgent.channels.MemChannel.capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span>
<span class="linenos" data-linenos="21 "></span><span class="na">SpoolHiveAgent.channels.MemChannel.transactionCapacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">100</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span><span class="c1"># Unimos el origen y el destino a través del canal</span>
<span class="linenos" data-linenos="24 "></span><span class="na">SpoolHiveAgent.sources.Spooldir.channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MemChannel</span>
<span class="linenos" data-linenos="25 "></span><span class="na">SpoolHiveAgent.sinks.Hive.channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MemChannel</span>
</code></pre></div>
<h3 id="probando-el-agente">Probando el agente<a class="headerlink" href="#probando-el-agente" title="Permanent link">&para;</a></h3>
<p>Primero, arrancaremos el agente desde <code>$FLUME_HOME</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>./bin/flume-ng<span class="w"> </span>agent<span class="w"> </span>--conf<span class="w"> </span>./conf/<span class="w"> </span>--conf-file<span class="w"> </span>./conf/spool-hive.conf<span class="w"> </span>--name<span class="w"> </span>SpoolHiveAgent
</code></pre></div>
<p>Y a continuación, vamos a la carpeta <code>/home/iabd/hive/spoolDir</code> (si no existe, la creamos) y colocamos el siguiente <a href="resources/nuevos-clientes.csv">archivo</a> en la carpeta:</p>
<div class="highlight"><span class="filename">nuevos-clientes.csv</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>6666, Aitor, Medrano, Elche
<span class="linenos" data-linenos="2 "></span>7777, Domingo, Gallardo, Alicante
<span class="linenos" data-linenos="3 "></span>8888, Fátima, Polo, Madrid
</code></pre></div>
<p>Si volvemos a ejecutar las consultas vemos como ahora ....</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customerstx</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">--- Deberían aparecer 12438</span>
<span class="linenos" data-linenos="3 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customerstx</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">custId</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">--- Resultado: Deberían aparecer los clientes recibidos desde Flume</span>
</code></pre></div>
<h2 id="funciones-ventana">Funciones ventana<a class="headerlink" href="#funciones-ventana" title="Permanent link">&para;</a></h2>
<p>A continuación vamos a realizar diversas consultas utilizando las funciones ventana que soporta <em>Hive</em>. Más información en <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics</a>.</p>
<h3 id="consultas-con-enteros-que-cuentanordenan">Consultas con enteros que cuentan/ordenan<a class="headerlink" href="#consultas-con-enteros-que-cuentanordenan" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Consultas sobre categorías</p>
<p>Las siguientes consultas las vamos a realizar sobre sólo dos categorías para acotar los resultados obtenidos.</p>
<p>Además, hemos recortado el nombre del producto a 20 caracteres para facilitar la legibilidad de los resultados.</p>
</div>
<p>Las funciones <strong><code>rank</code></strong> y <strong><code>dense_rank</code></strong> permite obtener la posición que ocupan los datos. Se diferencia en que <code>rank</code> cuenta los elementos repetidos/empatados, mientras que <code>dense_rank</code> no.</p>
<p>Por ejemplo, vamos a obtener la posición que ocupan los productos respecto al precio agrupados por su categoría:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">categoria</span><span class="p">,</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">precio</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="n">dense_rank</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">precio</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">denseRank</span>
<span class="linenos" data-linenos="4 "></span><span class="k">from</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="5 "></span><span class="k">where</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
</code></pre></div>
<p>En el caso de que tengamos más de un elemento con el mismo valor, tanto en <strong><code>rank</code></strong> como con <strong><code>dense_rank</code></strong>, todos los elementos ocuparán la misma posición.</p>
<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------+--------------------+----------+-------+------------+
<span class="linenos" data-linenos=" 2 "></span>|        nombre         |     categoria      |  precio  | rank  | denserank  |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------+--------------------+----------+-------+------------+
<span class="linenos" data-linenos=" 4 "></span>| SOLE F85 Treadmill    | Basketball         | 1799.99  | 1     | 1          |
<span class="linenos" data-linenos=" 5 "></span>| SOLE E25 Elliptical   | Basketball         | 999.99   | 2     | 2          |
<span class="linenos" data-linenos=" 6 "></span>| Diamondback Adult Re  | Basketball         | 349.98   | 3     | 3          |
<span class="linenos" data-linenos=" 7 "></span>| Diamondback Adult Ou  | Basketball         | 309.99   | 4     | 4          |
<span class="hll"><span class="linenos" data-linenos=" 8 "></span>| Diamondback Girls&#39; C  | Basketball         | 299.99   | 5     | 5          |
</span><span class="hll"><span class="linenos" data-linenos=" 9 "></span>| Diamondback Boys&#39; In  | Basketball         | 299.99   | 5     | 5          |
</span><span class="linenos" data-linenos="10 "></span>| Diamondback Adult So  | Basketball         | 299.98   | 7     | 6          |
<span class="linenos" data-linenos="11 "></span>| Easton Mako Youth Ba  | Basketball         | 249.97   | 8     | 7          |
<span class="linenos" data-linenos="12 "></span>| Fitness Gear 300 lb   | Basketball         | 209.99   | 9     | 8          |
<span class="linenos" data-linenos="13 "></span>| Quik Shade Summit SX  | Basketball         | 199.99   | 10    | 9          |
<span class="hll"><span class="linenos" data-linenos="14 "></span>| Easton XL1 Youth Bat  | Basketball         | 179.97   | 11    | 10         |
</span><span class="hll"><span class="linenos" data-linenos="15 "></span>| Easton S1 Youth Bat   | Basketball         | 179.97   | 11    | 10         |
</span><span class="linenos" data-linenos="16 "></span>| adidas Brazuca 2014   | Basketball         | 159.99   | 13    | 11         |
<span class="linenos" data-linenos="17 "></span>| Quest 12&#39; x 12&#39; Dome  | Basketball         | 149.99   | 14    | 12         |
<span class="linenos" data-linenos="18 "></span>| Fitbit Flex Wireless  | Basketball         | 99.95    | 15    | 13         |
<span class="linenos" data-linenos="19 "></span>| Nike+ Fuelband SE     | Basketball         | 99.0     | 16    | 14         |
<span class="linenos" data-linenos="20 "></span>| Elevation Training M  | Basketball         | 79.99    | 17    | 15         |
<span class="linenos" data-linenos="21 "></span>| MAC Sports Collapsib  | Basketball         | 69.99    | 18    | 16         |
<span class="linenos" data-linenos="22 "></span>| Quest Q64 10 FT. x 1  | Basketball         | 59.98    | 19    | 17         |
<span class="linenos" data-linenos="23 "></span>| adidas Brazuca 2014   | Basketball         | 39.99    | 20    | 18         |
<span class="hll"><span class="linenos" data-linenos="24 "></span>| Kijaro Dual Lock Cha  | Basketball         | 29.99    | 21    | 19         |
</span><span class="hll"><span class="linenos" data-linenos="25 "></span>| adidas Brazuca 2014   | Basketball         | 29.99    | 21    | 19         |
</span><span class="linenos" data-linenos="26 "></span>| Nike Women&#39;s Pro Cor  | Basketball         | 28.0     | 23    | 20         |
<span class="linenos" data-linenos="27 "></span>| Nike Women&#39;s Pro Vic  | Basketball         | 21.99    | 24    | 21         |
<span class="linenos" data-linenos="28 "></span>| Nike VR_S Covert Dri  | Bike &amp; Skate Shop  | 179.99   | 1     | 1          |
<span class="linenos" data-linenos="29 "></span>| TaylorMade RocketBal  | Bike &amp; Skate Shop  | 169.99   | 2     | 2          |
<span class="linenos" data-linenos="30 "></span>| Cobra AMP Cell Drive  | Bike &amp; Skate Shop  | 169.99   | 2     | 2          |
<span class="linenos" data-linenos="31 "></span>| Cleveland Golf Class  | Bike &amp; Skate Shop  | 119.99   | 4     | 3          |
<span class="linenos" data-linenos="32 "></span>| Callaway X Hot Drive  | Bike &amp; Skate Shop  | 0.0      | 5     | 4          |
<span class="linenos" data-linenos="33 "></span>+-----------------------+--------------------+----------+-------+------------+
</code></pre></div>
<p>La función <strong><code>row_number</code></strong> permite numerar los resultados, da igual que tengamos elementos que repiten valor:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">categoria</span><span class="p">,</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">precio</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">numfila</span>
<span class="linenos" data-linenos="3 "></span><span class="k">from</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="4 "></span><span class="k">where</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------+--------------------+----------+----------+
<span class="linenos" data-linenos=" 2 "></span>|        nombre         |     categoria      |  precio  | numfila  |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------+--------------------+----------+----------+
<span class="linenos" data-linenos=" 4 "></span>| SOLE F85 Treadmill    | Basketball         | 1799.99  | 1        |
<span class="linenos" data-linenos=" 5 "></span>| SOLE E25 Elliptical   | Basketball         | 999.99   | 2        |
<span class="linenos" data-linenos=" 6 "></span>| Diamondback Adult Re  | Basketball         | 349.98   | 3        |
<span class="linenos" data-linenos=" 7 "></span>| Diamondback Adult Ou  | Basketball         | 309.99   | 4        |
<span class="hll"><span class="linenos" data-linenos=" 8 "></span>| Diamondback Girls&#39; C  | Basketball         | 299.99   | 5        |
</span><span class="hll"><span class="linenos" data-linenos=" 9 "></span>| Diamondback Boys&#39; In  | Basketball         | 299.99   | 6        |
</span><span class="linenos" data-linenos="10 "></span>| Diamondback Adult So  | Basketball         | 299.98   | 7        |
<span class="linenos" data-linenos="11 "></span>| Easton Mako Youth Ba  | Basketball         | 249.97   | 8        |
<span class="linenos" data-linenos="12 "></span>| Fitness Gear 300 lb   | Basketball         | 209.99   | 9        |
<span class="linenos" data-linenos="13 "></span>| Quik Shade Summit SX  | Basketball         | 199.99   | 10       |
<span class="linenos" data-linenos="14 "></span>| Easton XL1 Youth Bat  | Basketball         | 179.97   | 11       |
<span class="linenos" data-linenos="15 "></span>| Easton S1 Youth Bat   | Basketball         | 179.97   | 12       |
<span class="linenos" data-linenos="16 "></span>| adidas Brazuca 2014   | Basketball         | 159.99   | 13       |
<span class="linenos" data-linenos="17 "></span>| Quest 12&#39; x 12&#39; Dome  | Basketball         | 149.99   | 14       |
<span class="linenos" data-linenos="18 "></span>| Fitbit Flex Wireless  | Basketball         | 99.95    | 15       |
<span class="linenos" data-linenos="19 "></span>| Nike+ Fuelband SE     | Basketball         | 99.0     | 16       |
<span class="linenos" data-linenos="20 "></span>| Elevation Training M  | Basketball         | 79.99    | 17       |
<span class="linenos" data-linenos="21 "></span>| MAC Sports Collapsib  | Basketball         | 69.99    | 18       |
<span class="linenos" data-linenos="22 "></span>| Quest Q64 10 FT. x 1  | Basketball         | 59.98    | 19       |
<span class="linenos" data-linenos="23 "></span>| adidas Brazuca 2014   | Basketball         | 39.99    | 20       |
<span class="linenos" data-linenos="24 "></span>| Kijaro Dual Lock Cha  | Basketball         | 29.99    | 21       |
<span class="linenos" data-linenos="25 "></span>| adidas Brazuca 2014   | Basketball         | 29.99    | 22       |
<span class="linenos" data-linenos="26 "></span>| Nike Women&#39;s Pro Cor  | Basketball         | 28.0     | 23       |
<span class="linenos" data-linenos="27 "></span>| Nike Women&#39;s Pro Vic  | Basketball         | 21.99    | 24       |
<span class="linenos" data-linenos="28 "></span>| Nike VR_S Covert Dri  | Bike &amp; Skate Shop  | 179.99   | 1        |
<span class="linenos" data-linenos="29 "></span>| TaylorMade RocketBal  | Bike &amp; Skate Shop  | 169.99   | 2        |
<span class="linenos" data-linenos="30 "></span>| Cobra AMP Cell Drive  | Bike &amp; Skate Shop  | 169.99   | 3        |
<span class="linenos" data-linenos="31 "></span>| Cleveland Golf Class  | Bike &amp; Skate Shop  | 119.99   | 4        |
<span class="linenos" data-linenos="32 "></span>| Callaway X Hot Drive  | Bike &amp; Skate Shop  | 0.0      | 5        |
<span class="linenos" data-linenos="33 "></span>+-----------------------+--------------------+----------+----------+
</code></pre></div>
<h3 id="consultas-por-posicion">Consultas por posición<a class="headerlink" href="#consultas-por-posicion" title="Permanent link">&para;</a></h3>
<p>A continuación vamos a ver las funciones <strong><code>lead</code></strong> y <strong><code>lag</code></strong>. Estas funciones se encargan de obtener el valor posterior y anterior respecto a un valor.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">categoria</span><span class="p">,</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">lead</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">precio</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sig</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="n">lag</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">precio</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ant</span>
<span class="linenos" data-linenos="4 "></span><span class="k">from</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="5 "></span><span class="k">where</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------+--------------------+----------+---------+----------+
<span class="linenos" data-linenos=" 2 "></span>|        nombre         |     categoria      |  precio  |   sig   |   ant    |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------+--------------------+----------+---------+----------+
<span class="linenos" data-linenos=" 4 "></span>| SOLE F85 Treadmill    | Basketball         | 1799.99  | 999.99  | NULL     |
<span class="linenos" data-linenos=" 5 "></span>| SOLE E25 Elliptical   | Basketball         | 999.99   | 349.98  | 1799.99  |
<span class="linenos" data-linenos=" 6 "></span>| Diamondback Adult Re  | Basketball         | 349.98   | 309.99  | 999.99   |
<span class="linenos" data-linenos=" 7 "></span>| Diamondback Adult Ou  | Basketball         | 309.99   | 299.99  | 349.98   |
<span class="linenos" data-linenos=" 8 "></span>| Diamondback Girls&#39; C  | Basketball         | 299.99   | 299.99  | 309.99   |
<span class="linenos" data-linenos=" 9 "></span>| Diamondback Boys&#39; In  | Basketball         | 299.99   | 299.98  | 299.99   |
<span class="linenos" data-linenos="10 "></span>| Diamondback Adult So  | Basketball         | 299.98   | 249.97  | 299.99   |
<span class="linenos" data-linenos="11 "></span>| Easton Mako Youth Ba  | Basketball         | 249.97   | 209.99  | 299.98   |
<span class="linenos" data-linenos="12 "></span>| Fitness Gear 300 lb   | Basketball         | 209.99   | 199.99  | 249.97   |
<span class="linenos" data-linenos="13 "></span>| Quik Shade Summit SX  | Basketball         | 199.99   | 179.97  | 209.99   |
<span class="linenos" data-linenos="14 "></span>| Easton XL1 Youth Bat  | Basketball         | 179.97   | 179.97  | 199.99   |
<span class="linenos" data-linenos="15 "></span>| Easton S1 Youth Bat   | Basketball         | 179.97   | 159.99  | 179.97   |
<span class="linenos" data-linenos="16 "></span>| adidas Brazuca 2014   | Basketball         | 159.99   | 149.99  | 179.97   |
<span class="linenos" data-linenos="17 "></span>| Quest 12&#39; x 12&#39; Dome  | Basketball         | 149.99   | 99.95   | 159.99   |
<span class="linenos" data-linenos="18 "></span>| Fitbit Flex Wireless  | Basketball         | 99.95    | 99.0    | 149.99   |
<span class="linenos" data-linenos="19 "></span>| Nike+ Fuelband SE     | Basketball         | 99.0     | 79.99   | 99.95    |
<span class="linenos" data-linenos="20 "></span>| Elevation Training M  | Basketball         | 79.99    | 69.99   | 99.0     |
<span class="linenos" data-linenos="21 "></span>| MAC Sports Collapsib  | Basketball         | 69.99    | 59.98   | 79.99    |
<span class="linenos" data-linenos="22 "></span>| Quest Q64 10 FT. x 1  | Basketball         | 59.98    | 39.99   | 69.99    |
<span class="linenos" data-linenos="23 "></span>| adidas Brazuca 2014   | Basketball         | 39.99    | 29.99   | 59.98    |
<span class="linenos" data-linenos="24 "></span>| Kijaro Dual Lock Cha  | Basketball         | 29.99    | 29.99   | 39.99    |
<span class="linenos" data-linenos="25 "></span>| adidas Brazuca 2014   | Basketball         | 29.99    | 28.0    | 29.99    |
<span class="linenos" data-linenos="26 "></span>| Nike Women&#39;s Pro Cor  | Basketball         | 28.0     | 21.99   | 29.99    |
<span class="linenos" data-linenos="27 "></span>| Nike Women&#39;s Pro Vic  | Basketball         | 21.99    | NULL    | 28.0     |
<span class="linenos" data-linenos="28 "></span>| Nike VR_S Covert Dri  | Bike &amp; Skate Shop  | 179.99   | 169.99  | NULL     |
<span class="linenos" data-linenos="29 "></span>| TaylorMade RocketBal  | Bike &amp; Skate Shop  | 169.99   | 169.99  | 179.99   |
<span class="linenos" data-linenos="30 "></span>| Cobra AMP Cell Drive  | Bike &amp; Skate Shop  | 169.99   | 119.99  | 169.99   |
<span class="linenos" data-linenos="31 "></span>| Cleveland Golf Class  | Bike &amp; Skate Shop  | 119.99   | 0.0     | 169.99   |
<span class="linenos" data-linenos="32 "></span>| Callaway X Hot Drive  | Bike &amp; Skate Shop  | 0.0      | NULL    | 119.99   |
<span class="linenos" data-linenos="33 "></span>+-----------------------+--------------------+----------+---------+----------+
</code></pre></div>
<h3 id="consultas-de-agregacion">Consultas de agregación<a class="headerlink" href="#consultas-de-agregacion" title="Permanent link">&para;</a></h3>
<p>Las funciones de agregación que ya conocemos como <strong><code>count</code></strong>, <strong><code>sum</code></strong>, <strong><code>min</code></strong> y <strong><code>max</code></strong> también las podemos aplicar sobre particiones de datos y así poder mostrar los datos agregados para cada elemento:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">categoria</span><span class="p">,</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cantidad</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="k">min</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">menor</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="k">max</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mayor</span>
<span class="linenos" data-linenos="5 "></span><span class="k">from</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="6 "></span><span class="k">where</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------+--------------------+-----------+--------+----------+
<span class="linenos" data-linenos=" 2 "></span>|        nombre         |     categoria      | cantidad  | menor  |  mayor   |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------+--------------------+-----------+--------+----------+
<span class="linenos" data-linenos=" 4 "></span>| Fitbit Flex Wireless  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos=" 5 "></span>| adidas Brazuca 2014   | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos=" 6 "></span>| Fitness Gear 300 lb   | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos=" 7 "></span>| Diamondback Adult Re  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos=" 8 "></span>| Nike+ Fuelband SE     | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos=" 9 "></span>| Elevation Training M  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="10 "></span>| Easton XL1 Youth Bat  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="11 "></span>| adidas Brazuca 2014   | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="12 "></span>| Diamondback Girls&#39; C  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="13 "></span>| Easton S1 Youth Bat   | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="14 "></span>| Easton Mako Youth Ba  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="15 "></span>| SOLE E25 Elliptical   | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="16 "></span>| Diamondback Adult Ou  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="17 "></span>| Kijaro Dual Lock Cha  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="18 "></span>| MAC Sports Collapsib  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="19 "></span>| adidas Brazuca 2014   | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="20 "></span>| SOLE F85 Treadmill    | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="21 "></span>| Quest Q64 10 FT. x 1  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="22 "></span>| Diamondback Boys&#39; In  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="23 "></span>| Diamondback Adult So  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="24 "></span>| Nike Women&#39;s Pro Cor  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="25 "></span>| Quik Shade Summit SX  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="26 "></span>| Quest 12&#39; x 12&#39; Dome  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="27 "></span>| Nike Women&#39;s Pro Vic  | Basketball         | 24        | 21.99  | 1799.99  |
<span class="linenos" data-linenos="28 "></span>| Cleveland Golf Class  | Bike &amp; Skate Shop  | 5         | 0.0    | 179.99   |
<span class="linenos" data-linenos="29 "></span>| TaylorMade RocketBal  | Bike &amp; Skate Shop  | 5         | 0.0    | 179.99   |
<span class="linenos" data-linenos="30 "></span>| Callaway X Hot Drive  | Bike &amp; Skate Shop  | 5         | 0.0    | 179.99   |
<span class="linenos" data-linenos="31 "></span>| Nike VR_S Covert Dri  | Bike &amp; Skate Shop  | 5         | 0.0    | 179.99   |
<span class="linenos" data-linenos="32 "></span>| Cobra AMP Cell Drive  | Bike &amp; Skate Shop  | 5         | 0.0    | 179.99   |
<span class="linenos" data-linenos="33 "></span>+-----------------------+--------------------+-----------+--------+----------+
</code></pre></div>
<p>Las consultas que hemos visto en este caso de uso también se conocen como <a href="https://cwiki.apache.org/confluence/display/hive/languagemanual+windowingandanalytics"><strong>funciones ventana</strong></a>, ya que se ejecutan sobre un subconjunto de los datos. La ventana viene dada por la partición o por la posición una vez ordenados los datos.</p>
<p>Los posibles valores son:</p>
<ul>
<li><code>rows between current row and unbounded following</code>: desde la fila actual hasta el final de la ventana/partición.</li>
<li><code>rows between current row and N following</code>: desde la fila actual hasta los N siguientes.</li>
<li><code>rows between unbounded preceding and current row</code>: desde el inicio de la ventana hasta la fila actual.</li>
<li><code>rows between unbounded preceding and N following</code>: desde el inicio de la ventana hasta los N siguientes.</li>
<li><code>rows between unbounded preceding and unbounded following</code>: desde el inicio de la ventana hasta el final de la ventana (caso por defecto)</li>
<li><code>rows between N preceding and M following</code>: desde N filas anteriores hasta M filas siguientes.</li>
</ul>
<p>Por ejemplo, para obtener el máximo precio desde la fila actual hasta el resto de la partición:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">categoria</span><span class="p">,</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="k">max</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="k">rows</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">unbounded</span><span class="w"> </span><span class="n">following</span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mayor</span>
<span class="linenos" data-linenos="6 "></span><span class="k">from</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="7 "></span><span class="k">where</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------+--------------------+----------+----------+
<span class="linenos" data-linenos=" 2 "></span>|        nombre         |     categoria      |  precio  |  mayor   |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------+--------------------+----------+----------+
<span class="linenos" data-linenos=" 4 "></span>| Fitbit Flex Wireless  | Basketball         | 99.95    | 1799.99  |
<span class="linenos" data-linenos=" 5 "></span>| adidas Brazuca 2014   | Basketball         | 39.99    | 1799.99  |
<span class="linenos" data-linenos=" 6 "></span>| Fitness Gear 300 lb   | Basketball         | 209.99   | 1799.99  |
<span class="linenos" data-linenos=" 7 "></span>| Diamondback Adult Re  | Basketball         | 349.98   | 1799.99  |
<span class="linenos" data-linenos=" 8 "></span>| Nike+ Fuelband SE     | Basketball         | 99.0     | 1799.99  |
<span class="linenos" data-linenos=" 9 "></span>| Elevation Training M  | Basketball         | 79.99    | 1799.99  |
<span class="linenos" data-linenos="10 "></span>| Easton XL1 Youth Bat  | Basketball         | 179.97   | 1799.99  |
<span class="linenos" data-linenos="11 "></span>| adidas Brazuca 2014   | Basketball         | 29.99    | 1799.99  |
<span class="linenos" data-linenos="12 "></span>| Diamondback Girls&#39; C  | Basketball         | 299.99   | 1799.99  |
<span class="linenos" data-linenos="13 "></span>| Easton S1 Youth Bat   | Basketball         | 179.97   | 1799.99  |
<span class="linenos" data-linenos="14 "></span>| Easton Mako Youth Ba  | Basketball         | 249.97   | 1799.99  |
<span class="linenos" data-linenos="15 "></span>| SOLE E25 Elliptical   | Basketball         | 999.99   | 1799.99  |
<span class="linenos" data-linenos="16 "></span>| Diamondback Adult Ou  | Basketball         | 309.99   | 1799.99  |
<span class="linenos" data-linenos="17 "></span>| Kijaro Dual Lock Cha  | Basketball         | 29.99    | 1799.99  |
<span class="linenos" data-linenos="18 "></span>| MAC Sports Collapsib  | Basketball         | 69.99    | 1799.99  |
<span class="linenos" data-linenos="19 "></span>| adidas Brazuca 2014   | Basketball         | 159.99   | 1799.99  |
<span class="linenos" data-linenos="20 "></span>| SOLE F85 Treadmill    | Basketball         | 1799.99  | 1799.99  |
<span class="linenos" data-linenos="21 "></span>| Quest Q64 10 FT. x 1  | Basketball         | 59.98    | 299.99   |
<span class="linenos" data-linenos="22 "></span>| Diamondback Boys&#39; In  | Basketball         | 299.99   | 299.99   |
<span class="linenos" data-linenos="23 "></span>| Diamondback Adult So  | Basketball         | 299.98   | 299.98   |
<span class="linenos" data-linenos="24 "></span>| Nike Women&#39;s Pro Cor  | Basketball         | 28.0     | 199.99   |
<span class="linenos" data-linenos="25 "></span>| Quik Shade Summit SX  | Basketball         | 199.99   | 199.99   |
<span class="linenos" data-linenos="26 "></span>| Quest 12&#39; x 12&#39; Dome  | Basketball         | 149.99   | 149.99   |
<span class="linenos" data-linenos="27 "></span>| Nike Women&#39;s Pro Vic  | Basketball         | 21.99    | 21.99    |
<span class="linenos" data-linenos="28 "></span>| Cleveland Golf Class  | Bike &amp; Skate Shop  | 119.99   | 179.99   |
<span class="linenos" data-linenos="29 "></span>| TaylorMade RocketBal  | Bike &amp; Skate Shop  | 169.99   | 179.99   |
<span class="linenos" data-linenos="30 "></span>| Callaway X Hot Drive  | Bike &amp; Skate Shop  | 0.0      | 179.99   |
<span class="linenos" data-linenos="31 "></span>| Nike VR_S Covert Dri  | Bike &amp; Skate Shop  | 179.99   | 179.99   |
<span class="linenos" data-linenos="32 "></span>| Cobra AMP Cell Drive  | Bike &amp; Skate Shop  | 169.99   | 169.99   |
<span class="linenos" data-linenos="33 "></span>+-----------------------+--------------------+----------+----------+
</code></pre></div>
<p>Si queremos comparar el precio y quedarnos con el mayor respecto al anterior y el posterior podríamos realizar la siguiente consulta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">categoria</span><span class="p">,</span><span class="w"> </span><span class="n">precio</span><span class="p">,</span><span class="w"> </span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="k">max</span><span class="p">(</span><span class="n">precio</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">categoria</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="k">rows</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">preceding</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">following</span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mayor</span>
<span class="linenos" data-linenos="6 "></span><span class="k">from</span><span class="w"> </span><span class="n">productos</span>
<span class="linenos" data-linenos="7 "></span><span class="k">where</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bike &amp; Skate Shop&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">categoria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Basketball&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------+--------------------+----------+----------+
<span class="linenos" data-linenos=" 2 "></span>|        nombre         |     categoria      |  precio  |  mayor   |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------+--------------------+----------+----------+
<span class="linenos" data-linenos=" 4 "></span>| Fitbit Flex Wireless  | Basketball         | 99.95    | 99.95    |
<span class="linenos" data-linenos=" 5 "></span>| adidas Brazuca 2014   | Basketball         | 39.99    | 209.99   |
<span class="linenos" data-linenos=" 6 "></span>| Fitness Gear 300 lb   | Basketball         | 209.99   | 349.98   |
<span class="linenos" data-linenos=" 7 "></span>| Diamondback Adult Re  | Basketball         | 349.98   | 349.98   |
<span class="linenos" data-linenos=" 8 "></span>| Nike+ Fuelband SE     | Basketball         | 99.0     | 349.98   |
<span class="linenos" data-linenos=" 9 "></span>| Elevation Training M  | Basketball         | 79.99    | 179.97   |
<span class="linenos" data-linenos="10 "></span>| Easton XL1 Youth Bat  | Basketball         | 179.97   | 179.97   |
<span class="linenos" data-linenos="11 "></span>| adidas Brazuca 2014   | Basketball         | 29.99    | 299.99   |
<span class="linenos" data-linenos="12 "></span>| Diamondback Girls&#39; C  | Basketball         | 299.99   | 299.99   |
<span class="linenos" data-linenos="13 "></span>| Easton S1 Youth Bat   | Basketball         | 179.97   | 299.99   |
<span class="linenos" data-linenos="14 "></span>| Easton Mako Youth Ba  | Basketball         | 249.97   | 999.99   |
<span class="linenos" data-linenos="15 "></span>| SOLE E25 Elliptical   | Basketball         | 999.99   | 999.99   |
<span class="linenos" data-linenos="16 "></span>| Diamondback Adult Ou  | Basketball         | 309.99   | 999.99   |
<span class="linenos" data-linenos="17 "></span>| Kijaro Dual Lock Cha  | Basketball         | 29.99    | 309.99   |
<span class="linenos" data-linenos="18 "></span>| MAC Sports Collapsib  | Basketball         | 69.99    | 159.99   |
<span class="linenos" data-linenos="19 "></span>| adidas Brazuca 2014   | Basketball         | 159.99   | 1799.99  |
<span class="linenos" data-linenos="20 "></span>| SOLE F85 Treadmill    | Basketball         | 1799.99  | 1799.99  |
<span class="linenos" data-linenos="21 "></span>| Quest Q64 10 FT. x 1  | Basketball         | 59.98    | 1799.99  |
<span class="linenos" data-linenos="22 "></span>| Diamondback Boys&#39; In  | Basketball         | 299.99   | 299.99   |
<span class="linenos" data-linenos="23 "></span>| Diamondback Adult So  | Basketball         | 299.98   | 299.99   |
<span class="linenos" data-linenos="24 "></span>| Nike Women&#39;s Pro Cor  | Basketball         | 28.0     | 299.98   |
<span class="linenos" data-linenos="25 "></span>| Quik Shade Summit SX  | Basketball         | 199.99   | 199.99   |
<span class="linenos" data-linenos="26 "></span>| Quest 12&#39; x 12&#39; Dome  | Basketball         | 149.99   | 199.99   |
<span class="linenos" data-linenos="27 "></span>| Nike Women&#39;s Pro Vic  | Basketball         | 21.99    | 149.99   |
<span class="linenos" data-linenos="28 "></span>| Cleveland Golf Class  | Bike &amp; Skate Shop  | 119.99   | 169.99   |
<span class="linenos" data-linenos="29 "></span>| TaylorMade RocketBal  | Bike &amp; Skate Shop  | 169.99   | 169.99   |
<span class="linenos" data-linenos="30 "></span>| Callaway X Hot Drive  | Bike &amp; Skate Shop  | 0.0      | 179.99   |
<span class="linenos" data-linenos="31 "></span>| Nike VR_S Covert Dri  | Bike &amp; Skate Shop  | 179.99   | 179.99   |
<span class="linenos" data-linenos="32 "></span>| Cobra AMP Cell Drive  | Bike &amp; Skate Shop  | 169.99   | 179.99   |
<span class="linenos" data-linenos="33 "></span>+-----------------------+--------------------+----------+----------+
</code></pre></div>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li>Página oficial de <a href="https://hive.apache.org">Hive</a></li>
<li><a href="https://www.packtpub.com/product/apache-hive-essentials-second-edition/9781788995092">Apache Hive Essentials - Second Edition</a> de <em>Dayong Du</em>.</li>
<li><a href="http://hortonworks.com/wp-content/uploads/2016/05/Hortonworks.CheatSheet.SQLtoHive.pdf">Hive Cheatsheet</a></li>
<li><a href="https://www.tutorialspoint.com/hive/index.htm">Tutorial de Hive</a> de TutorialsPoint.</li>
</ul>
<h2 id="actividades">Actividades<a class="headerlink" href="#actividades" title="Permanent link">&para;</a></h2>
<p>Siguiendo con los archivos cargados en HDFS en la sesión anterior y la base de datos <code>hiveiabd</code>:</p>
<ol>
<li>
<p>(<abbr title="Gestiona y almacena datos facilitando la búsqueda de respuestas en grandes conjuntos de datos.">RASBD.3</abbr> / <abbr title="Se ha fijado el objetivo de extraer valor de los datos para lo que es necesario contar con tecnologías eficientes.">CESBD.3b</abbr> y <abbr title="Se han desarrollado sistemas de gestión, almacenamiento y procesamiento de grandes volúmenes de datos de manera eficiente y segura, teniendo en cuenta la normativa existente.">CESBD.3d</abbr> / 1.5p) Crea una tabla interna transaccional llamada <code>ventas</code> en formato <em>ORC</em> y a continuación, rellénala con el resultado de realizar un <em>join</em> entre las tablas <code>sales</code> y <code>products</code> y <code>manufacturer</code>, particionando los datos por el país de la venta.</p>
<div class="admonition tip">
<p class="admonition-title">Crear y rellenar</p>
<p>Cuando utilizamos tablas particionadas, la sentencia <code>CREATE TABLE ventas AS SELECT ...</code> no funciona, por lo tanto, para esta actividad, primero deberemos realizar una <code>CREATE TABLE ventas (...) PARTITIONED BY (...) STORED AS... TBLPROPERTIES ('transactional'='true');</code> y a continuación un <code>INSERT INTO ventas PARTITION (...) SELECT ...</code></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Particionado dinámico</p>
<p>Recuerda que antes de insertar los datos es necesario configurar las siguientes propiedades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SET</span><span class="w"> </span><span class="n">hive</span><span class="p">.</span><span class="k">exec</span><span class="p">.</span><span class="k">dynamic</span><span class="p">.</span><span class="n">partition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="k">SET</span><span class="w"> </span><span class="n">hive</span><span class="p">.</span><span class="k">exec</span><span class="p">.</span><span class="k">dynamic</span><span class="p">.</span><span class="n">partition</span><span class="p">.</span><span class="k">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nonstrict</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">SET</span><span class="w"> </span><span class="n">hive</span><span class="p">.</span><span class="n">auto</span><span class="p">.</span><span class="k">convert</span><span class="p">.</span><span class="k">join</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
</code></pre></div>
</div>
<ol>
<li>¿Qué aparece al ejecutar el siguiente comando <code>hdfs dfs -ls /user/hive/warehouse/hiveiabd.db/ventas</code> ?</li>
</ol>
</li>
<li>
<p>(<abbr title="Gestiona y almacena datos facilitando la búsqueda de respuestas en grandes conjuntos de datos.">RASBD.3</abbr> / <abbr title="Se ha fijado el objetivo de extraer valor de los datos para lo que es necesario contar con tecnologías eficientes.">CESBD.3b</abbr> y <abbr title="Se han desarrollado sistemas de gestión, almacenamiento y procesamiento de grandes volúmenes de datos de manera eficiente y segura, teniendo en cuenta la normativa existente.">CESBD.3d</abbr> / 1p) Sobre la tabla de <code>ventas</code> recién creada, crea una vista materializada llamada <code>ventasPorFabricante</code> que obtenga la siguiente información de la recaudación obtenida por cada fabricante.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>+-----------------------------------+----------------------------------+
<span class="linenos" data-linenos=" 2 "></span>| ventasporfabricante.manufacturer  | ventasporfabricante.recaudacion  |
<span class="linenos" data-linenos=" 3 "></span>+-----------------------------------+----------------------------------+
<span class="linenos" data-linenos=" 4 "></span>| Abbas                             | 8504830.70993042                 |
<span class="linenos" data-linenos=" 5 "></span>| Aliqui                            | 4.960930444169426E7              |
<span class="linenos" data-linenos=" 6 "></span>| Barba                             | 4145604.8580932617               |
<span class="linenos" data-linenos=" 7 "></span>| Currus                            | 3.4098148993003845E7             |
<span class="linenos" data-linenos=" 8 "></span>| Fama                              | 3111286.106048584                |
<span class="linenos" data-linenos=" 9 "></span>| Leo                               | 4981597.603515625                |
<span class="linenos" data-linenos="10 "></span>| Natura                            | 7.659636524445343E7              |
<span class="linenos" data-linenos="11 "></span>| Palma                             | 1141784.282775879                |
<span class="linenos" data-linenos="12 "></span>| Pirum                             | 3.0881129688156128E7             |
<span class="linenos" data-linenos="13 "></span>| Pomum                             | 2290935.590690613                |
<span class="linenos" data-linenos="14 "></span>| Quibus                            | 7420492.980041504                |
<span class="linenos" data-linenos="15 "></span>| Salvus                            | 342236.4960708618                |
<span class="linenos" data-linenos="16 "></span>| VanArsdel                         | 2.5061688651968384E8             |
<span class="linenos" data-linenos="17 "></span>| Victoria                          | 3820327.428833008                |
<span class="linenos" data-linenos="18 "></span>+-----------------------------------+----------------------------------+
</code></pre></div>
<ol>
<li>
<p>Inserta el siguiente dato en la tabla <code>ventas</code> y comprueba si aparece en la vista <code>ventasPorFabricante</code> (fíjate en el fabricante <em>Natura</em>) y en HDFS:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">ventas</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">725</span><span class="p">,</span><span class="ss">&quot;2/15/2024&quot;</span><span class="p">,</span><span class="ss">&quot;03206&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">98765432</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;Natura RP-13&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Rural&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Productivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Natura&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Spain&quot;</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>Provoca que la vista materializada actualice su estado y muestra cómo el dato del paso anterior ya repercute en el resultado en la vista.</p>
</li>
</ol>
</li>
<li>
<p>(<abbr title="Gestiona y almacena datos facilitando la búsqueda de respuestas en grandes conjuntos de datos.">RASBD.3</abbr> / <abbr title="Se ha fijado el objetivo de extraer valor de los datos para lo que es necesario contar con tecnologías eficientes.">CESBD.3b</abbr> y <abbr title="Se han desarrollado sistemas de gestión, almacenamiento y procesamiento de grandes volúmenes de datos de manera eficiente y segura, teniendo en cuenta la normativa existente.">CESBD.3d</abbr> / 0.5p) Ejecuta la siguiente consulta que utiliza funciones ventana y explica qué realiza:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="n">manufacturer</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">revenue</span><span class="o">*</span><span class="n">units</span><span class="p">),</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">revenue</span><span class="o">*</span><span class="n">units</span><span class="p">)</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="k">FROM</span><span class="w"> </span><span class="n">ventas</span>
<span class="linenos" data-linenos="4 "></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">manufacturer</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>(<abbr title="Gestiona y almacena datos facilitando la búsqueda de respuestas en grandes conjuntos de datos.">RASBD.3</abbr> / <abbr title="Se ha fijado el objetivo de extraer valor de los datos para lo que es necesario contar con tecnologías eficientes.">CESBD.3b</abbr> y <abbr title="Se han desarrollado sistemas de gestión, almacenamiento y procesamiento de grandes volúmenes de datos de manera eficiente y segura, teniendo en cuenta la normativa existente.">CESBD.3d</abbr> / 1p) Basándote en el caso de uso 7:</p>
<ol>
<li>Crea un agente <em>Flume</em> que inserte datos de ventas en la ruta <code>/user/iabd/pdi/sales</code> y tras su ejecución, comprueba que los datos aparecen al realizar una consulta sobre la tabla <code>sales</code>. Para ello, crea un fichero CSV con el formato adecuado y algunos datos de muestra.</li>
<li>¿Aparecen estos datos en la tabla <code>ventas</code>? ¿Por qué?</li>
<li>En vez de la tabla <code>ventas</code>, ¿qué estructura utilizarías si queremos tener siempre los datos actualizados (se envían de forma diaria)? Implementa la solución elegida.</li>
</ol>
</li>
<li>
<p>(<abbr title="Gestiona y almacena datos facilitando la búsqueda de respuestas en grandes conjuntos de datos.">RASBD.3</abbr> / <abbr title="Se ha fijado el objetivo de extraer valor de los datos para lo que es necesario contar con tecnologías eficientes.">CESBD.3b</abbr> y <abbr title="Se han desarrollado sistemas de gestión, almacenamiento y procesamiento de grandes volúmenes de datos de manera eficiente y segura, teniendo en cuenta la normativa existente.">CESBD.3d</abbr> / 1p extra) A partir de la base de datos <code>retail_db</code>, importa las tablas <code>orders</code> y <code>order_items</code>, en las cuales puedes obtener la cantidad de productos que contiene un pedido. Utilizando todas las tablas que ya hemos importado en los casos de uso de los apuntes, crea una tabla externa en <em>Hive</em> llamada <code>pedidos</code> utilizando 8 <em>buckets</em> con el código del cliente, que contenga:</p>
<ul>
<li>Código y fecha del pedido.</li>
<li>Precio del pedido (sumando las líneas de pedido).</li>
<li>Código, nombre y apellidos del cliente.</li>
</ul>
<p>Adjunta <em>scripts</em> y capturas de:</p>
<ul>
<li>la importación, creación y carga de datos de las tablas que necesites.</li>
<li>la definición de la tabla: <code>describe formatted pedidos;</code></li>
<li>contenido de HDFS que demuestre la creación de los <em>buckets</em>.</li>
</ul>
</li>
</ol>
<!--

2223
  ** Ejemplos de particionado / bucketing ... poner resultado de las operaciones / consultas
    Ejemplo Athena curso AWS DE
      https://docs.aws.amazon.com/es_es/athena/latest/ug/ctas-partitioning-and-bucketing.html
      Sobre el dataset de taxis-yellos
      Consultas con where por fechas sobre la tabla
      Crear particiones por meses, y hace una consulta sobre una partición

  Explicar mejor el bucketing

2425
  Cambiar versión de Hive
  Cambiar instalación para utilizar tez o spark como motor de ejecución

  DROP partition -> ALTER TABLE pv_users DROP PARTITION (ds='2008-08-08')
--->







  
  



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        <a href='https://ko-fi.com/T6T8GWT9N' title='Invítame a un café en ko-fi.com' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Invítame a un café en ko-fi.com' /></a>
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="Me encantan estos apuntes" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="Los apuntes son mejorables" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Gracias por tu tiempo. Si quieres me puedes <a href='https://ko-fi.com/T6T8GWT9N'>invitar a un café en ko-fi</a>.
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              ¡Gracias por tu colaboración! Ayúdame a mejorar los apuntes enviándome un mail a <a href="mailto:a.medrano@edu.gva.es">a.medrano@edu.gva.es</a> con tus comentarios.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="hive1.html" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Hive I">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Hive I
              </div>
            </div>
          </a>
        
        
          
          <a href="../spark/spark.html" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Ecosistema Spark">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                Ecosistema Spark
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Aitor Medrano - <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es">Licencia CC BY-NC-SA</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://aitor-medrano.github.io/" target="_blank" rel="noopener" title="aitor-medrano.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.top", "navigation.tracking", "navigation.footer", "navigation.indexes", "content.code.annotate", "announce.dismiss", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>