
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Apuntes y ejercicios sobre el acceso a bases de datos relacionales mediante JDBC en Spark. Uso del catálogo de Spark SQL, creación de tablas y consultas al Hive Metastore.">
      
      
      
        <link rel="canonical" href="https://aitor-medrano.github.io/iabd/spark/catalog.html">
      
      
        <link rel="prev" href="agregaciones.html">
      
      
        <link rel="next" href="deltalake.html">
      
      
      <link rel="icon" href="../favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Spark JDBC y Spark Catalog. - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VKM8BDY6KT"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VKM8BDY6KT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VKM8BDY6KT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Spark JDBC y Spark Catalog. - Inteligencia Artificial y Big Data" >
      
        <meta  property="og:description"  content="Apuntes y ejercicios sobre el acceso a bases de datos relacionales mediante JDBC en Spark. Uso del catálogo de Spark SQL, creación de tablas y consultas al Hive Metastore." >
      
        <meta  property="og:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/spark/catalog.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aitor-medrano.github.io/iabd/spark/catalog.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Spark JDBC y Spark Catalog. - Inteligencia Artificial y Big Data" >
      
        <meta  name="twitter:description"  content="Apuntes y ejercicios sobre el acceso a bases de datos relacionales mediante JDBC en Spark. Uso del catálogo de Spark SQL, creación de tablas y consultas al Hive Metastore." >
      
        <meta  name="twitter:image"  content="https://aitor-medrano.github.io/iabd/assets/images/social/spark/catalog.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spark-jdbc" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spark JDBC y Spark Catalog.
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2324.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning 23/24
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NoSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            NoSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/nosql.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento de datos. NoSQL
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/mongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/modelado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelado documental
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones en MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/rendimiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendimiento
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/replicacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replicación y particionado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/pymongo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB y Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sa/series-temporales.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Series temporales
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/cloud.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/aws.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/s3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/ec2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/lambda.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/rds.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/dynamodb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DynamoDB
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/waf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WAF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/escalado.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitorización y Escalado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/emr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMR
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/athena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Athena
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud/glue.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glue
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingeniería de Datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Ingeniería de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/bigdata.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/de.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingeniería de datos
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/arq.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arquitecturas Big Data
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/etl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingesta de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/pentaho.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pentaho
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/formatos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formatos de datos
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../de/faker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Faker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ecosistema Hadoop
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ecosistema Hadoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hadoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hadoop
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hdfs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/sqoop.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sqoop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/flume.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flume
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hive1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive I
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/hive2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive II
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="spark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ecosistema Spark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rdd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RDD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dataframeAPI.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataFrames API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="agregaciones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agregaciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Spark JDBC
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="catalog.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Spark JDBC
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spark-jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      Spark JDBC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spark JDBC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leyendo-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Leyendo datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escribiendo-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Escribiendo datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilizando-databricks" class="md-nav__link">
    <span class="md-ellipsis">
      Utilizando Databricks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      Spark MongoDB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spark MongoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mongo-spark-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Mongo Spark Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql-catalog" class="md-nav__link">
    <span class="md-ellipsis">
      Spark SQL Catalog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spark SQL Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bases-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Bases de datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trabajando-con-tablas" class="md-nav__link">
    <span class="md-ellipsis">
      Trabajando con tablas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-y-el-metastore" class="md-nav__link">
    <span class="md-ellipsis">
      Spark y el Metastore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facilitando-el-descubrimiento-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Facilitando el descubrimiento de datos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deltalake.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Lake
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="streaming.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming
  </span>
  
    
  
  
    <span class="md-status md-status--updated" title="Modificado">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="join-window.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windowing y Joins
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Flujo de datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Flujo de datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/nifi2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nifi II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/kafka2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka II
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/airflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transferencia de conocimiento
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Transferencia de conocimiento
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/transferencia.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reaprendiendo
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/hf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugging Face
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/datasets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../audio/audio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tratamiento de Audio
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../audio/audio-hf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio en Hugging Face
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="Recién añadido">
    </span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pia/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    PIA
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            PIA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            Lara 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/01presentacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/02requisitos.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prototipado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/03visitaVK.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Victoria Kent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/04almacenamiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/05audio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento audio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/11dataset.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creando el dataset
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
        
          
          <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lara 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_3">
            <span class="md-nav__icon md-icon"></span>
            Lara 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/21conociendo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Lara
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/22captura.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capturando audios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/29dataset.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creando el dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/30entrenamiento.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entrenando
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/31refinando.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refinando
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/32evaluando.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluando
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <label class="md-nav__link" for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 22/23
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 22/23
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/06autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presentación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/07navarrosantafe.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/08timeseries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Almacenamiento datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/09powerbi.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/10actuadores.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actuadores
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_5" >
        
          
          <label class="md-nav__link" for="__nav_10_5" id="__nav_10_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Autoponic 23/24
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_5">
            <span class="md-nav__icon md-icon"></span>
            Autoponic 23/24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/23autoponic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conociendo Autoponic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/24nodered.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node-RED
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/25villena.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visita IES Navarro Santafé
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/26modelo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelo de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pia/27dashboard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cuadro de mandos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../blog/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_2" >
        
          
          <label class="md-nav__link" for="__nav_12_2" id="__nav_12_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archivo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_2">
            <span class="md-nav__icon md-icon"></span>
            Archivo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_3" >
        
          
          <label class="md-nav__link" for="__nav_12_3" id="__nav_12_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categorías
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_3">
            <span class="md-nav__icon md-icon"></span>
            Categorías
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2023.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/abril.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abril
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/agosto.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agosto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/diciembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diciembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/enero.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/febrero.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Febrero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/julio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Julio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/junio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Junio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/marzo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Marzo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/mayo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mayo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noticias.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noticias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/noviembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noviembre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/octubre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octubre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/septiembre.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Septiembre
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spark-jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      Spark JDBC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spark JDBC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leyendo-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Leyendo datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escribiendo-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Escribiendo datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilizando-databricks" class="md-nav__link">
    <span class="md-ellipsis">
      Utilizando Databricks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      Spark MongoDB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spark MongoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mongo-spark-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Mongo Spark Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql-catalog" class="md-nav__link">
    <span class="md-ellipsis">
      Spark SQL Catalog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spark SQL Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bases-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Bases de datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trabajando-con-tablas" class="md-nav__link">
    <span class="md-ellipsis">
      Trabajando con tablas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-y-el-metastore" class="md-nav__link">
    <span class="md-ellipsis">
      Spark y el Metastore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#facilitando-el-descubrimiento-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Facilitando el descubrimiento de datos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    <span class="md-ellipsis">
      Referencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <a href="../tags.html#spark" class="md-tag">Spark</a>
    
  
    
    
    
      <a href="../tags.html#sbd-ra1" class="md-tag">SBD RA1</a>
    
  
</nav>



  <h1>Spark JDBC</h1>

<h2 id="spark-jdbc">Spark JDBC<a class="headerlink" href="#spark-jdbc" title="Permanent link">&para;</a></h2>
<p>Para conectar desde <a href="https://spark.apache.org/docs/latest/sql-data-sources-jdbc.html">Spark con una base de datos relacional</a> (<em>RDBMS</em>) necesitamos:</p>
<ul>
<li>un driver JDBC compatible</li>
<li>las <a href="https://spark.apache.org/docs/latest/sql-data-sources-jdbc.html#data-source-option">propiedades de conexión</a> a la base de datos.</li>
</ul>
<p>En <em>PySpark</em>, el <em>driver</em> lo podemos añadir directamente a la carpeta <code>jars</code> disponible en <code>$SPARK_HOME</code>, o a la hora de lanzar <em>Spark</em> utilizando la opción <code>--jars &lt;fichero1.jar&gt;,&lt;fichero2.jar&gt;</code> o <code>--packages &lt;groupId:artifactId:version&gt;</code>.</p>
<p>Así pues, para conectar con nuestra base de datos <code>retail_db</code> que tenemos configurada en la máquina virtual, primero copiaremos el <a href="resources/mysql-connector-j-8.0.31.jar">driver de MySQL</a> en la carpeta <code>$SPARK_HOME/jars</code>.</p>
<p>Si tuviéramos problemas a la hora de crear la conexión con la base de datos, indicaremos en la configuración qué archivos añadimos al <em>classpath</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;s8a-dataframes-jdbc&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="2 "></span>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s1">&#39;spark.driver.extraClassPath&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql-connector-j-8.0.31.jar&#39;</span><span class="p">)</span> \
<span class="linenos" data-linenos="3 "></span>    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</code></pre></div>
<p>El siguiente paso es configurar la conexión a la base de datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">url_iabd</span> <span class="o">=</span> <span class="s2">&quot;jdbc:mysql://localhost/retail_db&quot;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">propiedades</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span>    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;iabd&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span>    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;iabd&quot;</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Spark y MySQL con Docker</p>
<p>Para poder acceder a MySQL desde la imagen de Spark, necesitamos que formen parte de la misma red. Para ello, lo más cómodo es utilizar <em>Docker Compose</em> y definir las dependencias:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">services</span><span class="p">:</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="nt">spark</span><span class="p">:</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupyter/pyspark-notebook</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iabd-spark</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8888:8888&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;4040:4040&quot;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;4041:4041&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">        </span><span class="nt">links</span><span class="p">:</span>
<span class="linenos" data-linenos="10 "></span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="linenos" data-linenos="11 "></span><span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="linenos" data-linenos="12 "></span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./:/home/jovyan/work</span>
<span class="linenos" data-linenos="13 "></span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./mysql-connector-j-8.0.31.jar:/usr/local/spark/jars/mysql-connector-j-8.0.31.jar</span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="nt">mysql</span><span class="p">:</span>
<span class="linenos" data-linenos="15 "></span><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:latest</span>
<span class="linenos" data-linenos="16 "></span><span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iabd-mysql</span>
<span class="linenos" data-linenos="17 "></span><span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--default-authentication-plugin=mysql_native_password</span>
<span class="linenos" data-linenos="18 "></span><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="linenos" data-linenos="19 "></span><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3306:3306&quot;</span>
<span class="linenos" data-linenos="20 "></span><span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="linenos" data-linenos="21 "></span><span class="w">          </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Europe/Madrid</span>
<span class="linenos" data-linenos="22 "></span><span class="w">          </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iabd</span>
<span class="linenos" data-linenos="23 "></span><span class="w">          </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">retail_db</span>
<span class="linenos" data-linenos="24 "></span><span class="w">          </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iabd</span>
<span class="linenos" data-linenos="25 "></span><span class="w">          </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iabd</span>
</code></pre></div>
<p>Una vez colocado el <a href="resources/mysql-connector-j-8.0.31.jar">driver de MySQL</a> en la misma carpeta, lanzamos <em>docker-compose</em>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker-compose<span class="w"> </span>-p<span class="w"> </span>iabd-spark-mysql<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<p>Tras arrancar los contenedores, la primera vez, deberemos cargar la <a href="resources/create_db.sql">base de datos</a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>iabd-mysql<span class="w"> </span>mysql<span class="w"> </span>-h<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>-P<span class="w"> </span><span class="m">3306</span><span class="w"> </span>-uiabd<span class="w"> </span>-piabd<span class="w"> </span>retail_db<span class="w"> </span>&lt;<span class="w"> </span>create_db.sql
</code></pre></div>
<p>A partir de aquí, es importante destacar que la <em>url</em> de conexión a la base de datos, en vez de acceder a <code>localhost</code>, lo hace al nombre del contenedor <code>iabd-mysql</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">url_iabd</span> <span class="o">=</span> <span class="s2">&quot;jdbc:mysql://iabd-mysql/retail_db&quot;</span>
</code></pre></div>
</div>
<h3 id="leyendo-datos">Leyendo datos<a class="headerlink" href="#leyendo-datos" title="Permanent link">&para;</a></h3>
<p>Para finalmente cargar los datos mediante el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrameReader.jdbc.html"><code>read.jdbc</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">jdbc</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_iabd</span><span class="p">,</span>\
<span class="linenos" data-linenos="2 "></span>    <span class="n">table</span><span class="o">=</span><span class="s2">&quot;customers&quot;</span><span class="p">,</span>\
<span class="linenos" data-linenos="3 "></span>    <span class="n">properties</span><span class="o">=</span><span class="n">propiedades</span><span class="p">)</span> 
</code></pre></div>
<p>Y sobre el <em>dataframe</em>, ya podemos obtener su esquema y realizar las transformaciones que necesitemos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1"># root</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">#  |-- customer_id: integer (nullable = true)</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">#  |-- customer_fname: string (nullable = true)</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">#  |-- customer_lname: string (nullable = true)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">#  |-- customer_email: string (nullable = true)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">#  |-- customer_password: string (nullable = true)</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">#  |-- customer_street: string (nullable = true)</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">#  |-- customer_city: string (nullable = true)</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">#  |-- customer_state: string (nullable = true)</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">#  |-- customer_zipcode: string (nullable = true)</span>
<span class="linenos" data-linenos="12 "></span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span><span class="c1"># +-----------+--------------+--------------+--------------+-----------------+--------------------+-------------+--------------+----------------+</span>
<span class="linenos" data-linenos="14 "></span><span class="c1"># |customer_id|customer_fname|customer_lname|customer_email|customer_password|     customer_street|customer_city|customer_state|customer_zipcode|</span>
<span class="linenos" data-linenos="15 "></span><span class="c1"># +-----------+--------------+--------------+--------------+-----------------+--------------------+-------------+--------------+----------------+</span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># |          1|       Richard|     Hernandez|     XXXXXXXXX|        XXXXXXXXX|  6303 Heather Plaza|  Brownsville|            TX|           78521|</span>
<span class="linenos" data-linenos="17 "></span><span class="c1"># |          2|          Mary|       Barrett|     XXXXXXXXX|        XXXXXXXXX|9526 Noble Embers...|    Littleton|            CO|           80126|</span>
<span class="linenos" data-linenos="18 "></span><span class="c1"># +-----------+--------------+--------------+--------------+-----------------+--------------------+-------------+--------------+----------------+</span>
<span class="linenos" data-linenos="19 "></span><span class="c1"># only showing top 2 rows</span>
</code></pre></div>
<p>Si necesitamos configurar en más detalle la forma de recoger los datos, es mejor acceder mediante el método <code>format</code> (cuidado con el nombre de la tabla que ahora utiliza el atributo <code>dbtable</code>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">df_format</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="2 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url_iabd</span><span class="p">)</span> \
<span class="hll"><span class="linenos" data-linenos="3 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="s2">&quot;customers&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos="4 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="5 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="6 "></span>  <span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div>
<p>Un caso particular es cuando queremos asignarle a un <em>dataframe</em> el resultado de una consulta. Para ello, podemos indicarle en el parámetro <code>query</code> la consulta SQL con la información a recoger:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">df_query</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 2 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url_iabd</span><span class="p">)</span> \
<span class="hll"><span class="linenos" data-linenos=" 3 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="s2">&quot;(select customer_id, customer_fname, customer_lname from customers where customer_city=&#39;Las Vegas&#39;)&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos=" 4 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 5 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 6 "></span>  <span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">df_query</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1"># root</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">#  |-- customer_id: integer (nullable = true)</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">#  |-- customer_fname: string (nullable = true)</span>
<span class="linenos" data-linenos="12 "></span><span class="c1">#  |-- customer_lname: string (nullable = true)</span>
<span class="linenos" data-linenos="13 "></span><span class="n">df_query</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span><span class="c1"># +-----------+--------------+--------------+</span>
<span class="linenos" data-linenos="15 "></span><span class="c1"># |customer_id|customer_fname|customer_lname|</span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># +-----------+--------------+--------------+</span>
<span class="linenos" data-linenos="17 "></span><span class="c1"># |         99|         Betty|         Munoz|</span>
<span class="linenos" data-linenos="18 "></span><span class="c1"># |        204|          Mary|         Smith|</span>
<span class="linenos" data-linenos="19 "></span><span class="c1"># |        384|       Mildred|    Cunningham|</span>
<span class="linenos" data-linenos="20 "></span><span class="c1"># +-----------+--------------+--------------+</span>
<span class="linenos" data-linenos="21 "></span><span class="c1"># only showing top 3 rows</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Más opciones</p>
<p>Más información sobre todas las opciones disponibles en la <a href="https://spark.apache.org/docs/latest/sql-data-sources-jdbc.html#data-source-option">documentación oficial</a>.</p>
</div>
<h3 id="escribiendo-datos">Escribiendo datos<a class="headerlink" href="#escribiendo-datos" title="Permanent link">&para;</a></h3>
<p>Si lo que queremos es almacenar el resultado en una base de datos, utilizaremos el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrameWriter.jdbc.html">write.jdbc</a> o <code>write.format('jdbc')</code> finalizando con <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrameWriter.save.html"><code>save</code></a>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">write.jdbc()</label><label for="__tabbed_1_2">write.format('jdbc')</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">jdbc</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> \
<span class="linenos" data-linenos="2 "></span>        <span class="n">table</span><span class="o">=</span><span class="s2">&quot;&lt;nueva_tabla&gt;&quot;</span><span class="p">,</span> \
<span class="linenos" data-linenos="3 "></span>        <span class="n">properties</span><span class="o">=</span><span class="n">propiedades</span><span class="p">)</span> 
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="2 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;jdbc_url&gt;&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="3 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;nueva_tabla&gt;&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="4 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;usuario&gt;&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="5 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;contraseña&gt;&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="6 "></span>  <span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Por ejemplo, vamos a crear una copia del <em>DataFrame</em> de clientes con sólo tres columnas, y almacenaremos este <em>DataFrame</em> en una nueva tabla:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">jdbcSelectDF</span> <span class="o">=</span> <span class="n">jdbcDF</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;customer_id&quot;</span><span class="p">,</span> <span class="s2">&quot;customer_fname&quot;</span><span class="p">,</span> <span class="s2">&quot;customer_lname&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">jdbcSelectDF</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1"># +-----------+--------------+--------------+</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1"># |customer_id|customer_fname|customer_lname|</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1"># +-----------+--------------+--------------+</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1"># |          1|       Richard|     Hernandez|</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1"># |          2|          Mary|       Barrett|</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1"># |          3|           Ann|         Smith|</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1"># +-----------+--------------+--------------+</span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># only showing top 3 rows</span>
<span class="linenos" data-linenos="11 "></span><span class="n">jdbcSelectDF</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="linenos" data-linenos="12 "></span><span class="c1"># 12435</span>
<span class="hll"><span class="linenos" data-linenos="13 "></span><span class="n">jdbcSelectDF</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos="14 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="15 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url_iabd</span><span class="p">)</span> \
<span class="linenos" data-linenos="16 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="s2">&quot;retail_db.clientes&quot;</span><span class="p">)</span> \
<span class="hll"><span class="linenos" data-linenos="17 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos="18 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="19 "></span>    <span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<p>Si accedemos a <em>MySQL</em>, podremos comprobar cómo se han insertado 12435 registros.</p>
<p>Si volvemos a realizar la persistencia de los datos, obtendremos un error porque la tabla ya existe. Para evitar este error, podemos añadir los datos a una tabla existente mediante el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrameWriter.mode.html"><code>mode</code></a> con valor <code>append</code>, o para machacarlos con el valor <code>overwrite</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">jdbcSelectDF</span><span class="o">.</span><span class="n">write</span> \
<span class="linenos" data-linenos="2 "></span>    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="3 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="4 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url_iabd</span><span class="p">)</span> \
<span class="linenos" data-linenos="5 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="s2">&quot;clientes2&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="6 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="7 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="hll"><span class="linenos" data-linenos="8 "></span>    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos="9 "></span>    <span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">overwrite borra la tabla</p>
<p>Mediante <code>mode("overwrite")</code>, la tabla se elimina y se vuelven a cargar los datos desde cero.
Si queremos que se vuelvan a cargar los datos pero no se cree de nuevo la tabla (por que no queremos que se borren las claves ni los índices existentes), hemos de añadirle la opción <code>option("truncate", "true")</code> para que limpie la tabla pero sin eliminarla ni volver a crearla.</p>
</div>
<h3 id="utilizando-databricks">Utilizando Databricks<a class="headerlink" href="#utilizando-databricks" title="Permanent link">&para;</a></h3>
<p>Si trabajamos con <em>Databricks</em> y queremos <a href="https://docs.databricks.com/external-data/jdbc.html">recuperar o almacenar datos via JDBC</a>, ya tenemos parte del trabajo hecho porque tiene los <em>drivers</em> instalados (pero utiliza los <em>drivers</em> de <em>MariaDB</em> en vez de <em>MySQL</em>).</p>
<p>Así pues, por ejemplo, para recuperar los datos de una base de datos remota (por ejemplo, la base de datos que creamos en la sesión de <a href="../cloud/rds.html">cloud con RDS</a>) haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">driver</span> <span class="o">=</span> <span class="s2">&quot;org.mariadb.jdbc.Driver&quot;</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">database_host</span> <span class="o">=</span> <span class="s2">&quot;rds-retaildb.cwlnhhfuyb7j.us-east-1.rds.amazonaws.com&quot;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">database_port</span> <span class="o">=</span> <span class="s2">&quot;3306&quot;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">database_name</span> <span class="o">=</span> <span class="s2">&quot;retail_db&quot;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">table</span> <span class="o">=</span> <span class="s2">&quot;customers&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">user</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;adminadmin&quot;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;jdbc:mysql://</span><span class="si">{</span><span class="n">database_host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">database_port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">database_name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="n">df_remoto</span> <span class="o">=</span> <span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span>
<span class="linenos" data-linenos="13 "></span>  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
<span class="linenos" data-linenos="18 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="linenos" data-linenos="19 "></span>  <span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos" data-linenos="20 "></span><span class="p">)</span>
</code></pre></div>
<p>Desde la versión 12 de <em>Databricks</em>, podemos utilizar directamente el formato <code>mysql</code> (o <code>postgresql</code> si fuera el caso):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">df_remoto_mysql</span> <span class="o">=</span> <span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;mysql&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="n">database_host</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">)</span>
<span class="linenos" data-linenos="5 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="n">database_name</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
<span class="linenos" data-linenos="7 "></span>  <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="linenos" data-linenos="8 "></span>  <span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos" data-linenos="9 "></span><span class="p">)</span>
</code></pre></div>
<h2 id="spark-mongodb">Spark MongoDB<a class="headerlink" href="#spark-mongodb" title="Permanent link">&para;</a></h2>
<p>Para conectar desde <em>Spark</em> con <em>MongoDB</em> debemos utilizar el <a href="https://www.mongodb.com/docs/spark-connector/current/">conector oficial</a> y a la hora de leer o escribir datos indicar que el formato es <code>mongodb</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;mongodb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;mongodb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<h3 id="mongo-spark-connector">Mongo Spark Connector<a class="headerlink" href="#mongo-spark-connector" title="Permanent link">&para;</a></h3>
<p>Si nos centramos en nuestra instalación de la máquina virtual, cuando lanzamos <code>pyspark</code> tenemos que indicarle que vamos a conectarnos a <em>MongoDB</em> mediante la opción <code>packages</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>pyspark<span class="w"> </span>--packages<span class="w"> </span>org.mongodb.spark:mongo-spark-connector_2.12:10.1.1
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Instalación driver Java</p>
<p>Para que funcione correctamente, si partes desde una instalación propia de <em>Spark</em>, debes descargar el <a href="resources/mongo-java-driver-3.12.12.jar">driver <em>Java</em> de <em>MongoDB</em></a> y colocarlo en la carpeta <code>/opt/spark-3.3.1/jars</code></p>
</div>
<p>Una vez recuperada la sesión de <em>Spark</em>, a la hora de leer datos le debemos indicar que el formato es <code>mongodb</code> y a continuación configurar tanto la <code>connection.uri</code> (si queremos acceder a la base de datos local usaremos como cadena de conexión <code>mongodb://127.0.0.1:27017</code>), como los parámetros <code>database</code>y <code>collection</code> con la base de datos y colección a la que queremos acceder:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">mongo_spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="hll"><span class="linenos" data-linenos=" 4 "></span><span class="n">df</span> <span class="o">=</span> <span class="n">mongo_spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;mongodb&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos=" 5 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;connection.uri&quot;</span><span class="p">,</span><span class="s2">&quot;mongodb+srv://&lt;usuario&gt;:&lt;contraseña&gt;@cluster0.dfaz5er.mongodb.net&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 6 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">,</span><span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 7 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span><span class="s2">&quot;espias&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># root</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">#  |-- _id: string (nullable = true)</span>
<span class="linenos" data-linenos="12 "></span><span class="c1">#  |-- edad: integer (nullable = true)</span>
<span class="linenos" data-linenos="13 "></span><span class="c1">#  |-- nombre: string (nullable = true)</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># +--------------------+----+---------------+</span>
<span class="linenos" data-linenos="17 "></span><span class="c1"># |                 _id|edad|         nombre|</span>
<span class="linenos" data-linenos="18 "></span><span class="c1"># +--------------------+----+---------------+</span>
<span class="linenos" data-linenos="19 "></span><span class="c1"># |63629b950e8c3f48d...|   0| James Bond 000|</span>
<span class="linenos" data-linenos="20 "></span><span class="c1"># |63629b950e8c3f48d...|   1| James Bond 001|</span>
<span class="linenos" data-linenos="21 "></span><span class="c1"># |63629b950e8c3f48d...|   2| James Bond 002|</span>
<span class="linenos" data-linenos="22 "></span><span class="c1"># |63629b950e8c3f48d...|   3| James Bond 003|</span>
<span class="linenos" data-linenos="23 "></span><span class="c1"># ...</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">MongoDB en local</p>
<p>Si quieres utilizar el <em>MongoDB</em> instalado en la máquina virtual (es la versión 4.4), debes arrancarlo mediante <code>mongod</code> y luego puedes arrancar un cliente mediante <code>mongosh</code>.</p>
</div>
<p>Del mismo modo, para escribir utilizamos el método <code>write</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Añadimos un atributo nuevo</span>
<span class="linenos" data-linenos="2 "></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>
<span class="linenos" data-linenos="3 "></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;edad_doble&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;edad&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span>
<span class="hll"><span class="linenos" data-linenos="5 "></span><span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;mongodb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">)</span> \
</span><span class="linenos" data-linenos="6 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;connection.uri&quot;</span><span class="p">,</span><span class="s2">&quot;mongodb+srv://&lt;usuario&gt;:&lt;contraseña&gt;@cluster0.dfaz5er.mongodb.net&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="7 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">,</span><span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="8 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span><span class="s2">&quot;espias_nuevo&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos="9 "></span>    <span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">MongoDB y Databricks</p>
<p>Para conectar con <em>MongoDB</em> desde <em>Databricks</em> se recomienda leer el siguiente artículo: <a href="https://docs.databricks.com/external-data/mongodb.html">Interact with MongoDB on Databricks</a></p>
</div>
<p>Más información en la documentación oficial en <a href="https://www.mongodb.com/docs/spark-connector/current/">https://www.mongodb.com/docs/spark-connector/current/</a></p>
<h2 id="spark-sql-catalog">Spark SQL Catalog<a class="headerlink" href="#spark-sql-catalog" title="Permanent link">&para;</a></h2>
<p>Los catálogos de datos son un elemento esencial dentro de una organización, al ofrecer una vista de los datos disponibles, los cuales se pueden extender para describir su creación (persona, equipo u organización). Este catálogo lo gestionan los <strong><em>data stewards</em></strong>, un rol muy específico de los equipos <em>big data</em> que no solo se encargan de administrar el uso y los enfoques de los datos en la empresa, sino que tratan de asegurar la calidad de la información, el cumplimiento de las políticas de privacidad, la correcta comunicación entre los diferentes departamentos y la educación informática y tecnológica de los empleados relacionada con el mundo del dato.</p>
<p>Volviendo al catálogo de datos, el cual al final es un conjunto de metadatos, actúa como un contrato público que se establece durante la vida del dato, definiendo el cómo, cuándo y el porqué se consume un determinado dato, por ejemplo, indicando la disponibilidad de cada campo (por ejemplo, si tendrá un valor por defecto o nulo), así como reglas sobre la gobernanza y acceso de cada campo, etc...</p>
<p>El catálogo de datos por excelencia es el que forma parte de <em>Apache Hive</em>, y se conoce como el <strong><em>Hive Metastore</em></strong>, el cual ofrece una fuente veraz para describir la localización, codificación de los datos (texto, Parquet, ORC, ...), el esquema de las columnas, y estadísticas de las tablas almacenadas para facilitar su uso a todos los roles que interactúan con los datos (ingenieros de datos, analistas, ingenieros de ML, ...)</p>
<h3 id="bases-de-datos">Bases de datos<a class="headerlink" href="#bases-de-datos" title="Permanent link">&para;</a></h3>
<p>El catálogo se organiza, en su primer nivel, en <strong>bases de datos</strong>, la cuales agrupan y categorizan las tablas que utiliza nuestro equipo de trabajo, permitiendo identificar su propietario y restringir el acceso. Dentro del <em>Hive Metastore</em>, una base de datos funciona como un prefijo dentro de una ruta física de nuestro <em>data warehouse</em>, evitando colisiones entre nombres de tablas.</p>
<div class="admonition tip">
<p class="admonition-title">Una base de datos por equipo</p>
<p>Es conveniente que cada equipo de trabajo o unidad de negocio utilice sus propias bases de datos en Spark.</p>
</div>
<h4 id="configurando-spark-con-hive">Configurando Spark con Hive<a class="headerlink" href="#configurando-spark-con-hive" title="Permanent link">&para;</a></h4>
<p>En nuestra máquina virtual ya tenemos configurado el uso del <em>Hive Metastore</em> como catálogo de <em>Spark</em>. Para ello, hemos colocado dentro de <code>$SPARK_HOME/conf</code> una copia del archivo <code>hive-site.xml</code> con la información de acceso:</p>
<div class="highlight"><span class="filename">hive-site.xml</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">&lt;configuration&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">   </span><span class="nt">&lt;property&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nt">&lt;name&gt;</span>javax.jdo.option.ConnectionURL<span class="nt">&lt;/name&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nt">&lt;value&gt;</span>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true<span class="nt">&lt;/value&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nt">&lt;property&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="nt">&lt;name&gt;</span>javax.jdo.option.ConnectionDriverName<span class="nt">&lt;/name&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nt">&lt;value&gt;</span>com.mysql.cj.jdbc.Driver<span class="nt">&lt;/value&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="nt">&lt;property&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nt">&lt;name&gt;</span>javax.jdo.option.ConnectionUserName<span class="nt">&lt;/name&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="nt">&lt;value&gt;</span>iabd<span class="nt">&lt;/value&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="nt">&lt;property&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="nt">&lt;name&gt;</span>javax.jdo.option.ConnectionPassword<span class="nt">&lt;/name&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="nt">&lt;value&gt;</span>iabd<span class="nt">&lt;/value&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<p>Y en el archivo de configuración de <em>Spark</em>, en <code>$SPARK_HOME/conf/spark-defaults.conf</code> hemos añadido dos propiedades para indicarle que vamos a utilizar la implementación del catálogo de <em>Hive</em> y que queremos que almacene las bases de datos que creemos en <code>/opt/spark-3.3.1/warehouse/</code>:</p>
<div class="highlight"><span class="filename">spark-defaults.conf</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># The default location to read and write distributed SQL tables.</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># This location can be located on the local file system and on any HDFS compatible file system.</span>
<span class="hll"><span class="linenos" data-linenos="3 "></span><span class="na">spark.sql.warehouse.dir</span><span class="w"> </span><span class="s">/opt/spark-3.3.1/warehouse/</span>
</span><span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="c1"># Defines the backing SQL catalog for the Spark session.</span>
<span class="hll"><span class="linenos" data-linenos="6 "></span><span class="na">spark.sql.catalogImplementation</span><span class="w"> </span><span class="s">hive</span>
</span></code></pre></div>
<p>Si hubiésemos querido que las bases de datos que creemos desde <em>Spark</em> también lo hicieran dentro de HDFS (que sería lo recomendable, pero en nuestro caso implicaría tener que arrancar también los servicios de <em>Hadoop</em> al utilizar <em>Spark</em>, y por cuestiones de RAM hemos decidido desacoplarlo), deberíamos indicar la ruta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="na">spark.sql.warehouse.dir</span><span class="w"> </span><span class="s">hdfs://iabd-virtualbox:9000/user/hive/warehouse/</span>
</code></pre></div>
<h4 id="accediendo-al-catalogo">Accediendo al catálogo<a class="headerlink" href="#accediendo-al-catalogo" title="Permanent link">&para;</a></h4>
<p>A partir de la sesión de <em>Spark</em>, podemos acceder al objeto <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/catalog.html"><code>catalog</code></a> que contiene un conjunto de métodos para interactuar con los metadatos.</p>
<p>Podemos comprobar su uso mediante una consulta a <code>show databases</code> o accediendo al método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.listDatabases.html"><code>listDatabases()</code></a> del <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/catalog.html"><code>catalog</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;show databases&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1"># +---------+</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1"># |namespace|</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1"># +---------+</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1"># |  default|</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1"># |     iabd|</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1"># +---------+</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listDatabases</span><span class="p">()</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1"># [Database(name=&#39;default&#39;, description=&#39;Default Hive database&#39;, locationUri=&#39;hdfs://iabd-virtualbox:9000/user/hive/warehouse&#39;),</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">#  Database(name=&#39;iabd&#39;, description=&#39;&#39;, locationUri=&#39;hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db&#39;)]</span>
</code></pre></div>
<p>De manera que obtenemos las bases de datos que está utilizando actualmente (como puedes observar, son las bases de datos que hemos creado previamente en la sesión de <a href="../hadoop/hive1.html">Hive</a>).</p>
<p>Si queremos ver cual es nuestra base de datos activa, utilizaremos el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.currentDatabase.html"><code>currentDatabase</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">currentDatabase</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># &#39;default&#39;</span>
</code></pre></div>
<h4 id="creando-una-base-de-datos">Creando una base de datos<a class="headerlink" href="#creando-una-base-de-datos" title="Permanent link">&para;</a></h4>
<p>De la misma manera que hemos creado sentencias SQL en Spark, podemos generar sentencias DDL y DML. Así pues, para crear una base de datos, hemos de hacer uso del API SQL y utilizar la sentencia DDL de <a href="https://spark.apache.org/docs/latest/sql-ref-syntax-ddl-create-database.html"><code>CREATE DATABASE</code></a>. Por ejemplo, vamos a crear una base de datos <code>s8a</code> donde colocaremos las tablas que crearemos en esta sesión:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;create database if not exists s8a&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Una vez creada, la activamos mediante <code>use</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;use s8a&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Si comprobamos la ruta, podemos ver cómo la ha creado en el almacén de Spark que hemos indicado previamente en la configuración:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listDatabases</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># [Database(name=&#39;default&#39;, description=&#39;Default Hive database&#39;, locationUri=&#39;hdfs://iabd-virtualbox:9000/user/hive/warehouse&#39;),</span>
<span class="linenos" data-linenos="3 "></span><span class="c1">#  Database(name=&#39;iabd&#39;, description=&#39;&#39;, locationUri=&#39;hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db&#39;),</span>
<span class="hll"><span class="linenos" data-linenos="4 "></span><span class="c1">#  Database(name=&#39;s8a&#39;, description=&#39;&#39;, locationUri=&#39;file:/opt/spark-3.3.1/warehouse/s8a.db&#39;)]</span>
</span></code></pre></div>
<!--
FIXME: continuar https://learning.oreilly.com/library/view/modern-data-engineering/9781484274521/html/505711_1_En_6_Chapter.xhtml#PC17

https://towardsdatascience.com/3-ways-to-create-tables-with-apache-spark-32aed0f355ab

https://cca175.itversity.com/spark-python/08_spark_metastore.html
https://jaceklaskowski.gitbooks.io/mastering-spark-sql/content/demo/demo-connecting-spark-sql-to-hive-metastore.html
-->

<h3 id="trabajando-con-tablas">Trabajando con tablas<a class="headerlink" href="#trabajando-con-tablas" title="Permanent link">&para;</a></h3>
<p>Vamos a suponer que tenemos el <em>DataFrame</em> de clientes que hemos cargado previamente desde JDBC, y creamos una vista sobre él:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">jdbcDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span> \
<span class="linenos" data-linenos=" 2 "></span>    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 3 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="s2">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 4 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;jdbc:mysql://localhost&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 5 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="s2">&quot;retail_db.customers&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 6 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;3306&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 7 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 8 "></span>    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;iabd&quot;</span><span class="p">)</span> \
<span class="linenos" data-linenos=" 9 "></span>    <span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span><span class="n">jdbcDF</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Si comprobamos las tablas de nuestra base de datos mediante el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.listTables.html"><code>listTables</code></a>, aparecerá la vista como una tabla temporal (<code>TEMPORARY</code>), lo que significa que sólo está disponible en memoria:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listTables</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># [Table(name=&#39;clientes&#39;, database=None, description=None, tableType=&#39;TEMPORARY&#39;, isTemporary=True)]</span>
</code></pre></div>
<p>Al ser temporal, al detener <em>Spark</em>, dicha tabla desaparecerá. Si queremos que la tabla esté disponible en nuestro <em>data lake</em> y que podamos consultarla desde el catálogo del <em>Hive Metastore</em>, necesitamos persistirla.</p>
<h4 id="persistiendo-tablas">Persistiendo tablas<a class="headerlink" href="#persistiendo-tablas" title="Permanent link">&para;</a></h4>
<p>Cuando tenemos un <em>DataFrame</em> lo podemos persistir como una tabla, lo que en terminología de <em>Hive</em> sería una tabla interna o gestionada, mediante <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrameWriter.saveAsTable.html"><code>saveAsTable</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">jdbcDF</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;errorIfExists&quot;</span><span class="p">)</span> \  <span class="c1"># (1)!</span>
<span class="linenos" data-linenos="2 "></span>      <span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
</code></pre></div>
<ol>
<li>Hemos configurado el modo de escritura a <code>errorIfExists</code> para asegurarnos que no borramos ningún datos de nuestro <em>datalake</em>.</li>
</ol>
<p>Si volvemos a comprobar las tablas, podemos ver como la nueva tabla ahora forma parte de la base de datos <code>s8a</code> y que tu tipo es <code>MANAGED</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listTables</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># [Table(name=&#39;clientes&#39;, database=&#39;s8a&#39;, description=None, tableType=&#39;MANAGED&#39;, isTemporary=False),</span>
<span class="linenos" data-linenos="3 "></span><span class="c1">#  Table(name=&#39;clientes&#39;, database=None, description=None, tableType=&#39;TEMPORARY&#39;, isTemporary=True)]</span>
</code></pre></div>
<p>Podemos configurar diferentes opciones a la hora de persistir las tablas. Por ejemplo, si queremos persistir la tabla en formato JSON sobrescribiendo los datos hemos de indicarlo con <code>format('json')</code> y <code>mode('overwrite')</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">jdbcDF</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s2">&quot;clientesj&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Por defecto en formato Parquet</p>
<p>Por defecto, al persistir una tabla, se realiza en formato <em>Parquet</em> y comprimido mediante <em>Snappy</em>.</p>
</div>
<h4 id="tablas-externas">Tablas externas<a class="headerlink" href="#tablas-externas" title="Permanent link">&para;</a></h4>
<p>Si queremos crear una tabla no gestionada, también conocida como tabla externa, la cual se almacena como <a href="https://spark.apache.org/docs/latest/sql-data-sources-hive-tables.html">tablas en Hive</a>, necesitamos indicar la ruta de los datos en el momento de la creación mediante la clausula <code>LOCATION</code>.</p>
<p>Vamos a crear una tabla de clientes con los datos que tenemos almacenados en HDFS que <a href="../hadoop/hive1.html#caso-de-uso-1-creación-y-borrado-de-tablas">cargamos mediante Sqoop en la sesión de Hive</a> en la ruta <code>/user/iabd/hive/customer</code>.</p>
<p>Así pues, nuestra sentencia DDL sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="s2">CREATE EXTERNAL TABLE IF NOT EXISTS clientese</span>
<span class="linenos" data-linenos=" 3 "></span><span class="s2">(</span>
<span class="linenos" data-linenos=" 4 "></span><span class="s2">  custId INT,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="s2">  fName STRING,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="s2">  lName STRING,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="s2">  city STRING</span>
<span class="linenos" data-linenos=" 8 "></span><span class="s2">)</span>
<span class="linenos" data-linenos=" 9 "></span><span class="s2">ROW FORMAT DELIMITED</span>
<span class="linenos" data-linenos="10 "></span><span class="s2">FIELDS TERMINATED BY &#39;|&#39;</span>
<span class="linenos" data-linenos="11 "></span><span class="s2">STORED AS TEXTFILE</span>
<span class="linenos" data-linenos="12 "></span><span class="s2">LOCATION &#39;hdfs://iabd-virtualbox:9000/user/iabd/hive/customer&#39;&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Si volvemos a comprobar las tablas, veremos que que la ha marcado <code>EXTERNAL</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listTables</span><span class="p">()</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># [Table(name=&#39;clientes&#39;, database=&#39;s8a&#39;, description=&#39;Datos de clientes obtenidos desde retail_db.customers&#39;, tableType=&#39;MANAGED&#39;, isTemporary=False),</span>
<span class="hll"><span class="linenos" data-linenos="3 "></span><span class="c1">#  Table(name=&#39;clientese&#39;, database=&#39;s8a&#39;, description=None, tableType=&#39;EXTERNAL&#39;, isTemporary=False),</span>
</span><span class="linenos" data-linenos="4 "></span><span class="c1">#  Table(name=&#39;clientesj&#39;, database=&#39;s8a&#39;, description=None, tableType=&#39;MANAGED&#39;, isTemporary=False)]</span>
</code></pre></div>
<p>Y si realizamos una consulta, obtenemos los mismos datos que hay almacenados en HDFS:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;select * from clientese limit 3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># +------+-------+---------+-----------+</span>
<span class="linenos" data-linenos="3 "></span><span class="c1"># |custId|  fName|    lName|       city|</span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># +------+-------+---------+-----------+</span>
<span class="linenos" data-linenos="5 "></span><span class="c1"># |     1|Richard|Hernandez|Brownsville|</span>
<span class="linenos" data-linenos="6 "></span><span class="c1"># |     2|   Mary|  Barrett|  Littleton|</span>
<span class="linenos" data-linenos="7 "></span><span class="c1"># |     3|    Ann|    Smith|     Caguas|</span>
<span class="linenos" data-linenos="8 "></span><span class="c1"># +------+-------+---------+-----------+</span>
</code></pre></div>
<p>También podemos crear una tabla externa indicando la <a href="https://spark.apache.org/docs/latest/sql-data-sources-load-save-functions.html#saving-to-persistent-tables">opción <code>path</code></a>, de manera que nos creará los datos en HDFS (recuerda que por defecto almacena los datos en formato <em>Parquet</em>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">jdbcDF</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;hdfs://iabd-virtualbox:9000/user/iabd/spark/customer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s2">&quot;clienteses&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="cargando-tablas">Cargando tablas<a class="headerlink" href="#cargando-tablas" title="Permanent link">&para;</a></h4>
<p>Una vez las tablas ya están persistidas, en cualquier momento podemos recuperarlas y asociarlas a un nuevo <em>DataFrame</em> mediante el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrameReader.table.html"><code>table</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">df_clientes</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">df_clientes</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1"># root</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">#  |-- customer_id: integer (nullable = true)</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">#  |-- customer_fname: string (nullable = true)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">#  |-- customer_lname: string (nullable = true)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">#  |-- customer_email: string (nullable = true)</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">#  |-- customer_password: string (nullable = true)</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">#  |-- customer_street: string (nullable = true)</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">#  |-- customer_city: string (nullable = true)</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">#  |-- customer_state: string (nullable = true)</span>
<span class="linenos" data-linenos="12 "></span><span class="c1">#  |-- customer_zipcode: string (nullable = true)</span>
</code></pre></div>
<h4 id="cacheando-tablas">Cacheando tablas<a class="headerlink" href="#cacheando-tablas" title="Permanent link">&para;</a></h4>
<p>En la <a href="agregaciones.html#cacheando">sesión anterior</a> estudiamos cómo persistir los <em>DataFrames</em> y vimos como también podemos persistir una vista, incluso cómo comprobar su estado en el Spark UI.</p>
<p>Para cachear tablas, usaremos el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.cacheTable.html"><code>cacheTable</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">cacheTable</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Si por el contrario, queremos liberar la memoria de una tabla que ha sido cacheada, usaremos el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.uncacheTable.html"><code>uncacheTable</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">uncacheTable</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Si queremos limpiar toda la caché, disponemos del método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.clearCache.html"><code>clearCache</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Refrescando la caché</p>
<p>Un caso muy común al trabajar con datos cacheados es que desde una aplicación externa se actualicen los datos y la caché contenga una copia obsoleta.</p>
<p>Para refrescar los datos, podemos utilizar el método <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.refreshTable.html"><code>refreshTable</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">refreshTable</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Un punto a destacar es que si una aplicación Spark sobrescribe una tabla que habíamos cacheado, Spark directamente invalidará la caché local, de manera que no será necesario que en nuestra lógica de aplicación refresquemos las tablas de forma explícita.</p>
<p>Sólo lo haremos si la sobrescritura de los datos la realiza una aplicación ajena a Spark sobre una tabla externa.</p>
</div>
<h4 id="borrando-tablas">Borrando tablas<a class="headerlink" href="#borrando-tablas" title="Permanent link">&para;</a></h4>
<p>Si dejamos de utilizar una tabla y la queremos eliminar del <em>Metastore</em>, podemos realizarlo directamente mediante su sentencia de DDL <a href="https://spark.apache.org/docs/latest/sql-ref-syntax-ddl-drop-table.html#drop-table"><code>DROP TABLE</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS cliente&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="spark-y-el-metastore">Spark y el Metastore<a class="headerlink" href="#spark-y-el-metastore" title="Permanent link">&para;</a></h3>
<p>Para comprender cómo se almacenan los metadatos de las bases de datos y las tablas gestionadas es importante conocer donde se almacenan los metadatos.</p>
<p>Si abrimos un terminal y accedemos al servidor de <em>MySQL</em> de nuestra máquina virtual, podemos ver todas las tablas que utiliza el <em>Hive Metastore</em>:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span>$<span class="w"> </span>mysql<span class="w"> </span>-uiabd<span class="w"> </span>-piabd
</span><span class="linenos" data-linenos=" 2 "></span>Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>MariaDB<span class="w"> </span>monitor.<span class="w">  </span>Commands<span class="w"> </span>end<span class="w"> </span>with<span class="w"> </span><span class="p">;</span><span class="w"> </span>or<span class="w"> </span><span class="se">\g</span>.
<span class="linenos" data-linenos=" 3 "></span>Your<span class="w"> </span>MariaDB<span class="w"> </span>connection<span class="w"> </span>id<span class="w"> </span>is<span class="w"> </span><span class="m">143</span>
<span class="linenos" data-linenos=" 4 "></span>Server<span class="w"> </span>version:<span class="w"> </span><span class="m">10</span>.3.37-MariaDB-0ubuntu0.20.04.1<span class="w"> </span>Ubuntu<span class="w"> </span><span class="m">20</span>.04
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">2018</span>,<span class="w"> </span>Oracle,<span class="w"> </span>MariaDB<span class="w"> </span>Corporation<span class="w"> </span>Ab<span class="w"> </span>and<span class="w"> </span>others.
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>Type<span class="w"> </span><span class="s1">&#39;help;&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;\h&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>help.<span class="w"> </span>Type<span class="w"> </span><span class="s1">&#39;\c&#39;</span><span class="w"> </span>to<span class="w"> </span>clear<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>input<span class="w"> </span>statement.
<span class="linenos" data-linenos=" 9 "></span>
<span class="hll"><span class="linenos" data-linenos="10 "></span>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>use<span class="w"> </span>hive
</span><span class="linenos" data-linenos="11 "></span>Database<span class="w"> </span>changed
<span class="linenos" data-linenos="12 "></span>
<span class="hll"><span class="linenos" data-linenos="13 "></span>MariaDB<span class="w"> </span><span class="o">[</span>hive<span class="o">]</span>&gt;<span class="w"> </span>show<span class="w"> </span>tables<span class="p">;</span>
</span><span class="linenos" data-linenos="14 "></span>+-------------------------------+
<span class="linenos" data-linenos="15 "></span><span class="p">|</span><span class="w"> </span>Tables_in_hive<span class="w">                </span><span class="p">|</span>
<span class="linenos" data-linenos="16 "></span>+-------------------------------+
<span class="linenos" data-linenos="17 "></span><span class="p">|</span><span class="w"> </span>AUX_TABLE<span class="w">                     </span><span class="p">|</span>
<span class="linenos" data-linenos="18 "></span><span class="p">|</span><span class="w"> </span>BUCKETING_COLS<span class="w">                </span><span class="p">|</span>
<span class="linenos" data-linenos="19 "></span><span class="p">|</span><span class="w"> </span>CDS<span class="w">                           </span><span class="p">|</span>
<span class="linenos" data-linenos="20 "></span><span class="p">|</span><span class="w"> </span>COLUMNS_V2<span class="w">                    </span><span class="p">|</span>
<span class="linenos" data-linenos="21 "></span><span class="p">|</span><span class="w"> </span>COMPACTION_QUEUE<span class="w">              </span><span class="p">|</span>
<span class="linenos" data-linenos="22 "></span><span class="p">|</span><span class="w"> </span>COMPLETED_COMPACTIONS<span class="w">         </span><span class="p">|</span>
<span class="linenos" data-linenos="23 "></span><span class="p">|</span><span class="w"> </span>COMPLETED_TXN_COMPONENTS<span class="w">      </span><span class="p">|</span>
<span class="linenos" data-linenos="24 "></span><span class="p">|</span><span class="w"> </span>CTLGS<span class="w">                         </span><span class="p">|</span>
<span class="linenos" data-linenos="25 "></span><span class="p">|</span><span class="w"> </span>DATABASE_PARAMS<span class="w">               </span><span class="p">|</span>
<span class="linenos" data-linenos="26 "></span><span class="p">|</span><span class="w"> </span>DBS<span class="w">                           </span><span class="p">|</span>
<span class="linenos" data-linenos="27 "></span>...
<span class="linenos" data-linenos="28 "></span><span class="p">|</span><span class="w"> </span>WRITE_SET<span class="w">                     </span><span class="p">|</span>
<span class="linenos" data-linenos="29 "></span>+-------------------------------+
<span class="linenos" data-linenos="30 "></span><span class="m">74</span><span class="w"> </span>rows<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,000<span class="w"> </span>sec<span class="o">)</span>
<span class="linenos" data-linenos="31 "></span>
<span class="linenos" data-linenos="32 "></span>MariaDB<span class="w"> </span><span class="o">[</span>hive<span class="o">]</span>&gt;<span class="w"> </span>
</code></pre></div>
<p>De todas las tablas, nos vamos a centrar en la tabla DBS, que almacena las bases de datos creadas, donde podemos observar, además de su nombre, la localización de cada base de datos y su propietario:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>MariaDB<span class="w"> </span><span class="o">[</span>hive<span class="o">]</span>&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>DBS<span class="p">;</span>
<span class="linenos" data-linenos="2 "></span>+-------+-----------------------+---------------------------------------------------------+---------+------------+------------+-----------+
<span class="linenos" data-linenos="3 "></span><span class="p">|</span><span class="w"> </span>DB_ID<span class="w"> </span><span class="p">|</span><span class="w"> </span>DESC<span class="w">                  </span><span class="p">|</span><span class="w"> </span>DB_LOCATION_URI<span class="w">                                         </span><span class="p">|</span><span class="w"> </span>NAME<span class="w">    </span><span class="p">|</span><span class="w"> </span>OWNER_NAME<span class="w"> </span><span class="p">|</span><span class="w"> </span>OWNER_TYPE<span class="w"> </span><span class="p">|</span><span class="w"> </span>CTLG_NAME<span class="w"> </span><span class="p">|</span>
<span class="linenos" data-linenos="4 "></span>+-------+-----------------------+---------------------------------------------------------+---------+------------+------------+-----------+
<span class="linenos" data-linenos="5 "></span><span class="p">|</span><span class="w">     </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Default<span class="w"> </span>Hive<span class="w"> </span>database<span class="w"> </span><span class="p">|</span><span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse<span class="w">         </span><span class="p">|</span><span class="w"> </span>default<span class="w"> </span><span class="p">|</span><span class="w"> </span>public<span class="w">     </span><span class="p">|</span><span class="w"> </span>ROLE<span class="w">       </span><span class="p">|</span><span class="w"> </span>hive<span class="w">      </span><span class="p">|</span>
<span class="linenos" data-linenos="6 "></span><span class="p">|</span><span class="w">    </span><span class="m">21</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">                  </span><span class="p">|</span><span class="w"> </span>hdfs://iabd-virtualbox:9000/user/hive/warehouse/iabd.db<span class="w"> </span><span class="p">|</span><span class="w"> </span>iabd<span class="w">    </span><span class="p">|</span><span class="w"> </span>iabd<span class="w">       </span><span class="p">|</span><span class="w"> </span>USER<span class="w">       </span><span class="p">|</span><span class="w"> </span>hive<span class="w">      </span><span class="p">|</span>
<span class="linenos" data-linenos="7 "></span><span class="p">|</span><span class="w">    </span><span class="m">31</span><span class="w"> </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span><span class="w"> </span>file:/opt/spark-3.3.1/warehouse/s8a.db<span class="w">                  </span><span class="p">|</span><span class="w"> </span>s8a<span class="w">     </span><span class="p">|</span><span class="w"> </span>iabd<span class="w">       </span><span class="p">|</span><span class="w"> </span>USER<span class="w">       </span><span class="p">|</span><span class="w"> </span>hive<span class="w">      </span><span class="p">|</span>
<span class="linenos" data-linenos="8 "></span>+-------+-----------------------+---------------------------------------------------------+---------+------------+------------+-----------+
<span class="linenos" data-linenos="9 "></span><span class="m">3</span><span class="w"> </span>rows<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,001<span class="w"> </span>sec<span class="o">)</span>
</code></pre></div>
<p>Si nos quedamos con el identificador de cada base de datos (<code>DB_ID</code>), el cual actúa como clave primaria, vamos a poder consultar las tablas de una determinada base de datos consultando la tabla <code>TBLS</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>MariaDB<span class="w"> </span><span class="o">[</span>hive<span class="o">]</span>&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>TBLS<span class="w"> </span>where<span class="w"> </span><span class="nv">DB_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">31</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span>+--------+-------------+-------+------------------+-------+------------+-----------+-------+-----------+---------------+--------------------+--------------------+--------------------+
<span class="linenos" data-linenos="3 "></span><span class="p">|</span><span class="w"> </span>TBL_ID<span class="w"> </span><span class="p">|</span><span class="w"> </span>CREATE_TIME<span class="w"> </span><span class="p">|</span><span class="w"> </span>DB_ID<span class="w"> </span><span class="p">|</span><span class="w"> </span>LAST_ACCESS_TIME<span class="w"> </span><span class="p">|</span><span class="w"> </span>OWNER<span class="w"> </span><span class="p">|</span><span class="w"> </span>OWNER_TYPE<span class="w"> </span><span class="p">|</span><span class="w"> </span>RETENTION<span class="w"> </span><span class="p">|</span><span class="w"> </span>SD_ID<span class="w"> </span><span class="p">|</span><span class="w"> </span>TBL_NAME<span class="w">  </span><span class="p">|</span><span class="w"> </span>TBL_TYPE<span class="w">      </span><span class="p">|</span><span class="w"> </span>VIEW_EXPANDED_TEXT<span class="w"> </span><span class="p">|</span><span class="w"> </span>VIEW_ORIGINAL_TEXT<span class="w"> </span><span class="p">|</span><span class="w"> </span>IS_REWRITE_ENABLED<span class="w"> </span><span class="p">|</span>
<span class="linenos" data-linenos="4 "></span>+--------+-------------+-------+------------------+-------+------------+-----------+-------+-----------+---------------+--------------------+--------------------+--------------------+
<span class="linenos" data-linenos="5 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">1673256646</span><span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">31</span><span class="w"> </span><span class="p">|</span><span class="w">                </span><span class="m">0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>iabd<span class="w">  </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">       </span><span class="p">|</span><span class="w">         </span><span class="m">0</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">111</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>clientes<span class="w">  </span><span class="p">|</span><span class="w"> </span>MANAGED_TABLE<span class="w"> </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">               </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">               </span><span class="p">|</span><span class="w">                    </span><span class="p">|</span>
<span class="linenos" data-linenos="6 "></span><span class="p">|</span><span class="w">     </span><span class="m">62</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">1673256649</span><span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">31</span><span class="w"> </span><span class="p">|</span><span class="w">                </span><span class="m">0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>iabd<span class="w">  </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">       </span><span class="p">|</span><span class="w">         </span><span class="m">0</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">112</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>clientesj<span class="w"> </span><span class="p">|</span><span class="w"> </span>MANAGED_TABLE<span class="w"> </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">               </span><span class="p">|</span><span class="w"> </span>NULL<span class="w">               </span><span class="p">|</span><span class="w">                    </span><span class="p">|</span>
<span class="linenos" data-linenos="7 "></span>+--------+-------------+-------+------------------+-------+------------+-----------+-------+-----------+---------------+--------------------+--------------------+--------------------+
</code></pre></div>
<p>Y repetimos el proceso, ahora nos quedamos con el identificador de la tabla, y consultamos la tabla <code>TABLE_PARAMS</code>, donde podemos ver donde se almacena toda la información que utiliza Spark para leer las tablas de forma automática:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>MariaDB<span class="w"> </span><span class="o">[</span>hive<span class="o">]</span>&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>TABLE_PARAMS<span class="w"> </span>where<span class="w"> </span><span class="nv">TBL_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">61</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>+--------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="linenos" data-linenos=" 3 "></span><span class="p">|</span><span class="w"> </span>TBL_ID<span class="w"> </span><span class="p">|</span><span class="w"> </span>PARAM_KEY<span class="w">                  </span><span class="p">|</span><span class="w"> </span>PARAM_VALUE<span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </span><span class="p">|</span>
<span class="linenos" data-linenos=" 4 "></span>+--------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="linenos" data-linenos=" 5 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>numFiles<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </span><span class="p">|</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>spark.sql.create.version<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="m">3</span>.3.1<span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </span><span class="p">|</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>spark.sql.sources.provider<span class="w"> </span><span class="p">|</span><span class="w"> </span>parquet<span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </span><span class="p">|</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>spark.sql.sources.schema<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;struct&quot;</span>,<span class="s2">&quot;fields&quot;</span>:<span class="o">[{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_id&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;integer&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_fname&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_lname&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_email&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_password&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_street&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_city&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_state&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}</span>,<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;customer_zipcode&quot;</span>,<span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;string&quot;</span>,<span class="s2">&quot;nullable&quot;</span>:true,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;scale&quot;</span>:0<span class="o">}}]}</span><span class="w"> </span><span class="p">|</span>
<span class="linenos" data-linenos=" 9 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>totalSize<span class="w">                  </span><span class="p">|</span><span class="w"> </span><span class="m">251792</span><span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </span><span class="p">|</span>
<span class="linenos" data-linenos="10 "></span><span class="p">|</span><span class="w">     </span><span class="m">61</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>transient_lastDdlTime<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">1673256646</span><span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </span><span class="p">|</span>
<span class="linenos" data-linenos="11 "></span>+--------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="linenos" data-linenos="12 "></span><span class="m">6</span><span class="w"> </span>rows<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,001<span class="w"> </span>sec<span class="o">)</span>
</code></pre></div>
<h3 id="facilitando-el-descubrimiento-de-datos">Facilitando el descubrimiento de datos<a class="headerlink" href="#facilitando-el-descubrimiento-de-datos" title="Permanent link">&para;</a></h3>
<p>Una vez sabemos cómo se almacenan los metadatos, podemos consultarlos para descubrir los datos, proceso que se conoce como <em>data discovery</em>.</p>
<p>Volviendo a nuestros cuadernos Jupyter, si nos centramos en la base de datos <code>s8a</code> y consultamos sus tablas mediante <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.listTables.html"><code>listTables</code></a>, observamos que no tienen descripción, lo cual a la hora de poder descubrir datos no es nada positivo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;use s8a&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listTables</span><span class="p">()</span>
<span class="linenos" data-linenos="3 "></span><span class="c1"># [Table(name=&#39;clientes&#39;, database=&#39;s8a&#39;, description=None, tableType=&#39;MANAGED&#39;, isTemporary=False),</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">#  Table(name=&#39;clientesj&#39;, database=&#39;s8a&#39;, description=None, tableType=&#39;MANAGED&#39;, isTemporary=False)]</span>
</code></pre></div>
<p>Para poder añadirle la descripción a las tablas, mediante DML modificamos las propiedades de la tabla, en concreto la propiedad <code>comment</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="p">.</span><span class="k">sql</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="ss">&quot;&quot;&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="ss">ALTER TABLE clientes</span>
<span class="linenos" data-linenos="4 "></span><span class="ss">SET TBLPROPERTIES (</span>
<span class="linenos" data-linenos="5 "></span><span class="ss">  &#39;comment&#39; = &#39;Datos de clientes obtenidos desde retail_db.customers&#39;,</span>
<span class="linenos" data-linenos="6 "></span><span class="ss">  &#39;active&#39; = &#39;true&#39;</span>
<span class="linenos" data-linenos="7 "></span><span class="ss">)</span>
<span class="linenos" data-linenos="8 "></span><span class="ss">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Si volvemos a consultar las tablas, ya podemos ver su descripción:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listTables</span><span class="p">()</span>
<span class="hll"><span class="linenos" data-linenos="2 "></span><span class="c1"># [Table(name=&#39;clientes&#39;, database=&#39;s8a&#39;, description=&#39;Datos de clientes obtenidos desde retail_db.customers&#39;, tableType=&#39;MANAGED&#39;, isTemporary=False),</span>
</span><span class="linenos" data-linenos="3 "></span><span class="c1">#  Table(name=&#39;clientesj&#39;, database=&#39;s8a&#39;, description=None, tableType=&#39;MANAGED&#39;, isTemporary=False)]</span>
</code></pre></div>
<p>Vamos a comprobar ahora las columnas de las tablas mediante <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Catalog.listColumns.html"><code>listColumns</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listColumns</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1"># [Column(name=&#39;customer_id&#39;, description=None, dataType=&#39;int&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">#  Column(name=&#39;customer_fname&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">#  Column(name=&#39;customer_lname&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">#  Column(name=&#39;customer_email&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">#  Column(name=&#39;customer_password&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">#  Column(name=&#39;customer_street&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">#  Column(name=&#39;customer_city&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">#  Column(name=&#39;customer_state&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">#  Column(name=&#39;customer_zipcode&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False)]</span>
</code></pre></div>
<p>Igual que antes, tenemos la descripción en blanco (valor <code>None</code>), por lo que mediante DML modificamos el comentario de cada columna:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;ALTER TABLE clientes ALTER COLUMN customer_id COMMENT &#39;Identificador unívoco (PK) del cliente&#39;&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;ALTER TABLE clientes ALTER COLUMN customer_fname COMMENT &#39;Nombre del cliente&#39;&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Y comprobamos como han cambiado ambos campos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listColumns</span><span class="p">(</span><span class="s2">&quot;clientes&quot;</span><span class="p">)</span>
<span class="hll"><span class="linenos" data-linenos=" 2 "></span><span class="c1"># [Column(name=&#39;customer_id&#39;, description=&#39;Identificador unívoco (PK) del cliente&#39;, dataType=&#39;int&#39;, nullable=True, isPartition=False, isBucket=False),</span>
</span><span class="hll"><span class="linenos" data-linenos=" 3 "></span><span class="c1">#  Column(name=&#39;customer_fname&#39;, description=&#39;Nombre del cliente&#39;, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
</span><span class="linenos" data-linenos=" 4 "></span><span class="c1">#  Column(name=&#39;customer_lname&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">#  Column(name=&#39;customer_email&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">#  Column(name=&#39;customer_password&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">#  Column(name=&#39;customer_street&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">#  Column(name=&#39;customer_city&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">#  Column(name=&#39;customer_state&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False),</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">#  Column(name=&#39;customer_zipcode&#39;, description=None, dataType=&#39;string&#39;, nullable=True, isPartition=False, isBucket=False)]</span>
</code></pre></div>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://learning.oreilly.com/library/view/modern-data-engineering/9781484274521/">Modern Data Engineering with Apache Spark - Scott Haines - Apress</a></li>
</ul>
<h2 id="actividades">Actividades<a class="headerlink" href="#actividades" title="Permanent link">&para;</a></h2>
<p>(<abbr title="Aplica técnicas de análisis de datos que integran, procesan y analizan la información, adaptando e implementando sistemas que las utilicen.">RASBD.1</abbr> / <abbr title="Se ha extraído de forma automática información y conocimiento a partir de grandes volúmenes de datos.">CESBD.1b</abbr> y <abbr title="Se ha construido un conjunto de datos complejos y se han relacionado entre sí.">CESBD.1d</abbr>) En las siguientes actividades vamos a familiarizarnos con el uso del API de <em>Spark JDBC</em>, el acceso al catálogo y <em>DeltaLake</em>.</p>
<ol>
<li>(1p) Vamos a repetir una actividad que realizamos durante la sesión de <em>Hive</em>. Para ello, se pide recuperar desde la base de datos <code>retail_db</code> las tablas <code>customers</code> y <code>orders</code> en dos dataframes tal como hemos hecho en <a href="#leyendo-datos">el apartado Leyendo Datos</a>, y a continuación, realizar un <em>join</em> de manera que contenga la información de cada pedido y la ciudad del cliente.</li>
<li>(0.5p) Conecta con <em>MongoDB</em> y persiste el resultado del join en una colección llamada <code>pedidos_ciudad</code>. Conéctate a <em>MongoDB</em> desde <code>mongosh</code> y comprueba que se han almacenado los datos.</li>
<li>(2p) Además, sobre el <em>dataframe</em> anterior, y mediante el <em>Spark Catalog</em>, en la base de datos <code>iabd</code>, crea una tabla gestionada en el catálogo cuyo nombre sea <code>pedidos_ciudad</code>, y añade comentarios tanto a la tabla como a sus columnas (al menos las más importantes). A continuación, crea una tabla externa llamada <code>pedidos_ciudad_ext</code> desde <em>Spark</em> con la misma información que <code>pedidos_ciudad</code>.</li>
<li>(0.5p) Conéctate a <em>MySQL</em> y recupera la información de las tablas creadas en estos ejercicios y sus parámetros.</li>
</ol>







  
  



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        <a href='https://ko-fi.com/T6T8GWT9N' title='Invítame a un café en ko-fi.com' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Invítame a un café en ko-fi.com' /></a>
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="Me encantan estos apuntes" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="Los apuntes son mejorables" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Gracias por tu tiempo. Si quieres me puedes <a href='https://ko-fi.com/T6T8GWT9N'>invitar a un café en ko-fi</a>.
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              ¡Gracias por tu colaboración! Ayúdame a mejorar los apuntes enviándome un mail a <a href="mailto:a.medrano@edu.gva.es">a.medrano@edu.gva.es</a> con tus comentarios.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="agregaciones.html" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Agregaciones">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Agregaciones
              </div>
            </div>
          </a>
        
        
          
          <a href="deltalake.html" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Delta Lake">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                Delta Lake
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Aitor Medrano - <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es">Licencia CC BY-NC-SA</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://aitor-medrano.github.io/" target="_blank" rel="noopener" title="aitor-medrano.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.top", "navigation.tracking", "navigation.footer", "navigation.indexes", "content.code.annotate", "announce.dismiss", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>